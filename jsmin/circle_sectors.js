"use strict";var isNode=typeof module!=="undefined";if(isNode){var con=console;var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var circle_sectors=function circle_sectors(){var TAU=Math.PI*2;var QUADRANT=Math.PI/2;var centre=.5;var bmp=dom.canvas(1,1);var size;function init(options){size=options.size;bmp.setSize(size,size);colours.getRandomPalette();var rings=rand.getInteger(4,24);var ringStart=rand.getInteger(0,rings-1);var sectorsStart=rand.getInteger(2,16);var sectorsPower=rand.getInteger(2,3);var padding=rand.getNumber(0,.01);var sectorsMin=rand.getNumber(.02,.2);var dotty=rand.getNumber(0,1)>.8;var howDotty=rand.getNumber(.1,.8);var colourCycle=function(){var mode=rand.getInteger(0,2);con.log("colourCycle - mode:",mode);var ringLast=-1;var ringRegularCycle=rand.getNumber(0,1)>.6;switch(mode){case 0:return function(ring,sector){return colours.getRandomColour()};case 1:return function(ring,sector){return colours.getNextColour(ring)};case 2:return function(ring,sector){if(ring!=ringLast){ringLast=ring;return colours.getNextColour(ringRegularCycle||rand.getInteger(0,4))}else{return colours.getCurrentColour()}}}}();bmp.ctx.lineWidth=padding*size;for(var i=ringStart;i<rings;i++){if(dotty&&rand.getNumber(0,1)>howDotty)continue;var ringRadiusInner=i/rings*centre;var ringRadiusOuter=(i+1)/rings*centre;var perimeter=TAU*ringRadiusInner;var sectors=sectorsStart;while(perimeter/sectors>sectorsMin){sectors*=sectorsPower}for(var j=0;j<sectors;j++){var drawSector=function drawSector(){bmp.ctx.beginPath();bmp.ctx.moveTo(x0*size,y0*size);bmp.ctx.lineTo(x1*size,y1*size);bmp.ctx.arc(centre*size,centre*size,ringRadiusOuter*size,QUADRANT-angle0,QUADRANT-angle1,true);bmp.ctx.lineTo(x3*size,y3*size);bmp.ctx.arc(centre*size,centre*size,ringRadiusInner*size,QUADRANT-angle1,QUADRANT-angle0,false);bmp.ctx.closePath()};if(dotty&&rand.getNumber(0,1)>howDotty)continue;var angle0=j/sectors*TAU;var angle1=(j+1)/sectors*TAU;var x0=centre+Math.sin(angle0)*ringRadiusInner;var y0=centre+Math.cos(angle0)*ringRadiusInner;var x1=centre+Math.sin(angle0)*ringRadiusOuter;var y1=centre+Math.cos(angle0)*ringRadiusOuter;var x2=centre+Math.sin(angle1)*ringRadiusOuter;var y2=centre+Math.cos(angle1)*ringRadiusOuter;var x3=centre+Math.sin(angle1)*ringRadiusInner;var y3=centre+Math.cos(angle1)*ringRadiusInner;bmp.ctx.globalCompositeOperation="source-over";bmp.ctx.fillStyle=colourCycle(i,j);drawSector();bmp.ctx.fill();bmp.ctx.globalCompositeOperation="destination-out";drawSector();bmp.ctx.stroke()}}}return{stage:bmp.canvas,init:init}};if(isNode){module.exports=circle_sectors()}else{define("circle_sectors",circle_sectors)}