"use strict";var isNode="undefined"!=typeof module,circle_sectors=function(){var size,r=rand.instance(void 0),c=colours.instance(r),TAU=2*Math.PI,QUADRANT=Math.PI/2,bmp=dom.canvas(1,1);return{stage:bmp.canvas,init:function(options){size=options.size,bmp.setSize(size,size),r.setSeed(),c.getRandomPalette();var rings=r.getInteger(4,24),ringStart=r.getInteger(0,rings-1),sectorsStart=r.getInteger(2,16),sectorsPower=r.getInteger(2,3),padding=r.getNumber(0,.01),sectorsMin=r.getNumber(.02,.2),dotty=.8<r.getNumber(0,1),howDotty=r.getNumber(.1,.8),colourCycle=function(){var mode=r.getInteger(0,2),ringLast=-1,ringRegularCycle=.6<r.getNumber(0,1);switch(mode){case 0:return function(ring,sector){return c.getRandomColour()};case 1:return function(ring,sector){return c.getNextColour(ring)};case 2:return function(ring,sector){return ring!=ringLast?(ringLast=ring,c.getNextColour(ringRegularCycle||r.getInteger(0,4))):c.getCurrentColour()}}}();bmp.ctx.lineWidth=padding*size;for(var i=ringStart;i<rings;i++)if(!(dotty&&r.getNumber(0,1)>howDotty)){for(var ringRadiusInner=i/rings*.5,ringRadiusOuter=(i+1)/rings*.5,perimeter=TAU*ringRadiusInner,sectors=sectorsStart;sectorsMin<perimeter/sectors;)sectors*=sectorsPower;for(var j=0;j<sectors;j++){var drawSector=function(){bmp.ctx.beginPath(),bmp.ctx.moveTo(x0*size,y0*size),bmp.ctx.lineTo(x1*size,y1*size),bmp.ctx.arc(.5*size,.5*size,ringRadiusOuter*size,QUADRANT-angle0,QUADRANT-angle1,!0),bmp.ctx.lineTo(x3*size,y3*size),bmp.ctx.arc(.5*size,.5*size,ringRadiusInner*size,QUADRANT-angle1,QUADRANT-angle0,!1),bmp.ctx.closePath()};if(!(dotty&&r.getNumber(0,1)>howDotty)){var angle0=j/sectors*TAU,angle1=(j+1)/sectors*TAU,x0=.5+Math.sin(angle0)*ringRadiusInner,y0=.5+Math.cos(angle0)*ringRadiusInner,x1=.5+Math.sin(angle0)*ringRadiusOuter,y1=.5+Math.cos(angle0)*ringRadiusOuter,x3=(Math.sin(angle1),Math.cos(angle1),.5+Math.sin(angle1)*ringRadiusInner),y3=.5+Math.cos(angle1)*ringRadiusInner;bmp.ctx.globalCompositeOperation="source-over",bmp.ctx.fillStyle=colourCycle(i,j),drawSector(),bmp.ctx.fill(),bmp.ctx.globalCompositeOperation="destination-out",drawSector(),bmp.ctx.stroke()}}}}}};isNode?module.exports=circle_sectors():define("circle_sectors",circle_sectors);