"use strict";define("maze_cube",["linked_line"],function(linkedLine){var blocks=11;var cubeSize=1512;var size=cubeSize/blocks;var camera,scene,renderer;var mouse={x:0,y:0,toggle:true};var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;var holder;var controls;function cube(w,h,d,colour){var group=new THREE.Group;var material=new THREE.MeshPhongMaterial({color:colour,emissive:8400896,specular:10518656,shininess:40});var geometry=new THREE.BoxGeometry(w,h,d);var object=new THREE.Mesh(geometry,material);object.castShadow=true;object.receiveShadow=true;group.add(object);return group}function init(){var mazes=[];var face=function face(preoccupied){return linkedLine.generate(blocks,preoccupied)};var add=function add(maze){con.log("adding walls:",mazes.length,maze.wallrects.length);mazes.push(maze.wallrects);progress("render:progress",mazes.length/6)};perf.start("gen");face().then(add).then(function(){return face([{x:1,y:2},{x:1,y:3},{x:3,y:3}])}).then(add).then(face).then(add).then(face).then(add).then(face).then(add).then(face).then(add).then(function(){con.log("success");perf.end("gen");init3D(mazes)}).catch(function(err){con.warn("fail",err)})}function init3D(mazes){scene=new THREE.Scene;scene.fog=new THREE.FogExp2(0,2e-4);camera=new THREE.PerspectiveCamera(90,sw/sh,1,2e4);scene.add(camera);var lightAbove=new THREE.DirectionalLight(9474192,1.5);lightAbove.castShadow=true;lightAbove.position.set(0,200,0);scene.add(lightAbove);renderer=new THREE.WebGLRenderer;renderer.setSize(sw,sh);renderer.shadowMap={type:THREE.BasicShadowMap,enabled:true};holder=new THREE.Group;scene.add(holder);var c=cube(cubeSize*2-size,cubeSize*2-size,cubeSize*2-size,4206624);holder.add(c);var makeFace=function makeFace(options){var face=new THREE.Group;holder.add(face);options.maze.forEach(function(item){var x=(item.x+item.w/2-blocks-.5)*size;var y=(item.y+item.h/2-blocks-.5)*size;var z=cubeSize+1;var c=cube(item.w*size,item.h*size,size,9474192);c.position.set(x,y,z);face.add(c)});if(options.rotation.x)face.rotation.x=options.rotation.x*Math.PI;if(options.rotation.y)face.rotation.y=options.rotation.y*Math.PI;if(options.rotation.z)face.rotation.z=options.rotation.z*Math.PI};makeFace({maze:mazes[0],rotation:{x:0},colour:16711680});makeFace({maze:mazes[1],rotation:{x:1,z:1.5},colour:65280});makeFace({maze:mazes[2],rotation:{x:.5,z:.5},colour:255});makeFace({maze:mazes[3],rotation:{x:1.5,z:1},colour:16776960});makeFace({maze:mazes[4],rotation:{y:.5,z:1.5},colour:16711935});makeFace({maze:mazes[5],rotation:{y:1.5,z:1},colour:65535});document.body.appendChild(renderer.domElement);progress("render:complete",renderer.domElement);render(0);function exportToObj(){con.log("exportToObj");var exporter=new THREE.OBJExporter;var result=exporter.parse(scene);var floatingDiv=document.createElement("div");floatingDiv.style.display="block";floatingDiv.style.background="white";floatingDiv.style.color="black";floatingDiv.innerHTML=result.split("\n").join("<br />");con.log("result.length",result.length);document.body.appendChild(floatingDiv)}function toggle(){mouse.toggle=!mouse.toggle}window.addEventListener("click",toggle);window.addEventListener("touchstart",toggle)}function render(time){if(mouse.toggle){holder.rotation.x+=Math.PI*.005;holder.rotation.z-=Math.PI*.002}camPos.z=5e3;camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init}});