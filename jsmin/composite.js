"use strict";var focalLength=1200;make3DPoint=function make3DPoint(x,y,z){var point={};point.x=x;point.y=y;point.z=z;return point};make2DPoint=function make2DPoint(x,y,z){var point={};point.x=x+sw/2;point.y=y+sh/2;point.z=z;return point};cubeAxisRotations=make3DPoint(0,0,0);function calc2D(points,axisRotations){var t=[];var sx=Math.sin(axisRotations.x);var cx=Math.cos(axisRotations.x);var sy=Math.sin(axisRotations.y);var cy=Math.cos(axisRotations.y);var sz=Math.sin(axisRotations.z);var cz=Math.cos(axisRotations.z);var x,y,z,xy,xz,yx,yz,zx,zy,scaleRatio;for(var i=0,il=points.length;i<il;i++){x=points[i].x;y=points[i].y;z=points[i].z;xy=cx*y-sx*z;xz=sx*y+cx*z;yz=cy*xz-sy*x;yx=sy*xz+cy*x;zx=cz*yx-sz*xy;zy=sz*yx+cz*xy;scaleRatio=focalLength/(focalLength+yz);x=zx*scaleRatio;y=zy*scaleRatio;t[i]=make2DPoint(x,y,yz)}return t}function calcNormal(p1,p2,p3){var u={};u.x=p2.x-p1.x;u.y=p2.y-p1.y;u.z=p2.z-p1.z;var v={};v.x=p3.x-p1.x;v.y=p3.y-p1.y;v.z=p3.z-p1.z;var n={};n.x=u.y*v.z-u.z*v.y;n.y=u.z*v.x-u.x*v.z;n.z=u.x*v.y-u.y*v.x;return n}renderPlanes=function renderPlanes(group,planesArray,options){var list=[];for(var i=0,il=planesArray.length;i<il;i++){var screenPoints=calc2D(planesArray[i],cubeAxisRotations);var minX=1e6,minY=1e6,minZ=1e6,maxX=0,maxY=0,maxZ=0;var vertices=[];var av={x:0,y:0};var vil=screenPoints.length;for(var vi=0;vi<vil;vi++){var v=screenPoints[vi];vertices.push({x:v.x,y:v.y});if(v.x<minX)minX=v.x;if(v.x>maxX)maxX=v.x;if(v.y<minY)minY=v.y;if(v.y>maxY)maxY=v.y;if(v.z<minZ)minZ=v.z;if(v.z>maxZ)maxZ=v.z;av.x=av.x+v.x;av.y=av.y+v.y}av.x=av.x/vil;av.y=av.y/vil;var zIndex=minZ+(maxZ-minZ)/2;var normal3D=calcNormal(screenPoints[0],screenPoints[1],screenPoints[2]);var normalLength=Math.sqrt(normal3D.x*normal3D.x+normal3D.y*normal3D.y+normal3D.z*normal3D.z);var normalised3D={x:normal3D.x/normalLength,y:normal3D.y/normalLength,z:normal3D.z/normalLength};var fillStyle;var face={z:zIndex,o:vertices};if(options){var slope={x:Math.acos(normalised3D.x),y:Math.asin(normal3D.y/normalLength),z:Math.acos(normalised3D.z)};var params={slope:slope,bounds:[minX,minY,maxX,maxY],vertices:vil};face.params=params}list[i]=face}list.sort(function(a,b){return a.z<b.z?1:-1});for(var i=0,il=list.length;i<il;i++){var vertices=list[i].o;if(options.fillColor)group.fillStyle=options.fillColor(list[i].params);group.beginPath();for(var v=0,vl=vertices.length;v<vl;v++){var x=vertices[v].x,y=vertices[v].y;if(v==0){group.moveTo(x,y)}else{group.lineTo(x,y)}}group.closePath();group.fill()}};"use strict";define(function(require){var stage=dom.element("div");var b1=dom.button("test1",{style:{color:"white"}});var b2=dom.button("test2",{style:{color:"white"}});stage.appendChild(b1);stage.appendChild(b2);dom.on(b1,["click"],go);function go(){con.log("go!!");dom.on(b2,["click"],go);dom.off(b1,["click"],go)}con.log("test loaded");return{stage:stage,init:function init(){},resize:function resize(){}}});(function(){var bits,can,centre,con,ctx,d,draw,gap,init,oscs,seeds,size,time;con=console;d=document;bits=200;gap=2;size=bits*gap;centre=size/2;ctx=null;can=null;time=0;oscs=4;seeds=[];init=function(){var i,_i;can=d.createElement("canvas");can.width=can.height=size;d.body.appendChild(can);ctx=can.getContext("2d");for(i=_i=0;_i<oscs;i=_i+=1){seeds[i]=Math.pow(2,i+1)+(Math.random()*2-1)*10}con.log(seeds);return draw()};draw=function(){var i,rgb,v,x,y,_i,_j;can.width=can.width;time+=1;for(x=_i=0;_i<bits;x=_i+=1){v=0;for(i=_j=0;_j<oscs;i=_j+=1){v+=Math.sin((time+x)*seeds[i]*.01)/Math.pow(2,i+1)}y=centre+v*centre/oscs;rgb=100;ctx.fillStyle="rgba("+rgb+","+rgb+","+rgb+",0.4)";ctx.fillRect(x*gap,y,10,10)}return requestAnimationFrame(draw)};init()}).call(this);"use strict";define("aegean_sun",["perlin"],function(perlin){var sw=window.innerWidth;var sh=window.innerHeight;var w=400,h=400;var channelX=perlin.noise(w,h);var channelY=perlin.noise(w,h);var maxSize=rand.getInteger(100,300);var minSize=rand.getInteger(4,10);var maxBoxes=Math.floor(sw*sh/200);var cols=colours.getRandomPalette();var canvas=dom.canvas(sw,sh);var ctx=canvas.ctx;var pixels=[];function go(t){var noiseX=channelX.cycle(Math.random()*100,.005);var noiseY=channelY.cycle(Math.random()*100,.004);var segments=20;var steps=40;function contour(){var p0={x:rand.getNumber(.4,.6)*w,y:0*h};var p1={x:rand.getNumber(.4,.6)*w,y:1*h};var line=[];for(var i=0;i<segments;i++){var p=geom.lerp(p0,p1,i/segments);line.push(p)}renderLine(line);return line}function recurse(line,offset){var segments=line.length;var nextLine=[];for(var i=0;i<segments;i++){var p={x:line[i].x+offset.x,y:line[i].y+offset.y};var noiseIndex=Math.floor(p.y*w+p.x);var x=(noiseX[noiseIndex]-.5)*2;var y=(noiseY[noiseIndex]-.5)*0;p.x+=x;p.y+=y;nextLine.push(p)}renderLine(nextLine);return nextLine}function renderLine(line){var segments=line.length;ctx.beginPath();for(var i=0;i<segments;i++){var p=line[i];if(i==0){ctx.moveTo(p.x,p.y)}else{ctx.lineTo(p.x,p.y)}}ctx.stroke()}var line=contour();var next=line,prev=line;for(var i=0;i<steps;i++){next=recurse(next,{x:4,y:0});prev=recurse(prev,{x:-4,y:0})}}function init(){var bg=colours.getRandomColour();cols.splice(cols.indexOf(bg),1);ctx.fillStyle=bg;ctx.fillRect(0,0,sw,sh);ctx.strokeStyle=colours.getNextColour();go(0)}return{init:init,stage:canvas.canvas}});"use strict";var isNode=typeof module!=="undefined";if(isNode){var con=console;var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var alien=function alien(){var stage=dom.canvas(1,1);var ctx=stage.ctx;var centre;var numberOfRows=10;var numberOfColumns=10;var cellSize=Math.ceil(rand.getInteger(20,60)/numberOfColumns);var halfColumns=numberOfColumns/2;var canvasWidth=cellSize*(numberOfColumns+2);var canvasHeight=cellSize*(numberOfRows+2);function init(options){size=options.size;sw=options.sw||size;sh=options.sh||size;stage.setSize(sw,sh);centre=sh/2;colours.getRandomPalette();render()}function render(){var aliens=manyAliens();con.log(aliens);aliens.x.forEach(function(x,xi){aliens.y.forEach(function(y){var img=oneAlien();ctx.drawImage(img,centre+x*canvasWidth,centre+y*canvasHeight)});progress("render:progress",xi/aliens.x.length)});progress("render:complete",stage.canvas)}function oneAlien(){var grid=[];var lineSize=rand.getInteger(0,3);if(lineSize)lineSize=cellSize/lineSize;var bmp=dom.canvas(canvasWidth,canvasHeight);function seed(){for(var row=0;row<numberOfRows;row++){grid[row]=[];for(var column=0;column<halfColumns;column++){grid[row][column]=createSeedCell(column)}}}function createSeedCell(probability){var chance=Math.random();var cutoff=(probability+1)/(halfColumns+1);return chance<cutoff}function drawGrid(){var column=void 0,row=void 0;var colourLine=colours.getNextColour();var colourFill=colours.getNextColour();for(row=0;row<numberOfRows;row++){for(column=0;column<numberOfColumns;column++){drawCell(row,column,colourLine,lineSize)}}for(row=0;row<numberOfRows;row++){for(column=0;column<numberOfColumns;column++){drawCell(row,column,colourFill||colours.getNextColour(),0)}}}function drawCell(y,x,fillStyle,strokeWidth){var colReflected=void 0;if(x>=halfColumns){colReflected=numberOfColumns-x-1}else{colReflected=x}var isOn=grid[y][colReflected];if(isOn){bmp.ctx.fillStyle=fillStyle;bmp.ctx.fillRect((1+x)*cellSize-strokeWidth,(1+y)*cellSize-strokeWidth,cellSize+strokeWidth*2,cellSize+strokeWidth*2)}}seed();drawGrid();return bmp.canvas}function manyAliens(){function r(m){return~~(Math.random()*m+1)}function q(){var l=r(11),g=r(5),a=[],i=0;while(i<l){j=i*g;a.push(j);if(i)a.unshift(-j);i++}return a}return{x:q(),y:q()}}var experiment={init:init,render:render,stage:stage.canvas};return experiment};if(isNode){module.exports=alien()}else{define("alien",alien)}"use strict";var camera,scene,projector,renderer;var mouse={x:0,y:0};var sw=window.innerWidth,sh=window.innerHeight;sw=sh=400;var theta=0;var h=[];var i=0;var radius=20;var n;var settings={};settings.lineScale=1;settings.lineSize=1+Math.random()*10*settings.lineScale;settings.lineGap=2+Math.random()*3*settings.lineScale;settings.baseRotation=0;settings.varyRotation=Math.random()*Math.PI*2;function draw(props){var col=4278198272;var material=new THREE.MeshLambertMaterial({color:col});var geometry=new THREE.CylinderGeometry(props.radius,props.radius,props.height,14);var object=new THREE.Mesh(geometry,material);return object}function init(){con.log("init");scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(70,sw/sh,1,1e4);camera.position.set(0,300,500);scene.add(camera);var light=new THREE.DirectionalLight(16777215,2);light.position.set(1,1,1).normalize();scene.add(light);var light=new THREE.DirectionalLight(16777215);light.position.set(-1,-1,-1).normalize();scene.add(light);renderer=new THREE.WebGLRenderer;renderer.sortObjects=false;renderer.setSize(sw,sh);for(var i=0,il=10;i<il;i++){var scale=1-i/il+.5;var height=100*scale;var radius=20*scale;var cylinder=draw({height:i*height,radius:radius});cylinder.position.set(0,height,0);cylinder.rotation.set(0,0,i*.2);scene.add(cylinder)}document.body.appendChild(renderer.domElement);document.addEventListener("mousemove",onDocumentMouseMove,false)}function onDocumentMouseMove(event){event.preventDefault();mouse.x=event.clientX/sw*2-1;mouse.y=-(event.clientY/sh)*2+1}function render(){var camRadius=500;camera.position.x=camRadius*Math.sin(theta*Math.PI/360);camera.position.y=mouse.y*130;camera.position.z=camRadius*Math.cos(theta*Math.PI/360);camera.lookAt(scene.position);renderer.render(scene,camera)}function animate(){requestAnimationFrame(animate);render()}setTimeout(function(){init();animate()},100);"use strict";var isNode=typeof module!=="undefined";if(isNode){var con=console;var rand=require("./rand.js");var Canvas=require("canvas");var Image=Canvas.Image;var dom=require("./dom.js");var http=require("http");var https=require("https")}var any_image_url=function any_image_url(){var allowed={526:{image:"https://funkyvector.com/blog/wp-content/uploads/2016/05/state_of_origin_52_6_22_d5243594_design.png",scale:isNode?1:.5},834199129:{scale:.8}};var size,sw,sh,cx,cy;var bmp=dom.canvas(1,1);var ctx=bmp.ctx;function init(options){size=options.size;sw=size;sh=size;cx=sw/2;cy=sh/2;bmp.setSize(sw,sh);render()}function render(){var ok=allowed[rand.getSeed()];if(ok&&ok.image){renderBMPFromURL(ok.image,ok.scale)}else{con.warn("Cannot find image:",rand.getSeed())}}function renderSVGFromString(data,scale,width,height){var DOMURL=window.URL||window.webkitURL||window;var img=new Image;var svg=new Blob([data],{type:"image/svg+xml;charset=utf-8"});var url=DOMURL.createObjectURL(svg);img.onload=function(){ctx.translate(cx,cy);ctx.scale(scale,scale);ctx.translate(-width/2,-height/2);ctx.drawImage(img,0,0);DOMURL.revokeObjectURL(url);progress("render:complete",bmp.canvas)};img.src=url}function renderBMPFromURL(url,scale){function drawToContext(img){var width=img.width,height=img.height;ctx.translate(cx,cy);ctx.scale(scale,scale);ctx.translate(-width/2,-height/2);ctx.drawImage(img,0,0);progress("render:complete",bmp.canvas)}if(isNode){loadImageURL(url,function(buffer){makeImage(buffer,function(img){drawToContext(img)},function(err){con.log("makeImage fail",err)})},function(err){con.log("loadImageURL fail",err)})}else{var img=new Image;img.onload=function(){drawToContext(img)};img.onerror=function(err){con.log("img.onerror error",err)};img.src=url}}function loadImageURL(url,fulfill,reject){var protocol=http;if(/https:\/\//.test(url)){protocol=https}protocol.get(url,function(res){var buffers=[],length=0;res.on("data",function(chunk){length+=chunk.length;buffers.push(chunk)});res.on("end",function(){var loaded=Buffer.concat(buffers);fulfill(loaded)});res.on("error",function(e){con.log("loadImageURL reject",e);reject(e)})})}function makeImage(data,fulfill,reject){var img=new Image;img.src=data;if(img){fulfill(img)}else{con.log("makeImage reject");reject()}}var experiment={stage:bmp.canvas,init:init};return experiment};if(isNode){module.exports=any_image_url()}else{define("any_image_url",any_image_url)}"use strict";define("attractor",function(){var sw=window.innerWidth;var sh=window.innerHeight;var w=400,h=400;var cols=colours.getRandomPalette();var canvas=dom.canvas(sw,sh);var ctx=canvas.ctx;var a=.19;var b=.9;var c=1.3;var xn1=5;var yn1=0;var xn,yn;var scale=40;var iterations=2e4;var mouse={x:0,y:0};function f(x){return(x+.1+x*(a-c)*x)/(1.1+a*(c*c+a*a)*x*x)*1.3}function onLoop(time){requestAnimationFrame(onLoop);ctx.fillStyle="white";ctx.fillRect(0,0,sw,sh);c=mouse.x/9e3;xn1=0;yn1=0;for(var i=0;i<iterations;i++){xn=xn1;yn=yn1;xn1=-xn-a+c+f(yn);yn1=-xn+c*f(xn*yn);ctx.fillStyle="rgba(0,0,0,0.3)";ctx.fillRect(380+xn1*scale,450+yn1*scale,1,1)}}dom.on(window,["mousemove","touchmove"],function(e){var event=e.changedTouches&&e.changedTouches[0]||e;event.x=event.x||event.pageX;event.y=event.y||event.pageY;mouse.x=event.x-sw/2;mouse.y=event.y-sh/2});function init(){onLoop(0)}return{init:init,stage:canvas.canvas}});"use strict";var AudioContext=window.AudioContext||window.webkitAudioContext;var fftSize=128;function WebAudioAnalyser(audio,ctx,opts){if(!(this instanceof WebAudioAnalyser))return new WebAudioAnalyser(audio,ctx,opts);if(!(ctx instanceof AudioContext))opts=ctx,ctx=null;opts=opts||{};this.ctx=ctx=ctx||new AudioContext;if(!(audio instanceof AudioNode)){audio=audio instanceof Audio||audio instanceof HTMLAudioElement?ctx.createMediaElementSource(audio):ctx.createMediaStreamSource(audio)}this.analyser=ctx.createAnalyser();this.analyser.fftSize=fftSize;this.stereo=!!opts.stereo;this.audible=opts.audible!==false;this.wavedata=null;this.freqdata=null;this.splitter=null;this.merger=null;this.source=audio;if(!this.stereo){this.output=this.source;this.source.connect(this.analyser);if(this.audible)this.analyser.connect(ctx.destination)}else{this.analyser=[this.analyser];this.analyser.push(ctx.createAnalyser());this.splitter=ctx.createChannelSplitter(2);this.merger=ctx.createChannelMerger(2);this.output=this.merger;this.source.connect(this.splitter);for(var i=0;i<2;i++){this.splitter.connect(this.analyser[i],i,0);this.analyser[i].connect(this.merger,0,i)}if(this.audible)this.merger.connect(ctx.destination)}}WebAudioAnalyser.prototype.waveform=function(output,channel){if(!output)output=this.wavedata||(this.wavedata=new Uint8Array((this.analyser[0]||this.analyser).frequencyBinCount));var analyser=this.stereo?this.analyser[channel||0]:this.analyser;analyser.getByteTimeDomainData(output);return output};WebAudioAnalyser.prototype.frequencies=function(output,channel){if(!output)output=this.freqdata||(this.freqdata=new Uint8Array((this.analyser[0]||this.analyser).frequencyBinCount));var analyser=this.stereo?this.analyser[channel||0]:this.analyser;analyser.getByteFrequencyData(output);return output};analyse=WebAudioAnalyser;var analyser;var lastBars=new Uint8Array(fftSize/2);var d=document.createElement("div");document.body.appendChild(d);function createFreqBar(index){var div=document.createElement("div");div.style.width="100%";div.style.height="100px";div.style.position="absolute";div.style.top=index*100+"px";document.body.appendChild(div);return div}var lastPeak=[];var numBands=8;var bands=[];for(var i=0;i<numBands;i++){bands[i]=createFreqBar(i);lastPeak[i]=0}var audio=new Audio;audio.crossOrigin="Anonymous";audio.src="exebeche.mp3";audio.loop=true;audio.addEventListener("canplay",function(){console.log("playing!");analyser=analyse(audio,{audible:true,stereo:false,fftSize:16});binCount=64;levelBins=Math.floor(binCount/levelsCount);con.log(binCount,levelsCount);audio.play();audio.currentTime=150;render(0)});audio.addEventListener("error",function(e){switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:alert("You aborted the video playback.");break;case e.target.error.MEDIA_ERR_NETWORK:alert("A network error caused the audio download to fail.");break;case e.target.error.MEDIA_ERR_DECODE:alert("The audio playback was aborted due to a corruption problem or because the video used features your browser did not support.");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:alert("The video audio not be loaded, either because the server or network failed or because the format is not supported.");break;default:alert("An unknown error occurred.");break}});function getBand(frequencies,band){var total=0;var bandWidth=fftSize/2/numBands;var startBand=band*bandWidth;var endBand=band*bandWidth+bandWidth;for(var i=startBand;i<endBand;i++){total+=frequencies[i]}total/=bandWidth;return total}var levelsData=[];var freqByteData;var timeByteData;var levelsCount=32;var levelBins;var levelHistory=[];var beatCutOff=0;var beatTime=0;var length=256;for(var i=0;i<length;i++){levelHistory.push(0)}function render(time){if(analyser){var frequencies=analyser.frequencies();var size=frequencies.length;requestAnimationFrame(render);for(var i=0;i<levelsCount;i++){var sum=0;for(var j=0;j<levelBins;j++){sum+=frequencies[i*levelBins+j]}levelsData[i]=sum/levelBins/256*1}var sum=0;for(var j=0;j<levelsCount;j++){sum+=levelsData[j]}level=sum/levelsCount;levelHistory.push(level);levelHistory.shift(1);var BEAT_HOLD_TIME=40;var BEAT_DECAY_RATE=.98;var BEAT_MIN=.15;if(level>beatCutOff&&level>BEAT_MIN){document.body.style.background="#fff";beatCutOff=level*1.1;beatTime=0}else{document.body.style.background="#444";if(beatTime<=50){beatTime++}else{beatCutOff*=.98;beatCutOff=Math.max(beatCutOff,BEAT_MIN)}}var b2=[];levelsData.concat([level*10]).forEach(function(freq){var f=0,bar="#";while(f++<freq*10){bar+="#"}b2.push(bar)});d.innerHTML=b2.join("<br>")}}"use strict";define("ball_and_chain",["lib/schteppe/cannon.0.6.2.min.js","cannon_demo"],function(cn,CannonDemo){function go(){var demo=new CannonDemo;demo.create(function(){var world=setupWorld(demo);world.gravity.set(0,0,-20);var width=1;var wireSize=.3;var pitch=1;var chainShape0=new CANNON.Box(new CANNON.Vec3(width,wireSize,pitch));var chainShape1=new CANNON.Box(new CANNON.Vec3(wireSize,width,pitch));var mass=1;var space=.3;var N=10,last;function join(body0,body1,offset){var cnX=width*.1,cnY=pitch+space+offset;var c1=new CANNON.PointToPointConstraint(body0,new CANNON.Vec3(-cnX,0,cnY),body1,new CANNON.Vec3(-cnX,0,-cnY));var c2=new CANNON.PointToPointConstraint(body0,new CANNON.Vec3(cnX,0,cnY),body1,new CANNON.Vec3(cnX,0,-cnY));world.addConstraint(c1);world.addConstraint(c2)}for(var i=0;i<N;i++){var firstBody=i===0,firstChainLink=i===1,lastBody=i===N-1;var py=(N-i)*(pitch*2+2*space)+pitch*2+space;if(firstBody){var sphereShape=new CANNON.Sphere(4);var spherebody=new CANNON.Body({mass:3});spherebody.addShape(sphereShape);spherebody.position.set(0,0,py);last=spherebody}else if(lastBody){var L=3,R=2;var cylinderShape=new CANNON.Cylinder(R,R,L,12);var cylinderBody=new CANNON.Body({mass:.5});cylinderBody.addShape(cylinderShape);cylinderBody.position.set(0,0,py);join(cylinderBody,last,0);last=cylinderBody}else{var chainLinkBody=new CANNON.Body({mass:.1});chainLinkBody.addShape(i%2?chainShape0:chainShape1);chainLinkBody.position.set(0,0,py);chainLinkBody.custom=true;chainLinkBody.customType="CHAIN_LINK";join(chainLinkBody,last,firstChainLink?1.8:0);last=chainLinkBody}world.add(last);demo.addVisual(last);last.velocity.set(Math.random()-.5,Math.random()-.5,Math.random()-.5);last.linearDamping=.1;last.angularDamping=.1}});function setupWorld(demo){var world=demo.getWorld();world.gravity.set(0,0,-40);world.broadphase=new CANNON.NaiveBroadphase;world.solver.iterations=10;var groundShape=new CANNON.Plane;var groundBody=new CANNON.Body({mass:0});groundBody.addShape(groundShape);groundBody.position.set(0,0,1);world.addBody(groundBody);demo.addVisual(groundBody);world.quatNormalizeFast=false;world.quatNormalizeSkip=0;return world}demo.start()}function check(){con.log("check");if(typeof THREE==="undefined"){setTimeout(check,10)}else{go()}}check()});"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var rand=require("./rand.js");var geom=require("./geom.js");var dom=require("./dom.js");var colours=require("./colours.js")}var bezier_flow=function bezier_flow(){var settings={renderlimit:{min:1,max:Number.POSITIVE_INFINITY,cur:1}};var sw,sh,size;var bmp=dom.canvas(100,100);var ctx=bmp.ctx;var lines,sections,points,lineStyles,exponential,scalePerLine;function getPoint(d){return points[(sections+d)%sections]}function init(options){con.log("init called",rand.getSeed());size=options.size;sw=size;sh=size;bmp.setSize(sw,sh);lines=rand.getInteger(100,500);settings.renderlimit.max=lines;settings.renderlimit.cur=lines;sections=rand.getInteger(3,6);con.log("sections",sections);exponential=rand.random()>.5;scalePerLine=rand.random()>.5;constantBaseLine=rand.random()>.5;points=[];lineStyles=[];colours.getRandomPalette();function baseLineWidth(){return 1+rand.random()*3}var fixedConstantBaseLine=baseLineWidth();for(var l=0;l<lines;l++){lineStyles[l]={strokeStyle:colours.getRandomColour(),lineWidth:constantBaseLine?fixedConstantBaseLine:baseLineWidth()}}var baseAngle=1e-4+rand.random()*Math.PI;var angleVariance=1/sections*.1;for(var p=0;p<sections;p++){var radius=.3+rand.random()*.1;var a=baseAngle+(p/sections+rand.getNumber(-angleVariance,angleVariance))*Math.PI*2;var cx=.5+Math.sin(a)*radius;var cy=.5+Math.cos(a)*radius;createPoint({index:p,cx:cx,cy:cy})}for(var p=0;p<sections;p++){points[p].angle()}ctx.clearRect(0,0,size,size);ctx.lineCap="round";render()}function createPoint(origin){var cx=origin.cx||rand.random();var cy=origin.cy||rand.random();var gapScale=rand.random()*.7/lines;var gaps=[];var total=0;for(var i=0;i<lines;i++){var gap=(.1+rand.random())*gapScale;gaps[i]=total;total+=gap*(exponential?Math.pow(2,1+i*.2)*.1:1)}points.push({index:origin.index,cx:cx,cy:cy,a:null,total:total,gaps:gaps,angle:function angle(){var prev=getPoint(this.index-1);var next=getPoint(this.index+1);var dx=next.cx-prev.cx;var dy=next.cy-prev.cy;this.a=-Math.atan(dy/dx)-(dx<0?0:Math.PI)},move:function move(){this.angle()},lines:function lines(i){var r=gaps[i]-.2;return[cx-Math.sin(this.a)*r,cy-Math.cos(this.a)*r]}})}function render(){ctx.clearRect(0,0,sw,sh);con.log("render ========================",settings.renderlimit.cur);for(var j=0;j<settings.renderlimit.cur;j++){for(var i=0,il=points.length;i<il;i++){var p1=getPoint(i-1);var p2=getPoint(i);p2.move();var m1=-Math.tan(p1.a);var m2=-Math.tan(p2.a);var p1l=p1.lines(j);var p2l=p2.lines(j);var x1=p1l[0],y1=p1l[1],x2=p2l[0],y2=p2l[1];var c1=y1-m1*x1;var c2=y2-m2*x2;var x1a=-.1;var y1a=m1*x1a+c1;var x1b=1.1;var y1b=m1*x1b+c1;var x2a=-.1;var y2a=m2*x2a+c2;var x2b=1.1;var y2b=m2*x2b+c2;var inter=geom.intersectionAnywhere({x:x1a,y:y1a},{x:x1b,y:y1b},{x:x2a,y:y2a},{x:x2b,y:y2b});ctx.strokeStyle=lineStyles[j].strokeStyle;ctx.lineWidth=lineStyles[j].lineWidth*(scalePerLine?(j+1)*.1:1);ctx.beginPath();ctx.moveTo(x1*size,y1*size);ctx.quadraticCurveTo(inter.x*size,inter.y*size,x2*size,y2*size);ctx.stroke()}}con.log("render complete called");progress("render:complete",bmp.canvas)}var experiment={stage:bmp.canvas,init:init,settings:settings,render:render};return experiment};if(isNode){module.exports=bezier_flow()}else{define("bezier_flow",bezier_flow)}"use strict";define("cannon_demo",function(){var Demo=function Demo(options){options=options||{};var that=this;this.create=create;this.start=start;var settings=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:true,gx:0,gy:0,gz:0,iterations:3,tolerance:1e-4,k:1e6,d:3,scene:0,paused:false,rendermode:"solid",constraints:false,contacts:false,cm2contact:false,normals:false,axes:false,particleSize:.1,shadows:false,aabbs:false,profiling:false,maxSubSteps:3};if(settings.stepFrequency%60!==0){throw new Error("stepFrequency must be a multiple of 60.")}var bodies=this.bodies=[];var visuals=this.visuals=[];var demo;var particleGeo=this.particleGeo=new THREE.SphereGeometry(1,16,8);var solidMaterial=new THREE.MeshPhongMaterial({color:3157034,emissive:0,specular:5323312,shininess:80});this.wireframeMaterial=new THREE.MeshLambertMaterial({color:16711680,wireframe:true});this.currentMaterial=solidMaterial;var particleMaterial=this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var world=this.world=new CANNON.World;world.broadphase=new CANNON.NaiveBroadphase;var light,scene,ambient,stats,info;function create(initfunc){demo=initfunc}function makeSureNotZero(vec){if(vec.x===0){vec.x=1e-6}if(vec.y===0){vec.y=1e-6}if(vec.z===0){vec.z=1e-6}}function updateVisuals(){var N=bodies.length;for(var i=0;i<N;i++){var b=bodies[i],visual=visuals[i];visual.position.copy(b.position);if(b.quaternion){visual.quaternion.copy(b.quaternion)}}}var SHADOW_MAP_WIDTH=512;var SHADOW_MAP_HEIGHT=512;var MARGIN=0;var SCREEN_WIDTH=window.innerWidth;var SCREEN_HEIGHT=window.innerHeight-2*MARGIN;var camera,controls,renderer;var container;var NEAR=5,FAR=2e3;init();animate();function init(){container=document.getElementById("experiment-holder");camera=new THREE.PerspectiveCamera(24,SCREEN_WIDTH/SCREEN_HEIGHT,NEAR,FAR);camera.position.set(0,-100,50);scene=that.scene=new THREE.Scene;scene.fog=new THREE.Fog(2236962,1e3,FAR);camera.lookAt(scene.position);ambient=new THREE.AmbientLight(2236962);scene.add(ambient);light=new THREE.SpotLight(16777215);light.position.set(30,-100,40);light.target.position.set(0,0,0);light.castShadow=true;light.shadow.camera.near=10;light.shadow.camera.far=100;light.shadow.mapSize.width=SHADOW_MAP_WIDTH;light.shadow.mapSize.height=SHADOW_MAP_HEIGHT;scene.add(light);scene.add(camera);renderer=new THREE.WebGLRenderer({clearColor:0,clearAlpha:1,antialias:false});renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT);renderer.domElement.style.position="relative";renderer.domElement.style.top=MARGIN+"px";container.appendChild(renderer.domElement);document.addEventListener("mousemove",onDocumentMouseMove);window.addEventListener("resize",onWindowResize);renderer.shadowMap.enabled=true;renderer.shadowMap.type=THREE.PCFSoftShadowMap;if(options.trackballControls){controls=new THREE.TrackballControls(camera,renderer.domElement);controls.rotateSpeed=1;controls.zoomSpeed=1.2;controls.panSpeed=.2;controls.noZoom=false;controls.noPan=false;controls.staticMoving=false;controls.dynamicDampingFactor=.3;var radius=100;controls.minDistance=0;controls.maxDistance=radius*1e3;controls.screen.width=SCREEN_WIDTH;controls.screen.height=SCREEN_HEIGHT}}var t=0,newTime,delta;function animate(){requestAnimationFrame(animate);updateVisuals();updatePhysics();render()}var lastCallTime=0;function updatePhysics(){var timeStep=1/settings.stepFrequency;var now=Date.now()/1e3;if(!lastCallTime){world.step(timeStep);lastCallTime=now;return}var timeSinceLastCall=now-lastCallTime;world.step(timeStep,timeSinceLastCall,settings.maxSubSteps);lastCallTime=now}function onDocumentMouseMove(event){}function onWindowResize(event){SCREEN_WIDTH=window.innerWidth;SCREEN_HEIGHT=window.innerHeight;renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT);camera.aspect=SCREEN_WIDTH/SCREEN_HEIGHT;camera.updateProjectionMatrix();if(controls){controls.screen.width=SCREEN_WIDTH;controls.screen.height=SCREEN_HEIGHT}camera.radius=(SCREEN_WIDTH+SCREEN_HEIGHT)/4}function render(){controls&&controls.update();renderer.clear();renderer.render(that.scene,camera)}function start(){buildScene(0)}function buildScene(n){demo()}};Demo.prototype={constructor:Demo};Demo.prototype.getWorld=function(){return this.world};Demo.prototype.addVisual=function(body,material){var mesh;if(body instanceof CANNON.Body){mesh=this.shape2mesh(body,material)}else{con.log("custom body!!!",body)}if(mesh){this.bodies.push(body);this.visuals.push(mesh);body.visualref=mesh;body.visualref.visualId=this.bodies.length-1;this.scene.add(mesh)}};Demo.prototype.addVisuals=function(bodies){for(var i=0;i<bodies.length;i++){this.addVisual(bodies[i])}};Demo.prototype.removeVisual=function(body){if(body.visualref){var bodies=this.bodies,visuals=this.visuals,old_b=[],old_v=[],n=bodies.length;for(var i=0;i<n;i++){old_b.unshift(bodies.pop());old_v.unshift(visuals.pop())}var id=body.visualref.visualId;for(var j=0;j<old_b.length;j++){if(j!==id){var i=j>id?j-1:j;bodies[i]=old_b[j];visuals[i]=old_v[j];bodies[i].visualref=old_b[j].visualref;bodies[i].visualref.visualId=i}}body.visualref.visualId=null;this.scene.remove(body.visualref);body.visualref=null}};Demo.prototype.removeAllVisuals=function(){while(this.bodies.length){this.removeVisual(this.bodies[0])}};var hackyMcHack=0;Demo.prototype.shape2mesh=function(body,material){material=material||this.currentMaterial;var wireframe=this.settings.renderMode==="wireframe";var obj=new THREE.Object3D;function addMesh(mesh,shapeIndex){mesh.receiveShadow=true;mesh.castShadow=true;if(mesh.children){for(var i=0;i<mesh.children.length;i++){mesh.children[i].castShadow=true;mesh.children[i].receiveShadow=true;if(mesh.children[i]){for(var j=0;j<mesh.children[i].length;j++){mesh.children[i].children[j].castShadow=true;mesh.children[i].children[j].receiveShadow=true}}}}var o=body.shapeOffsets[shapeIndex];var q=body.shapeOrientations[shapeIndex];mesh.position.set(o.x,o.y,o.z);mesh.quaternion.set(q.x,q.y,q.z,q.w);obj.add(mesh)}if(body.custom){var shape=body.shapes[0];var mesh=new THREE.Object3D;switch(body.customType){case"CHAIN_LINK":var box_geometry=new THREE.BoxGeometry(shape.halfExtents.x*2,shape.halfExtents.y*2,shape.halfExtents.z*2);var submeshFrame=new THREE.Mesh(box_geometry,this.wireframeMaterial);var link=new THREE.Object3D;var points=[];var divisions=10;var widthHalf=.8;var pitch=shape.halfExtents.z;var wireSizeHalf=.3;var segments=10;for(var i=0;i<=divisions;i++){var a=i/divisions*Math.PI*-2;points.push(new THREE.Vector2(widthHalf+Math.sin(a)*wireSizeHalf,Math.cos(a)*wireSizeHalf))}var geometry=new THREE.LatheBufferGeometry(points,segments,0,Math.PI);var linkEnd0=new THREE.Mesh(geometry,material);linkEnd0.position.set(0,0,pitch);linkEnd0.rotation.set(0,-Math.PI/2,0);link.add(linkEnd0);var linkEnd1=new THREE.Mesh(geometry,material);linkEnd1.position.set(0,0,-pitch);linkEnd1.rotation.set(0,-Math.PI/2,Math.PI);link.add(linkEnd1);var geometry=new THREE.CylinderBufferGeometry(wireSizeHalf,wireSizeHalf,pitch*2,segments);var cylinder0=new THREE.Mesh(geometry,material);cylinder0.rotation.set(Math.PI/2,0,0);cylinder0.position.set(widthHalf,0,0);link.add(cylinder0);var cylinder1=new THREE.Mesh(geometry,material);cylinder1.rotation.set(Math.PI/2,0,0);cylinder1.position.set(-widthHalf,0,0);link.add(cylinder1);linkEnd0.receiveShadow=true;linkEnd0.castShadow=true;linkEnd1.receiveShadow=true;linkEnd1.castShadow=true;cylinder0.receiveShadow=true;cylinder0.castShadow=true;cylinder1.receiveShadow=true;cylinder1.castShadow=true;mesh.add(link);link.rotation.z=hackyMcHack++%2*Math.PI/2;break;default:throw new Error("need to supply customType!")}addMesh(mesh,0);return obj}for(var l=0;l<body.shapes.length;l++){var shape=body.shapes[l];var mesh;switch(shape.type){case CANNON.Shape.types.SPHERE:var sphere_geometry=new THREE.SphereGeometry(shape.radius,18,18);mesh=new THREE.Mesh(sphere_geometry,material);break;case CANNON.Shape.types.PARTICLE:mesh=new THREE.Mesh(this.particleGeo,this.particleMaterial);var s=this.settings;mesh.scale.set(s.particleSize,s.particleSize,s.particleSize);break;case CANNON.Shape.types.PLANE:var geometry=new THREE.PlaneGeometry(10,10,4,4);mesh=new THREE.Object3D;var submesh=new THREE.Object3D;var ground=new THREE.Mesh(geometry,new THREE.MeshLambertMaterial({color:9474192}));ground.scale.set(100,100,100);submesh.add(ground);ground.castShadow=true;ground.receiveShadow=true;mesh.add(submesh);break;case CANNON.Shape.types.BOX:var box_geometry=new THREE.BoxGeometry(shape.halfExtents.x*2,shape.halfExtents.y*2,shape.halfExtents.z*2);mesh=new THREE.Mesh(box_geometry,material);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:var geo=new THREE.Geometry;for(var i=0;i<shape.vertices.length;i++){var v=shape.vertices[i];geo.vertices.push(new THREE.Vector3(v.x,v.y,v.z))}for(var i=0;i<shape.faces.length;i++){var face=shape.faces[i];var a=face[0];for(var j=1;j<face.length-1;j++){var b=face[j];var c=face[j+1];geo.faces.push(new THREE.Face3(a,b,c))}}geo.computeBoundingSphere();geo.computeFaceNormals();mesh=new THREE.Mesh(geo,material);break;case CANNON.Shape.types.HEIGHTFIELD:var geometry=new THREE.Geometry;var v0=new CANNON.Vec3;var v1=new CANNON.Vec3;var v2=new CANNON.Vec3;for(var xi=0;xi<shape.data.length-1;xi++){for(var yi=0;yi<shape.data[xi].length-1;yi++){for(var k=0;k<2;k++){shape.getConvexTrianglePillar(xi,yi,k===0);v0.copy(shape.pillarConvex.vertices[0]);v1.copy(shape.pillarConvex.vertices[1]);v2.copy(shape.pillarConvex.vertices[2]);v0.vadd(shape.pillarOffset,v0);v1.vadd(shape.pillarOffset,v1);v2.vadd(shape.pillarOffset,v2);geometry.vertices.push(new THREE.Vector3(v0.x,v0.y,v0.z),new THREE.Vector3(v1.x,v1.y,v1.z),new THREE.Vector3(v2.x,v2.y,v2.z));var i=geometry.vertices.length-3;geometry.faces.push(new THREE.Face3(i,i+1,i+2))}}}geometry.computeBoundingSphere();geometry.computeFaceNormals();mesh=new THREE.Mesh(geometry,material);break;case CANNON.Shape.types.TRIMESH:var geometry=new THREE.Geometry;var v0=new CANNON.Vec3;var v1=new CANNON.Vec3;var v2=new CANNON.Vec3;for(var i=0;i<shape.indices.length/3;i++){shape.getTriangleVertices(i,v0,v1,v2);geometry.vertices.push(new THREE.Vector3(v0.x,v0.y,v0.z),new THREE.Vector3(v1.x,v1.y,v1.z),new THREE.Vector3(v2.x,v2.y,v2.z));var j=geometry.vertices.length-3;geometry.faces.push(new THREE.Face3(j,j+1,j+2))}geometry.computeBoundingSphere();geometry.computeFaceNormals();mesh=new THREE.Mesh(geometry,material);break;default:throw"Visual type not recognized: "+shape.type}addMesh(mesh,l)}return obj};return Demo});"use strict";var isNode=typeof module!=="undefined";if(isNode){var con=console;var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var circle_packing=function circle_packing(){var TAU=Math.PI*2;var sw,sh;var cx=.5,cy=.5;var bmp=dom.canvas(1,1);function error(site,depth,err){return;bmp.ctx.fillStyle=err||"green";var siteSize=err?1:7;bmp.ctx.fillRect(site.x*sw-siteSize/2,site.y*sh-siteSize/2,siteSize,siteSize)}var experiment={stage:bmp.canvas,init:init,settings:{}};var threadOutput=dom.canvas(800,300);function init(options){console.time("process time");var size=options.size;sw=size;sh=size;bmp.setSize(sw,sh);colours.getRandomPalette();bmp.ctx.clearRect(0,0,sw,sh);var threads=0;var iterations=0;var circles=0,circlesLast=0,circlesSame=0;var gap=rand.getNumber(.001,.02);con.log("gap",gap);var minRadius=rand.getNumber(.001,.01);var maxRadius=rand.getNumber(minRadius+.02,.5);var maxDepth=rand.getInteger(1,10);var limitMaxRadius=rand.getInteger(0,2);var powerMaxRadius=rand.getNumber(.8,3);var limitMinRadius=rand.getInteger(0,1);con.log("limitMaxRadius",limitMaxRadius);con.log("powerMaxRadius",powerMaxRadius);con.log("limitMinRadius",limitMinRadius);var banding=rand.getNumber()>.7;var bandScale=rand.getInteger(4,20);var bandModulo=rand.getInteger(2,10);var alternatePunchOut=rand.getNumber()>.7;var bailed=false;var progressTicker=0;var fakeProgress=.1;var progressChecker=function progressChecker(){if(threads==-1){con.log("progressChecker",threads);progress("render:complete",bmp.canvas);bailed=true}else{setTimeout(progressChecker,250)}};progressChecker();function attemptNextCircle(parent,attempt){threads++;attempt++;progressTicker++;threadOutput.ctx.fillRect(progressTicker/500,0,1,threads/50);if(circles%100==0){fakeProgress-=(fakeProgress-1)*.02;progress("render:progress",fakeProgress)}if(attempt<5e3){var delay=iterations%100?0:200;if(delay){setTimeout(function(){attemptCircle(parent,attempt)},delay)}else{attemptCircle(parent,attempt)}}else{con.log("too many attempt")}}function attemptCircle(parent,attempt,options){threads--;iterations++;var colour,depth,distance,dx,dy,other,r,radius,site,y,x;if(parent){if(!parent.sites.length){return}depth=parent.depth+1;var index=Math.floor(rand.random()*parent.sites.length);site=parent.sites.splice(index,1)[0];x=site.x;y=site.y;dx=parent.x-x;dy=parent.y-y;distance=Math.sqrt(dx*dx+dy*dy);radius=parent.r-distance-gap;switch(limitMaxRadius){case 1:maxRadius=.01+Math.pow(.5-distance,powerMaxRadius);break;case 2:maxRadius=.01+Math.pow(distance,powerMaxRadius);break}switch(limitMinRadius){case 1:minRadius=maxRadius*.1;break}r=rand.random()*radius;if(r>maxRadius){r=maxRadius}else if(r<minRadius){r=minRadius}if(options){if(options.r){r=options.r}if(options.x){x=options.x}if(options.y){y=options.y}}if(r-gap<minRadius){error(site,depth,"blue");return attemptNextCircle(parent,attempt)}var ok=true;for(var i=0,il=parent.children.length;i<il&&ok;i++){other=parent.children[i];dx=x-other.x;dy=y-other.y;distance=Math.sqrt(dx*dx+dy*dy);var distanceCombined=r+other.r+gap;if(distanceCombined>distance){r=distance-other.r-gap;if(r<minRadius){ok=false}}}if(ok===false){error(site,depth,"yellow");return attemptNextCircle(parent,attempt)}}else{x=cx;y=cy;r=.5;depth=0}if(options&&options.colour){colour=options.colour}else{colour=colours.getRandomColour();while(parent&&parent.colour==colour){colour=colours.getNextColour()}}if(alternatePunchOut){bmp.ctx.globalCompositeOperation=(depth+1)%2?"destination-out":"source-over"}bmp.ctx.beginPath();bmp.ctx.fillStyle=colour;bmp.ctx.drawCircle(x*sw,y*sh,r*sw);bmp.ctx.closePath();bmp.ctx.fill();var grid=.01;var rings=Math.ceil(r/grid);grid=r/rings;var sites=[];for(var ring=0;ring<rings;ring++){var perimeter=ring*grid*TAU;var segments=Math.ceil(perimeter/grid)||6;for(var segment=0;segment<segments;segment++){var siteRadius=(ring+rand.getNumber(0,1))*grid,siteAngle=(segment+rand.getNumber(0,1))/segments*TAU,siteX=x+Math.sin(siteAngle)*siteRadius,siteY=y+Math.cos(siteAngle)*siteRadius,site={x:siteX,y:siteY};if(banding){if(parseInt(siteRadius*bandScale)%bandModulo==0){sites.push(site)}}else{sites.push(site)}}}if(site){error(site,depth,false)}var circle={colour:colour,depth:depth,x:x,y:y,r:r,children:[],sites:sites};circles++;if(parent&&parent.children){parent.children.push(circle)}if(depth<maxDepth){for(var i=0,il=circle.sites.length;i<il;i++){attemptNextCircle(circle,0)}}}var container=attemptCircle(null,0,{colour:"transparent"})}return experiment};if(isNode){module.exports=circle_packing()}else{define("circle_packing",circle_packing)}"use strict";var isNode=typeof module!=="undefined";if(isNode){var con=console;var dom=require("./dom.js");var geom=require("./geom.js");var rand=require("./rand.js")}var circle_packing_zoom_loop=function circle_packing_zoom_loop(){var TAU=Math.PI*2;var cx=.5,cy=.5;var bmp=dom.canvas(1,1);var size;var current,next;var zoom={};function init(options){size=options.size;bmp.setSize(size,size);current=generate();setTimeout(function(){var p0=current;con.log("p0",p0);var targetIndex=rand.getInteger(0,p0.circles.length);var target=p0.circles[targetIndex];zoom={amount:1,max:.5/target.r,target:target,targetIndex:targetIndex};con.log("zoom",zoom);updateZoom(0)},100)}var maxTime=1e4;function updateZoom(time){if(zoom.amount<zoom.max){}else{zoom.amount=zoom.max}target=zoom.target;scale=zoom.amount;var distance=Math.sqrt(Math.pow(zoom.target.x,2)+Math.pow(zoom.target.y,2))*zoom.max;scaler=zoom.amount;zoomProgress=zoom.amount/zoom.max;zoomRemaining=1-zoomProgress;var xo=zoom.target.x/distance*zoom.amount;bmp.ctx.save();bmp.ctx.clearRect(0,0,size,size);for(var i=0,il=current.circles.length;i<il;i++){var _current$circles$i=current.circles[i],x=_current$circles$i.x,y=_current$circles$i.y,r=_current$circles$i.r;x=.5+(x-.5)*scaler;y=.5+(y-.5)*scaler;r=r*Math.pow(scaler,1);bmp.ctx.fillStyle=i==zoom.targetIndex?"#f00":"#000";bmp.ctx.beginPath();bmp.ctx.drawCircle(x*size,y*size,r*size);bmp.ctx.closePath();bmp.ctx.fill()}bmp.ctx.fillStyle="yellow";bmp.ctx.fillRect(cx*size-1,0,2,size);bmp.ctx.fillRect(0,cy*size-1,size,2);var xo=.5+(target.x-.5)*scaler;var yo=.5+(target.y-.5)*scaler;bmp.ctx.strokeStyle="green";bmp.ctx.beginPath();bmp.ctx.moveTo(cx*size,cy*size);bmp.ctx.lineTo(xo*size,yo*size);bmp.ctx.stroke();var half=geom.lerp({x:cx*size,y:cy*size},{x:xo*size,y:yo*size},zoomProgress);bmp.ctx.fillRect(half.x,half.y,10,10)}window.addEventListener("mousemove",function(e){zoom.amount=1+e.x/size*zoom.max;updateZoom()});function generate(){var planet=dom.canvas(size,size);var threads=0;var iterations=0;var circles=0,circlesLast=0,circlesSame=0;var gap=rand.getNumber(1e-4,.02);var minRadius=rand.getNumber(.001,.01);var maxRadius=rand.getNumber(minRadius+.02,.5);var maxDepth=1;function attemptNextCircle(parent,attempt){threads++;attempt++;if(attempt<5e3){attemptCircle(parent,attempt)}else{con.log("too many attempt")}}function attemptCircle(parent,attempt,options){threads--;iterations++;var depth,distance,dx,dy,other,r,radius,site,y,x;if(parent){if(!parent.sites.length){return}depth=parent.depth+1;var index=Math.floor(rand.random()*parent.sites.length);site=parent.sites.splice(index,1)[0];x=site.x;y=site.y;dx=parent.x-x;dy=parent.y-y;distance=Math.sqrt(dx*dx+dy*dy);radius=parent.r-distance-gap;r=rand.random()*radius;if(r>maxRadius){r=maxRadius}else if(r<minRadius){r=minRadius}if(r-gap<minRadius){return attemptNextCircle(parent,attempt)}var ok=true;for(var i=0,il=parent.children.length;i<il&&ok;i++){other=parent.children[i];dx=x-other.x;dy=y-other.y;distance=Math.sqrt(dx*dx+dy*dy);var distanceCombined=r+other.r+gap;if(distanceCombined>distance){r=distance-other.r-gap;if(r<minRadius){ok=false}}}if(ok===false){return attemptNextCircle(parent,attempt)}}else{x=cx;y=cy;r=.5;depth=0}var grid=.01;var rings=Math.ceil(r/grid);grid=r/rings;var sites=[];for(var ring=0;ring<rings;ring++){var perimeter=ring*grid*TAU;var segments=Math.ceil(perimeter/grid)||6;for(var segment=0;segment<segments;segment++){var siteRadius=(ring+rand.getNumber(0,1))*grid,siteAngle=(segment+rand.getNumber(0,1))/segments*TAU,siteX=x+Math.sin(siteAngle)*siteRadius,siteY=y+Math.cos(siteAngle)*siteRadius,site={x:siteX,y:siteY};sites.push(site)}}var circle={depth:depth,x:x,y:y,r:r,children:[],sites:sites};circles++;if(parent&&parent.children){parent.children.push(circle)}if(depth<maxDepth){for(var i=0,il=circle.sites.length;i<il;i++){attemptNextCircle(circle,0)}}return circle}var container=attemptCircle(null,0);return{canvas:planet.canvas,circles:container.children}}return{stage:bmp.canvas,init:init}};if(isNode){module.exports=circle_packing_zoom_loop()}else{define("circle_packing_zoom_loop",circle_packing_zoom_loop)}"use strict";var isNode=typeof module!=="undefined";if(isNode){var con=console;var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var circle_sectors=function circle_sectors(){var TAU=Math.PI*2;var QUADRANT=Math.PI/2;var centre=.5;var bmp=dom.canvas(1,1);var size;function init(options){size=options.size;bmp.setSize(size,size);colours.getRandomPalette();var rings=rand.getInteger(4,24);var ringStart=rand.getInteger(0,rings-1);var sectorsStart=rand.getInteger(2,16);var sectorsPower=rand.getInteger(2,3);var padding=rand.getNumber(0,.01);var sectorsMin=rand.getNumber(.02,.2);var dotty=rand.getNumber(0,1)>.8;var howDotty=rand.getNumber(.1,.8);var colourCycle=function(){var mode=rand.getInteger(0,2);con.log("colourCycle - mode:",mode);var ringLast=-1;var ringRegularCycle=rand.getNumber(0,1)>.6;switch(mode){case 0:return function(ring,sector){return colours.getRandomColour()};case 1:return function(ring,sector){return colours.getNextColour(ring)};case 2:return function(ring,sector){if(ring!=ringLast){ringLast=ring;return colours.getNextColour(ringRegularCycle||rand.getInteger(0,4))}else{return colours.getCurrentColour()}}}}();bmp.ctx.lineWidth=padding*size;for(var i=ringStart;i<rings;i++){if(dotty&&rand.getNumber(0,1)>howDotty)continue;var ringRadiusInner=i/rings*centre;var ringRadiusOuter=(i+1)/rings*centre;var perimeter=TAU*ringRadiusInner;var sectors=sectorsStart;while(perimeter/sectors>sectorsMin){sectors*=sectorsPower}for(var j=0;j<sectors;j++){var drawSector=function drawSector(){bmp.ctx.beginPath();bmp.ctx.moveTo(x0*size,y0*size);bmp.ctx.lineTo(x1*size,y1*size);bmp.ctx.arc(centre*size,centre*size,ringRadiusOuter*size,QUADRANT-angle0,QUADRANT-angle1,true);bmp.ctx.lineTo(x3*size,y3*size);bmp.ctx.arc(centre*size,centre*size,ringRadiusInner*size,QUADRANT-angle1,QUADRANT-angle0,false);bmp.ctx.closePath()};if(dotty&&rand.getNumber(0,1)>howDotty)continue;var angle0=j/sectors*TAU;var angle1=(j+1)/sectors*TAU;var x0=centre+Math.sin(angle0)*ringRadiusInner;var y0=centre+Math.cos(angle0)*ringRadiusInner;var x1=centre+Math.sin(angle0)*ringRadiusOuter;var y1=centre+Math.cos(angle0)*ringRadiusOuter;var x2=centre+Math.sin(angle1)*ringRadiusOuter;var y2=centre+Math.cos(angle1)*ringRadiusOuter;var x3=centre+Math.sin(angle1)*ringRadiusInner;var y3=centre+Math.cos(angle1)*ringRadiusInner;bmp.ctx.globalCompositeOperation="source-over";bmp.ctx.fillStyle=colourCycle(i,j);drawSector();bmp.ctx.fill();bmp.ctx.globalCompositeOperation="destination-out";drawSector();bmp.ctx.stroke()}}}return{stage:bmp.canvas,init:init}};if(isNode){module.exports=circle_sectors()}else{define("circle_sectors",circle_sectors)}"use strict";define("codevember",["exps_details"],function(experimentsDetails){var pixels=10;var cubeSize=400;var gridSize=440;var cubeDepth=50;var grid=[];var camera,scene,renderer;var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;var lightA,lightB,lightC;function cube(){var material=new THREE.MeshPhongMaterial({color:18555,specular:10086143,shininess:30});var geometry=new THREE.BoxGeometry(cubeSize,cubeSize,cubeDepth);var mesh=new THREE.Mesh(geometry,material);return mesh}function init(){createScene();createText()}function createText(){var codevember=experimentsDetails.getFeature("codevember");document.body.appendChild(dom.element("style",{innerText:["a { color: white; }","a:hover { color: #87d9ff; text-shadow: 0px 0px 16px #fff; }","div { box-sizing: border-box;}",".holder { color: white; display: block; position: absolute; overflow: auto;","top: 20%; left: 10%; height: 50%; border: 1px dashed rgba(255,255,255,0.4);"," transform: rotate3d(0.3, 0.5, 0.9, 8deg); width: 80%; z-index: 50; }",".item { display: block; clear: both; line-height: 25px; }",".day { color: #bcd1d6; display: inline-block; float: left; padding-right: 10px; text-align: right; width: 20%; }",".title { color: #999; display: inline-block; float: left; width: 80%; }",".clickable .title { color: #fff; }"].join(" ")}));var textHolder=dom.element("div",{className:"holder",innerHTML:"<h1>CODEVEMBER</H1>"});codevember.forEach(function(exp){var codeItem=exp.link?dom.element("a",{className:"item clickable",href:"/?"+exp.link}):dom.element("div",{className:"item"});var codeItemDay=dom.element("div",{className:"day",innerHTML:"Day "+exp.day});var codeItemTitle=dom.element("div",{className:"title",innerHTML:exp.title});textHolder.appendChild(codeItem);codeItem.appendChild(codeItemDay);codeItem.appendChild(codeItemTitle)});document.body.appendChild(textHolder)}function createScene(){scene=new THREE.Scene;scene.fog=new THREE.FogExp2(0,.002);camera=new THREE.PerspectiveCamera(120,sw/sh,1,2e4);scene.add(camera);lightA=new THREE.DirectionalLight(16769279,.19);lightA.position.set(0,1,.5);scene.add(lightA);lightB=new THREE.DirectionalLight(15787425,.15);lightB.position.set(-1,.5,.5);scene.add(lightB);lightC=new THREE.DirectionalLight(8453631,.18);lightC.position.set(0,-1,.25);scene.add(lightC);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);ambientLight=new THREE.AmbientLight(16777215,.2);scene.add(ambientLight);for(var p=0;p<pixels*pixels;p++){var c=cube();holder.add(c);var xi=p%pixels-pixels/2+.5;var yi=Math.floor(p/pixels)-pixels/2+.5;var x=xi*gridSize;var y=-yi*gridSize;var z=0;c.position.set(x,y,z);c.shift={speed:(.1+Math.random())*1e-4,position:0};grid.push(c)}document.body.appendChild(renderer.domElement);render(0)}function render(time){grid.forEach(function(c){c.shift.position=Math.sin(time*c.shift.speed)*20;c.position.z=c.shift.position});function moveLight(light,x,y,z){var sc=1e-5;light.position.set(Math.sin((time+1e4)*x*sc),Math.sin((time+1e4)*y*sc),Math.sin((time+1e4)*z*sc))}moveLight(lightA,15,17,12);moveLight(lightB,14,19,13);moveLight(lightC,20,18,16);camPos.x=Math.sin(time*12e-5)*50;camPos.y=Math.sin(time*17e-5)*50;camPos.z=400+Math.sin(time*3e-5)*300;camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init,resize:function resize(w,h){renderer.setSize(w,h);camera.aspect=w/h;camera.updateProjectionMatrix()}}});"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var rand=require("./rand.js")}var colours=function(){var random;if(rand){random=rand.random}else{random=Math.random;con.warn("!!!! colours is using native random")}var paletteIndex=-1,currentPalette=null;var colourIndex=0;var previewCSSAdded=false;function getRandomPalette(warning){if(warning)con.warn("Ensure you call getRandomPalette!");paletteIndex=~~(random()*palettes.length);currentPalette=palettes[paletteIndex];return currentPalette}function setRandomPalette(_paletteIndex){paletteIndex=_paletteIndex;currentPalette=palettes[paletteIndex]}function setPaletteRange(range){if(range>currentPalette.length)return con.warn("setPaletteRange - current palette has less than",range,"colours!");var palette=rand.shuffle(currentPalette.slice());currentPalette=palette.splice(0,range);return currentPalette}function getRandomColour(){if(currentPalette==null)getRandomPalette(true);colourIndex=~~(random()*currentPalette.length);return currentPalette[colourIndex]}function getCurrentColour(){if(currentPalette==null)getRandomPalette(true);return currentPalette[colourIndex]}function getNextColour(offset){if(currentPalette==null)getRandomPalette(true);if(offset!=undefined){colourIndex+=offset}else{colourIndex++}colourIndex+=currentPalette.length;colourIndex%=currentPalette.length;return currentPalette[colourIndex]}function channelToHex(c){var hex=c.toString(16);return hex.length==1?"0"+hex:hex}function rgbToHex(r,g,b){return"#"+channelToHex(r)+channelToHex(g)+channelToHex(b)}function hexToRgb(hex){var r=parseInt(hex.substr(1,2),16),g=parseInt(hex.substr(3,2),16),b=parseInt(hex.substr(5,2),16);return{r:r,g:g,b:b}}function mutateChannel(channel,amount,direction){var mutation=Math.round(channel+(random()-.5)*amount);mutation=mutation>255?255:mutation<=0?0:mutation;return mutation}function mutateHex(hex,amount){var rgb=hexToRgb(hex),r=rgb.r,g=rgb.g,b=rgb.b;r=mutateChannel(r,amount);g=mutateChannel(g,amount);b=mutateChannel(b,amount);return rgbToHex(r,g,b)}function mutateColour(colour,amount){var mutation=mutateHex(colour,amount);return mutation}function mixColours(colours){var mixed={r:0,g:0,b:0};for(var c=0,cl=colours.length;c<cl;c++){var hex=colours[c];var rgb=hexToRgb(hex);mixed.r+=rgb.r;mixed.g+=rgb.g;mixed.b+=rgb.b}mixed.r/=cl;mixed.g/=cl;mixed.b/=cl;mixed.r=parseInt(mixed.r);mixed.g=parseInt(mixed.g);mixed.b=parseInt(mixed.b);return rgbToHex(mixed.r,mixed.g,mixed.b)}function setColourIndex(index){colourIndex=index}function showPalette(){if(currentPalette==null)getRandomPalette(true);var p=dom.element("div");p.className="palette";p.id="palette-"+paletteIndex;for(var j=0;j<currentPalette.length;j++){var colour=currentPalette[j];var c=dom.element("div",{className:"colour",innerHTML:colour,style:{background:colour}});p.appendChild(c)}return p}function showColours(){addPreviewCSS();var h=document.createElement("div");for(var i=0;i<palettes.length;i++){paletteIndex=i;currentPalette=palettes[i];h.appendChild(showPalette())}document.body.appendChild(h);return h}function addPreviewCSS(){var css=[".palette {","\tclear: both;","\theight: 50px;"," margin-bottom: 20px","}",".colour {","\twidth: 100px;","\theight: 50px;","\tfloat: left;","\ttext-align: center;","\tfont-size: 10px;","\tline-height: 50px;","}"].join("");var style=dom.element("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}document.head.appendChild(style);previewCSSAdded=true}var palettes=[["#333","#ccc"],["#A0C9D9","#F2F0D0","#735438","#A64941","#0D0D0D"],["#D93D93","#629C27","#DEE300","#32393D","#FFFFFF"],["#36190A","#B2460B","#FF6818","#009AA3","#00ECD2"],["#1B69FF","#002875","#0143C2","#FFB002","#FF781E"],["#FFBE10","#FFAE3C","#FF7E49","#E85137","#333C3C"],["#0E1D22","#587077","#555555","#ECEBDF"],["#F2385A","#F5A503","#E9F1DF","#4AD9D9","#36B1BF"],["#E8463E","#611410","#FFCFCD","#038733","#63F598"],["#4F8499","#C95F5F","#003145","#012914","#FCD457"],["#406874","#84D9D9","#B8D9D3","#35402A","#592C1C"],["#8F8164","#D9D7AC","#4F6373","#293845","#14212B"],["#1C2623","#37A672","#E2CA63","#F2884B","#DB3323"],["#FFD7AE","#163A5C","#1D2328","#FE6200","#ADB7BD"],["#FFB919","#8C12B2","#C200FF","#14CC83","#09B26F"],["#8C1822","#BF1725","#594F46","#1C8476","#006B5E"],["#CF9CB3","#626161","#DEBC92","#B68256","#EDDFBB"],["#A6442E","#A65644","#BF7665","#D9A79C","#F2F2F2"],["#200101","#421C0C","#C9A860","#4FA35E","#076043"],["#435939","#737268","#D9D4BA","#D9D5C5","#0D0000"],["#467302","#97BF04","#D97904","#A62F03","#590902"],["#69D2E7","#A7DBD8","#E0E4CC","#F38630","#FA6900"],["#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","#83AF9B"],["#ECD078","#D95B43","#C02942","#542437","#53777A"],["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"],["#774F38","#E08E79","#F1D4AF","#ECE5CE","#C5E0DC"],["#E8DDCB","#CDB380","#036564","#033649","#031634"],["#490A3D","#BD1550","#E97F02","#F8CA00","#8A9B0F"],["#594F4F","#547980","#45ADA8","#9DE0AD","#E5FCC2"],["#00A0B0","#6A4A3C","#CC333F","#EB6841","#EDC951"],["#E94E77","#D68189","#C6A49A","#C6E5D9","#F4EAD5"],["#D9CEB2","#948C75","#D5DED9","#7A6A53","#99B2B7"],["#FFFFFF","#CBE86B","#F2E9E1","#1C140D","#CBE86B"],["#EFFFCD","#DCE9BE","#555152","#2E2633","#99173C"],["#3FB8AF","#7FC7AF","#DAD8A7","#FF9E9D","#FF3D7F"],["#343838","#005F6B","#008C9E","#00B4CC","#00DFFC"],["#413E4A","#73626E","#B38184","#F0B49E","#F7E4BE"],["#99B898","#FECEA8","#FF847C","#E84A5F","#2A363B"],["#FF4E50","#FC913A","#F9D423","#EDE574","#E1F5C4"],["#554236","#F77825","#D3CE3D","#F1EFA5","#60B99A"],["#351330","#424254","#64908A","#E8CAA4","#CC2A41"],["#00A8C6","#40C0CB","#F9F2E7","#AEE239","#8FBE00"],["#FF4242","#F4FAD2","#D4EE5E","#E1EDB9","#F0F2EB"],["#655643","#80BCA3","#F6F7BD","#E6AC27","#BF4D28"],["#8C2318","#5E8C6A","#88A65E","#BFB35A","#F2C45A"],["#FAD089","#FF9C5B","#F5634A","#ED303C","#3B8183"],["#BCBDAC","#CFBE27","#F27435","#F02475","#3B2D38"],["#D1E751","#FFFFFF","#000000","#4DBCE9","#26ADE4"],["#FF9900","#424242","#E9E9E9","#BCBCBC","#3299BB"],["#5D4157","#838689","#A8CABA","#CAD7B2","#EBE3AA"],["#5E412F","#FCEBB6","#78C0A8","#F07818","#F0A830"],["#EEE6AB","#C5BC8E","#696758","#45484B","#36393B"],["#1B676B","#519548","#88C425","#BEF202","#EAFDE6"],["#F8B195","#F67280","#C06C84","#6C5B7B","#355C7D"],["#452632","#91204D","#E4844A","#E8BF56","#E2F7CE"],["#F04155","#FF823A","#F2F26F","#FFF7BD","#95CFB7"],["#F0D8A8","#3D1C00","#86B8B1","#F2D694","#FA2A00"],["#2A044A","#0B2E59","#0D6759","#7AB317","#A0C55F"],["#67917A","#170409","#B8AF03","#CCBF82","#E33258"],["#B9D7D9","#668284","#2A2829","#493736","#7B3B3B"],["#BBBB88","#CCC68D","#EEDD99","#EEC290","#EEAA88"],["#A3A948","#EDB92E","#F85931","#CE1836","#009989"],["#E8D5B7","#0E2430","#FC3A51","#F5B349","#E8D5B9"],["#B3CC57","#ECF081","#FFBE40","#EF746F","#AB3E5B"],["#AB526B","#BCA297","#C5CEAE","#F0E2A4","#F4EBC3"],["#607848","#789048","#C0D860","#F0F0D8","#604848"],["#515151","#FFFFFF","#00B4FF","#EEEEEE"],["#3E4147","#FFFEDF","#DFBA69","#5A2E2E","#2A2C31"],["#300030","#480048","#601848","#C04848","#F07241"],["#1C2130","#028F76","#B3E099","#FFEAAD","#D14334"],["#A8E6CE","#DCEDC2","#FFD3B5","#FFAAA6","#FF8C94"],["#EDEBE6","#D6E1C7","#94C7B6","#403B33","#D3643B"],["#AAB3AB","#C4CBB7","#EBEFC9","#EEE0B7","#E8CAAF"],["#FDF1CC","#C6D6B8","#987F69","#E3AD40","#FCD036"],["#CC0C39","#E6781E","#C8CF02","#F8FCC1","#1693A7"],["#3A111C","#574951","#83988E","#BCDEA5","#E6F9BC"],["#FC354C","#29221F","#13747D","#0ABFBC","#FCF7C5"],["#B9D3B0","#81BDA4","#B28774","#F88F79","#F6AA93"],["#5E3929","#CD8C52","#B7D1A3","#DEE8BE","#FCF7D3"],["#230F2B","#F21D41","#EBEBBC","#BCE3C5","#82B3AE"],["#5C323E","#A82743","#E15E32","#C0D23E","#E5F04C"],["#4E395D","#827085","#8EBE94","#CCFC8E","#DC5B3E"],["#DAD6CA","#1BB0CE","#4F8699","#6A5E72","#563444"],["#5B527F","#9A8194","#C6A9A3","#EBD8B7","#99BBAD"],["#C2412D","#D1AA34","#A7A844","#A46583","#5A1E4A"],["#D1313D","#E5625C","#F9BF76","#8EB2C5","#615375"],["#9D7E79","#CCAC95","#9A947C","#748B83","#5B756C"],["#1C0113","#6B0103","#A30006","#C21A01","#F03C02"],["#8DCCAD","#988864","#FEA6A2","#F9D6AC","#FFE9AF"],["#CFFFDD","#B4DEC1","#5C5863","#A85163","#FF1F4C"],["#75616B","#BFCFF7","#DCE4F7","#F8F3BF","#D34017"],["#B6D8C0","#C8D9BF","#DADABD","#ECDBBC","#FEDCBA"],["#382F32","#FFEAF2","#FCD9E5","#FBC5D8","#F1396D"],["#E3DFBA","#C8D6BF","#93CCC6","#6CBDB5","#1A1F1E"],["#A7C5BD","#E5DDCB","#EB7B59","#CF4647","#524656"],["#413D3D","#040004","#C8FF00","#FA023C","#4B000F"],["#9DC9AC","#FFFEC7","#F56218","#FF9D2E","#919167"],["#A8A7A7","#CC527A","#E8175D","#474747","#363636"],["#EDF6EE","#D1C089","#B3204D","#412E28","#151101"],["#C1B398","#605951","#FBEEC2","#61A6AB","#ACCEC0"],["#FFEDBF","#F7803C","#F54828","#2E0D23","#F8E4C1"],["#7E5686","#A5AAD9","#E8F9A2","#F8A13F","#BA3C3D"],["#5E9FA3","#DCD1B4","#FAB87F","#F87E7B","#B05574"],["#951F2B","#F5F4D7","#E0DFB1","#A5A36C","#535233"],["#FFFBB7","#A6F6AF","#66B6AB","#5B7C8D","#4F2958"],["#000000","#9F111B","#B11623","#292C37","#CCCCCC"],["#EFF3CD","#B2D5BA","#61ADA0","#248F8D","#605063"],["#9CDDC8","#BFD8AD","#DDD9AB","#F7AF63","#633D2E"],["#FCFEF5","#E9FFE1","#CDCFB7","#D6E6C3","#FAFBE3"],["#84B295","#ECCF8D","#BB8138","#AC2005","#2C1507"],["#0CA5B0","#4E3F30","#FEFEEB","#F8F4E4","#A5B3AA"],["#4D3B3B","#DE6262","#FFB88C","#FFD0B3","#F5E0D3"],["#B5AC01","#ECBA09","#E86E1C","#D41E45","#1B1521"],["#4E4D4A","#353432","#94BA65","#2790B0","#2B4E72"],["#379F7A","#78AE62","#BBB749","#E0FBAC","#1F1C0D"],["#FFE181","#EEE9E5","#FAD3B2","#FFBA7F","#FF9C97"],["#A70267","#F10C49","#FB6B41","#F6D86B","#339194"],["#30261C","#403831","#36544F","#1F5F61","#0B8185"],["#2D2D29","#215A6D","#3CA2A2","#92C7A3","#DFECE6"],["#F38A8A","#55443D","#A0CAB5","#CDE9CA","#F1EDD0"],["#793A57","#4D3339","#8C873E","#D1C5A5","#A38A5F"]];return{getRandomPalette:getRandomPalette,getRandomColour:getRandomColour,getCurrentColour:getCurrentColour,getNextColour:getNextColour,getPalleteIndex:function getPalleteIndex(){return paletteIndex},setPalette:function setPalette(p){currentPalette=p},setRandomPalette:setRandomPalette,setColourIndex:setColourIndex,setPaletteRange:setPaletteRange,showPalette:showPalette,showColours:showColours,mutateColour:mutateColour,mixColours:mixColours}}();if(typeof module!=="undefined")module.exports=colours;"use strict";var isNode=typeof module!=="undefined";var con=console;if(isNode){var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var corona_sine=function corona_sine(){var vector=false;var settings={layers:{label:"Layers",min:1,max:30,cur:0,type:"Number"},rays:{label:"Rays",min:12,max:312,cur:0,type:"Number"},background:{type:"Boolean",label:"Background",cur:true}};var size,sw,sh,stage,ctx,inner,bmp;if(typeof window!="undefined"){sw=window.innerWidth;sh=window.innerHeight}if(vector){stage=dom.svg("svg",{width:sw,height:sh});inner=dom.svg("g");stage.appendChild(inner);ctx=stage;bmp=stage}else{var bmp=dom.canvas(100,100);stage=bmp.canvas;ctx=bmp.ctx}var lastGenerate,colourLayers,lengthLayers,colourBG,oscillators,oscs;function init(options){size=options.size;sw=options.sw||size;sh=options.sh||size;bmp.setSize(sw,sh);lastGenerate=(new Date).getTime();settings.layers.cur=~~(1+rand.random()*4);settings.rays.cur=~~(12+rand.random()*300);if(options.settings){settings=options.settings}progress("settings:initialised",settings);render(0)}function oscillate(rotation,time){var t=0;for(var o=0;o<oscillators;o++){t+=(Math.sin(oscs[o].offset+time*oscs[o].speed+rotation*oscs[o].phase)+1)/2}return t/oscillators}function renderLine(rotation,start,end,width,colour){if(end-start<width/4)return;if(vector){var curve=1.6;var d=["M",start,",",-width," L",end,-width," C",end+width*curve,",",-width," ",end+width*curve,",",width," ",end,",",width," L",end,",",width," L",start,",",width," C",start-width*curve,",",width," ",start-width*curve,",",-width," ",start,",",-width].join("");var path=dom.svg("path",{d:d,fill:colour,transform:"translate("+[sw/2,sh/2]+") rotate("+rotation*180/Math.PI+")"});inner.appendChild(path)}else{ctx.save();ctx.translate(sw/2,sh/2);ctx.rotate(rotation);ctx.beginPath();ctx.fillStyle=colour;ctx.moveTo(start,-width);ctx.lineTo(end,-width);ctx.arc(end,0,width,-Math.PI/2,Math.PI/2,false);ctx.lineTo(end,width);ctx.lineTo(start,width);ctx.arc(start,0,width,Math.PI/2,-Math.PI/2,false);ctx.fill();ctx.closePath();ctx.restore()}}function renderRay(frac,time,innerRadius,maxRadius,lineWidth){var layers=settings.layers.cur;var rotation=frac*Math.PI*2;var oscLength=oscillate(rotation,time);for(var l=0;l<layers;l++){var start=innerRadius+oscLength*maxRadius*lengthLayers[l]+lineWidth*2;var end=innerRadius+oscLength*maxRadius*lengthLayers[l+1]-lineWidth*2;renderLine(rotation,start,end,lineWidth,colourLayers[l])}}function update(s){rand.random();rand.random();settings=s;render()}function render(time){if(!time)time=0;colours.getRandomPalette();colourBG=colours.getRandomColour();var layers=settings.layers.cur;var rays=settings.rays.cur;colourLayers=[];lengthLayers=[0];for(var l=0;l<layers;l++){colourLayers.push(colours.getNextColour());lengthLayers.push(rand.random())}lengthLayers.sort();lengthLayers[layers]=1;oscillators=~~(1+rand.random()*13);oscs=[];for(var o=0;o<oscillators;o++){oscs.push({offset:rand.random()*Math.PI*2,phase:~~(rand.random()*6),speed:rand.random()*.003})}if(settings.background.cur){ctx.fillStyle=colourBG;ctx.fillRect(0,0,sw,sh)}else{ctx.clearRect(0,0,sw,sh)}var minDimension=sw>sh?sh:sw;var innerRadius=minDimension/2*.2;var outerRadius=minDimension/2*1;var maxRadius=outerRadius-innerRadius;var lineWidth=innerRadius*Math.tan(1/rays/2*Math.PI*2);var batchSize=100;function renderBatch(batch){var start=batch*batchSize,end=start+batchSize;if(end>rays)end=rays;for(var i=start;i<end;i++){var frac=i/rays;renderRay(frac,time,innerRadius,maxRadius,lineWidth)}if(end<rays){progress("render:progress",end/rays);setTimeout(function(){renderBatch(batch+1)},100)}else{progress("render:complete",stage)}}renderBatch(0)}function animate(time){requestAnimationFrame(animate);render(time)}var experiment={stage:stage,render:render,init:init,settings:settings,update:update};return experiment};if(isNode){module.exports=corona_sine()}else{define("corona_sine",corona_sine)}"use strict";define("cube_fractal_zoom",function(){var cubeSize=200;var gridSize=cubeSize*1.2;var camera,scene,renderer;var sw=window.innerWidth,sh=window.innerHeight;var lightA,lightB,lightC;var next,prev;var destRot={};function getIndex(p,num){var xi=p%num-num/2+.5;var yi=Math.floor(p/num)%num-num/2+.5;var zi=Math.floor(p/num/num)-num/2+.5;return{xi:xi,yi:yi,zi:zi}}function cubes(num){var grid=[];var group=new THREE.Group;holder.add(group);var inner=new THREE.Group;group.add(inner);for(var p=0;p<num*num*num;p++){var c=cube();inner.add(c);var _getIndex=getIndex(p,num),xi=_getIndex.xi,yi=_getIndex.yi,zi=_getIndex.zi;var x=xi*cubeSize;var y=yi*cubeSize;var z=zi*cubeSize;c.position.set(x,y,z);grid.push(c)}return{group:group,inner:inner,num:num,grid:grid}}function cube(){var material=new THREE.MeshPhongMaterial({color:9470064,specular:16777215,shininess:50});var geometry=new THREE.BoxGeometry(cubeSize,cubeSize,cubeSize);return new THREE.Mesh(geometry,material)}function init(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(100,sw/sh,1,2e4);scene.add(camera);camera.position.set(0,0,1500);camera.lookAt(scene.position);lightA=new THREE.DirectionalLight(16711680,1);scene.add(lightA);lightB=new THREE.DirectionalLight(12623872,1);scene.add(lightB);lightC=new THREE.DirectionalLight(16750848,1);scene.add(lightC);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);var lightAmbient=new THREE.AmbientLight(16769248,.2);scene.add(lightAmbient);prev=cubes(2);next=cubes(2);document.body.appendChild(renderer.domElement);render(0);setTimeout(zoomIn,1500)}function zoomIn(){next.group.scale.set(.001,.001,.001);var scale=prev.num;TweenMax.to(prev.group.scale,2.5,{x:scale,y:scale,z:scale,ease:Quad.easeInOut});var xi=0;var yi=xi;var zi=xi;var x=(xi+.5)*gridSize;var y=(yi+.5)*gridSize;var z=(zi+.5)*gridSize;TweenMax.to(prev.inner.position,2,{x:x,y:y,z:z,ease:Quad.easeInOut});prev.grid.forEach(function(c,index){var _getIndex2=getIndex(index,prev.num),xi=_getIndex2.xi,yi=_getIndex2.yi,zi=_getIndex2.zi;var x=xi*gridSize;var y=yi*gridSize;var z=zi*gridSize;TweenMax.to(c.position,1.5,{x:x,y:y,z:z,ease:Quad.easeInOut,delay:1})});destRot={x:rand.getNumber(-Math.PI,Math.PI),y:rand.getNumber(-Math.PI,Math.PI),z:rand.getNumber(-Math.PI,Math.PI)};TweenMax.to(prev.group.rotation,2.5,{x:destRot.x,y:destRot.y,z:destRot.z,ease:Quad.easeInOut,onComplete:zoomOver})}function zoomOver(){next.group.scale.set(1,1,1);next.group.rotation.set(destRot.x,destRot.y,destRot.z);var g=gridSize*4;prev.grid.forEach(function(c,index){var _getIndex3=getIndex(index,prev.num),xi=_getIndex3.xi,yi=_getIndex3.yi,zi=_getIndex3.zi;var x=xi*g;var y=yi*g;var z=zi*g;if(index!=0){TweenMax.to(c.position,2.5,{x:x,y:y,z:z,ease:Quad.easeIn});TweenMax.to(c.rotation,2.5,{x:rand.getNumber(-2,2),y:rand.getNumber(-2,2),z:rand.getNumber(-2,2),ease:Quint.easeIn})}TweenMax.to(c.scale,2.5,{x:0,y:0,z:0,ease:Quint.easeIn})});TweenMax.to({},2.5,{onComplete:zoomAgain})}function zoomAgain(){var temp=prev;prev=next;next=temp;next.group.scale.set(.001,.001,.001);next.inner.position.set(0,0,0);next.grid.forEach(function(c,index){var _getIndex4=getIndex(index,next.num),xi=_getIndex4.xi,yi=_getIndex4.yi,zi=_getIndex4.zi;var x=xi*cubeSize;var y=yi*cubeSize;var z=zi*cubeSize;c.position.set(x,y,z);c.rotation.set(0,0,0);c.scale.set(1,1,1)});setTimeout(zoomIn,1e3)}function render(time){function moveLight(light,x,y,z){var sc=4e-5;var t=time+1e4;light.position.set(Math.sin(t*x*sc),Math.sin(t*y*sc),Math.sin(t*z*sc))}moveLight(lightA,15,17,12);moveLight(lightB,14,19,13);moveLight(lightC,20,18,16);holder.rotation.z+=.005;holder.rotation.x+=.001;renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init}});"use strict";define("cube_pixelator",[],function(){var pixels=48;var cubeSize=8;var gridSize=10;var camera,scene,renderer;var mouse={x:0,y:0};var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;var holder;var controls;var grid=[];var rotations=[];var images=[];var currentImage=0;function cube(w,h,d,colour){var geometry=new THREE.PlaneGeometry(w,h,1);var material=new THREE.MeshLambertMaterial({color:colour});return new THREE.Mesh(geometry,material)}function init(){for(var p=0;p<pixels*pixels;p++){rotations.push({rotation:Math.random()})}var fn1=function fn1(){return createBitmap("cash",fn2)};var fn2=function fn2(){return createBitmap("marilyn",fn3)};var fn3=function fn3(){return createBitmap("hicks",fn4)};var fn4=function fn4(){setTimeout(createScene,200)};fn1()}function createBitmap(image,resolve){var img=new Image;img.onload=function(){if(img.width!=img.height){throw new Error("squares only mate!")}var scale=pixels/img.width;var bmp=dom.canvas(pixels,pixels);var ctx=bmp.ctx;ctx.scale(scale,scale);ctx.drawImage(img,0,0);var grayscale=[];var pixelData=ctx.getImageData(0,0,pixels,pixels).data;for(var p=0;p<pixelData.length;p+=4){var r=pixelData[p];grayscale.push({rotation:r/255})}images.push(grayscale);progress("render:progress",images.length/4);setTimeout(resolve,100)};img.src="./assets/"+image+".jpg"}function createScene(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(90,sw/sh,1,2e4);scene.add(camera);var lightAbove=new THREE.DirectionalLight(16777215,1);lightAbove.position.set(0,1,.5);scene.add(lightAbove);var lightLeft=new THREE.DirectionalLight(15787425,.5);lightLeft.position.set(-1,.5,.5);scene.add(lightLeft);var lightBelow=new THREE.DirectionalLight(3158064,.2);lightBelow.position.set(0,-1,.25);scene.add(lightBelow);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);for(var p=0;p<pixels*pixels;p++){var c=cube(cubeSize,cubeSize,cubeSize,16777215);holder.add(c);var xi=p%pixels-pixels/2+.5;var yi=Math.floor(p/pixels)-pixels/2+.5;var x=xi*gridSize;var y=-yi*gridSize;var z=0;c.position.set(x,y,z);c.rotateSpeed=Math.random()-.5;grid.push(c)}document.body.appendChild(renderer.domElement);render(0);setInterval(toggleImage,6e3);progress("render:complete",renderer.domElement)}var toggleImage=function toggleImage(){currentImage++;currentImage%=images.length;con.log("toggleImage",currentImage);var newRotations=images[currentImage].slice();for(var i=0;i<pixels*pixels;i++){TweenMax.to(rotations[i],3,{rotation:newRotations[i].rotation,easing:Back.easeInOut,delay:i*.001})}};function render(time){grid.forEach(function(c,index){c.rotation.x=Math.PI/4-rotations[index].rotation*Math.PI/3});camPos.x=0+Math.sin(time*12e-5)*50;camPos.y=0+Math.sin(time*17e-5)*50;camPos.z=400+Math.sin(time*1e-4)*300;camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init}});"use strict";define("depends",["dom","colours","rand","geom","exps"],function(dom,colours,rand,geom,exps){console.log("ok",arguments);exps()});"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var Canvas=require("canvas")}var dom=function(){function setProps(el,props){for(var p in props){if(p=="style"){for(var s in props[p]){el[p][s]=props[p][s]}}else{el[p]=props[p]}}return el}function setAttributes(el,attrs){for(var p in attrs){el.setAttribute(p,attrs[p])}return el}function element(element,props){var el=document.createElement(element);setProps(el,props);el.setSize=function(w,h){el.style.width=w+"px";el.style.height=h+"px"};return el}function canvas(w,h){var c;if(isNode){c=new Canvas(w,h)}else{c=element("canvas");c.width=w;c.height=h}var ctx=c.getContext("2d");var circleRads=Math.PI*2;ctx.drawCircle=function(x,y,r){ctx.arc(x,y,r,0,circleRads,false)};var setSize=function setSize(w,h,preserveCanvas){if(preserveCanvas){c.setSize(w,h)}else{c.width=w;c.height=h}};return{setSize:setSize,canvas:c,ctx:ctx}}function button(txt,props){props=props||{};if(props.innerHTML)con.warn("Specify butotn text as 1st param");props.innerHTML=txt;var b=element("button",props);return b}function svg(tag,props){var el=document.createElementNS("http://www.w3.org/2000/svg",tag);setAttributes(el,props);el.setSize=function(w,h){el.setAttribute("width",w);el.setAttribute("height",h)};el.clearRect=function(){};el.fillRect=function(){con.warn("svg.fillRect not implemented")};return el}function on(target,events,callback){for(var i=0,il=events.length;i<il;i++){target.addEventListener(events[i],callback)}}function off(target,events,callback){for(var i=0,il=events.length;i<il;i++){target.removeEventListener(events[i],callback)}}function trigger(target,events){for(var i=0,il=events.length;i<il;i++){target.dispatchEvent(events[i])}}return{element:element,canvas:canvas,button:button,svg:svg,on:on,off:off,trigger:trigger}}();if(isNode)module.exports=dom;"use strict";var isNode=typeof module!=="undefined";var experiment_template=function experiment_template(){var TAU=Math.PI*2;var sw,sw,cx,cy;var stage=dom.canvas(1,1);var ctx=stage.ctx;function init(options){size=options.size;sw=options.sw||size;sh=options.sh||size;stage.setSize(sw,sh);cx=sw/2;cy=sh/2;ctx.clearRect(0,0,sw,sh);ctx.fillStyle="#0f0";ctx.fillRect(cx-20,cy-20,40,40)}var experiment={stage:stage.canvas,init:init};progress("render:complete",stage.canvas);return experiment};if(isNode){module.exports=experiment_template()}else{define("experiment_template",experiment_template)}"use strict";var isNode=typeof module!=="undefined";var experiment_template_babel=function experiment_template_babel(){var settings={};var stage=dom.canvas(1,1);var canvas=stage.canvas,ctx=stage.ctx;var sw=void 0,sh=void 0,size=void 0;var init=function init(options){size=options.size;sw=options.sw||size;sh=options.sh||size;stage.setSize(sw,sh);colours.getRandomPalette();render()};var render=function render(){ctx.fillRect(0,0,sw,sh);var points=[];while(points.length<4){points.push({x:rand.getNumber(.1,.9),y:rand.getNumber(.1,.9)})}var intersects=geom.intersectionBetweenPoints.apply(null,points);if(intersects){points.push(intersects)}points.forEach(function(p){ctx.fillStyle=colours.getNextColour();ctx.beginPath();ctx.drawCircle(p.x*sw,p.y*sh,15);ctx.fill()})};var update=function update(settings){init({size:size,settings:settings})};progress("render:complete",canvas);return{init:init,render:render,settings:settings,stage:canvas,update:update}};if(isNode){module.exports=experiment_template_babel()}else{define("experiment_template_babel",experiment_template_babel)}"use strict";var progressBar;function progress(eventName,eventParam){con.log("experiments progress",eventName,eventParam);switch(eventName){case"render:progress":progressBar.style.width=eventParam*100+"%";progressBar.style.height="10px";break;case"render:complete":progressBar.style.height="0px";break}}function exps(experimentsDetails){var experiments=experimentsDetails.list;return function(){var info;var infoShowing=false;var interactedShowing=false;progressBar=dom.element("div",{id:"progress",style:{width:0,height:0}});document.body.appendChild(progressBar);var holder=dom.element("div",{id:"experiment-holder"});document.body.appendChild(holder);var buttonsNav=dom.element("div",{className:"exps-buttons"});document.body.appendChild(buttonsNav);var buttonClose=dom.button("X",{className:"exps-button"});buttonsNav.appendChild(buttonClose);dom.on(buttonClose,["click","touchend"],function(e){window.location="/"});var buttonInfo=dom.button("?",{className:"exps-button"});buttonsNav.appendChild(buttonInfo);dom.on(buttonInfo,["click","touchend"],showInfo);var panelInfo=dom.element("div",{className:"exps-info"});var panelInfoDetails=dom.element("div",{className:"exps-info-details"});var panelNav=dom.element("div",{className:"exps-buttons interacted"});var panelButtonClose=dom.button("X",{className:"exps-button"});dom.on(panelButtonClose,["click","touchend"],hideInfo);document.body.appendChild(panelInfo);panelInfo.appendChild(panelNav);panelNav.appendChild(panelButtonClose);panelInfo.appendChild(panelInfoDetails);function createStyleSheet(s){var link=dom.element("link");link.rel="stylesheet";link.type="text/css";link.href=s+".css";document.head.appendChild(link)}function loadExperiment(index){var src=experiments[index];require(src,function(experiment){if(experiment){con.log("require loaded...",experiment);experimentLoaded(experiment)}else{con.warn("require loaded... but experiment is null",experiment,arguments)}})}function showButtons(){buttonClose.style.display="none";buttonInfo.style.display="none";for(var e in experiments){var button=dom.element("button",{className:"exp"});dom.on(button,["click"],function(event){window.location="?"+event.target.key});var key=experiments[e][0];var title=key;var expDetails=experimentsDetails.getDetails(key);if(expDetails&&expDetails.title){title=expDetails.title}button.key=key;button.innerHTML=title;document.body.appendChild(button)}}function showInfo(){infoShowing=true;panelInfo.classList.add("displayed");panelInfoDetails.innerHTML="<h4>Experimental Graphics</h4>"+"<h1>"+info.title+"</h1>"+info.description+"<p><a href='https://github.com/raurir/experimental-graphics/blob/master/js/"+info.key+".js' target='_blank'>SRC on Github</a></p>"}function hideInfo(){panelInfo.classList.remove("displayed");infoShowing=false}if(window.location.search){var key=window.location.search.split("?")[1],index=0,found=false;var seed=key.split(",");if(seed[1]){key=seed[0];seed=seed[1];rand.setSeed(seed)}else{rand.setSeed()}while(index<experiments.length&&found==false){if(experiments[index][0]==key){found=true}else{index++}}loadExperiment(index);info=experimentsDetails.getDetails(key);if(info){info.key=key}else{buttonsNav.removeChild(buttonInfo)}dom.on(document.body,["click","touchstart"],function(e){if(interactedShowing)return;interactedShowing=true;buttonsNav.classList.add("interacted")})}else{showButtons()}var currentExperiment;function resize(){var sw=window.innerWidth,sh=window.innerHeight;if(currentExperiment.resize)currentExperiment.resize(sw,sh)}function initWindowListener(){dom.on(window,["resize"],resize)}function experimentLoaded(exp){currentExperiment=exp;if(currentExperiment.stage){holder.appendChild(currentExperiment.stage)}else{con.warn("experimentLoaded, but no stage:",currentExperiment.stage)}initWindowListener();currentExperiment.init({size:800});resize()}return{load:loadExperiment,experiments:experiments}}}define("exps",["exps_details"],exps);"use strict";define("exps_details",function(){var list=[["additive"],["aegean_sun"],["alien"],["anemone_three","THREE"],["any_image_url"],["attractor"],["ball_and_chain","THREE"],["bezier_flow"],["box","maze"],["circle_packing"],["circle_packing_zoom_loop"],["circle_sectors"],["codevember","THREE","TweenMax"],["corona_sine"],["creature"],["cube_fractal_zoom","THREE","TweenMax"],["cube_pixelator","THREE","TweenMax"],["experiment_template_babel"],["fool","css/fool"],["fur"],["frame_inverse"],["hexagon_tile"],["hex_rounded","THREE"],["infinite_scrolling_cogs"],["infinite_stairs","THREE"],["isometric_cubes"],["isometric_words","THREE","TweenMax"],["lego_stack","THREE"],["linked_line"],["mandala"],["maze"],["maze_cube","linked_line","THREE"],["meandering_polygons"],["mining_branches"],["molecular_three","THREE"],["nested_rotating_polygon","ease"],["oscillate_curtain"],["oscillator"],["overflow"],["pattern_check","css/pattern_check"],["pattern_circles"],["perlin_grid","THREE","TweenMax"],["perlin_leaves"],["perlin_noise"],["polyhedra","3d"],["polyhedra_three","THREE","../lib/stemkoski/polyhedra"],["pine_three","THREE"],["race_lines_three","THREE","TweenMax"],["rainbow_particles"],["rectangular_fill"],["recursive"],["recursive_circle"],["recursive_polygon"],["seven_four_sevens"],["spiral_even"],["squaretracer"],["synth_ambient","Tone"],["tea"],["tentacle"],["tetris_cube","THREE","TweenMax"],["text_grid"],["triangles","THREE","TweenMax"],["tunnel_tour_three","THREE","TweenMax"],["typography"],["voronoi_stripes","voronoi"],["zoned_particles"]];var details={ball_and_chain:{title:"Ball and Chain",description:"<p>In the celebration of the <a href='http://www.abc.net.au/news/2017-11-15/australia-reacts-to-the-same-sex-marriage-survey-results/9151826' target='_blank'>Yes</a> Vote, started making this ball and chain in THREE + Cannon. Took a bit longer than expected, hopefully I can make a rainbow happy one for legalisation day.</p><p>Something along the lines of \"It's raining ball and chains\"</p>"},cube_fractal_zoom:{title:"Cube Fractal Zoom",description:"<p>Zooming into a cube that subdivides into muliple cubes.</p><p>Envisioned version is for each subdivision to be variable slice amounts rather than 2x2x2. Someday.</p><p>Also would like some kind of infinite shader, potentially perlin noise.</p>"},cube_pixelator:{title:"Cube pixelator",description:"<p>Should be called 'Plane pixelator' since they are planes, not cubes.</p><p>Planes are distributed through a 2 dimensional grid with each plane representing a pixel.</p><p>Each plane is exactly the same colour and this colour never changes. Instead, each plane rotates accordingly to catch the lighting within the scene and by doing so adapts its apparent shade, and thereby creates an image.</p>"},frame_inverse:{title:"Frame Inverse",description:"<p>Drawing rectangles, aye...</p><p>listen to <a href='https://youngerbrothermusic.bandcamp.com/album/the-last-days-of-gravity' target='_blank'>Younger Brother - Last Days of Gravity</a>.</p>"},fur:{title:"Fur",description:"<p>2 channels of perlin noise affect x and y lean of each hair of fur.</p>"},hex_rounded:{title:"Hex Rounded",description:"<p>Hex Rounded? Some title, but that's what it's been dubbed since inception in 2014 or so. Never worked properly, so fixed it up for Codevember 2017.</p>"},infinite_scrolling_cogs:{title:"Infinite Scrolling Cogs",description:"<p>Remake of <a href='https://codepen.io/raurir/pen/eknLg' target='_blank'>an old experiment</a> this time it's scrolling, non ineractive and more of a toon rendering style.</p><p>The thing I liked the best about the original, and this algorithm, is the cogs are very close to mathematically correct; not only do they animate in a life like fashion on screen, I am confident a 3D print of the geometry involved would result in a smoothly running friction free machine.</p><p>This algorithm continually creates canvases with no garbage collection. It will crash the browser eventually, I imagine, but you'd be bored after a minute anyway?</p>"},infinite_stairs:{title:"Infinite Stairs",description:"<p>Work in progress</p><p>Trying to make an infinite staircase, potentially spooky.</p>"},isometric_words:{title:"Isometric Words",description:"<p>Muddling up cubes by using the simplicity of Isometric projection.</p><p>Randomly offset the objects along the same axis the camera is looking down.</p>"},lego_stack:{title:"Lego Stack",description:"<p>Important scientifically realistic simulation to study how high lego can be stacked.</p>"},recursive_circle:{title:"Recursive Circle",description:"<p>Recursive rendering. Managed to not crash my browser creating this! Life achievement.</p>"},seven_four_sevens:{title:"Seven Four Sevens",description:"<p>An old flash experiment remade in javascript.</p><p>Thanks to the demise of flash I will lose heaps of graphical experiments, some irretrievably lost due to inability to open .FLAs - luckily this one had the source in a .as file.</p>"},synth_ambient:{title:"Synth Ambient",description:"<h2>This will be loud!</h2><p>A quick trip into audio synthesis in the browser.</p><p>That's the thing about synthesis, you can create out of control waveforms quite easily, hence the volume.</p><p>Using <a href='https://github.com/Tonejs/Tone.js' target='_blank'>Tone.js</a> for all the audio generation, this experiment creates a number of randomised effects, a bunch of randomised synthesizers, and with those creates a randomised drum track, randomised chords and a ranomised arpeggio.</p>"},triangles:{title:"Triangles",description:"<p>A plane of triangles fall away as they zoom towards the screen.</p><p>Probably a bit heavy for phones.</p>"}};return{list:list,getDetails:function getDetails(exp){return details[exp]||false},getFeature:function getFeature(key){var features={codevember:[{day:1,title:details.cube_pixelator.title,link:"cube_pixelator"},{day:2,title:details.synth_ambient.title,link:"synth_ambient"},{day:3,title:"Refactored Experiments"},{day:4,title:"Made Codevember"},{day:5,title:"fail :("},{day:6,title:details.isometric_words.title,link:"isometric_words"},{day:7,title:"fail ..."},{day:8,title:details.cube_fractal_zoom.title,link:"cube_fractal_zoom"},{day:9,title:details.infinite_scrolling_cogs.title,link:"infinite_scrolling_cogs"},{day:10,title:"nope :|"},{day:11,title:details.infinite_stairs.title,link:"infinite_stairs"},{day:12,title:"much fail."},{day:13,title:details.seven_four_sevens.title,link:"seven_four_sevens"},{day:14,title:details.triangles.title,link:"triangles"},{day:15,title:"very..."},{day:16,title:"...lame!"},{day:17,title:details.ball_and_chain.title,link:"ball_and_chain"},{day:18,title:details.fur.title,link:"fur"},{day:19,title:details.recursive_circle.title,link:"recursive_circle"},{day:20,title:details.lego_stack.title,link:"lego_stack"},{day:21,title:details.hex_rounded.title,link:"hex_rounded"},{day:22,title:"faily McFail O'clock"},{day:23,title:details.frame_inverse.title,link:"frame_inverse"}]};return features[key]||false}}});"use strict";var sw=window.innerWidth,sh=window.innerHeight;var navOpen=true;function navClass(){return"nav"+(navOpen?" open":"")}var container=dom.element("div",{className:"container",style:{width:sw+"px",height:sh+"px"}});var nav=dom.element("div",{className:navClass()});var navMenu=dom.element("div",{className:"menu"});var navTab=dom.element("div",{className:"tab"});var navIcon=dom.element("ul",{className:"icon",innerHTML:["first","second","third"].map(function(a,i){return"<li class='"+a+"'></li>"}).join("")});var space=dom.element("div",{innerHTML:"Hello World!",className:"space"});container.appendChild(nav);nav.appendChild(navMenu);nav.appendChild(navTab);navTab.appendChild(navIcon);container.appendChild(space);document.body.appendChild(container);navTab.addEventListener("click",function(){navOpen=!navOpen;nav.className=navClass()});var options=[{label:"Hello",items:[{label:"A"},{label:"B"}]},{label:"World"},{label:"There",items:[{label:"May or"},{label:"May not"},{label:"Exist"},{label:"A"},{label:"Situation"}]},{label:"Is",items:[{label:"A Computer"},{label:"Behind you"}]}];var itemHeight=20;function navY(items){return(items+options.length)/2*-itemHeight+"px"}function createOption(option){var main=dom.element("div",{className:"main"});var button=dom.element("div",{className:"option",innerHTML:option.label});navMenu.appendChild(main);main.appendChild(button);if(option.items){var suboptions=dom.element("div",{className:"sub-options"});main.appendChild(suboptions);for(var j=0;j<option.items.length;j++){var suboption=option.items[j];var sub=dom.element("div",{className:"sub-option",innerHTML:suboption.label});suboptions.appendChild(sub)}button.addEventListener("click",function(e){if(lastSub){if(lastSub==suboptions)return;lastSub.style.height=0}setTimeout(function(){suboptions.style.height=option.items.length*itemHeight+"px"},400);lastSub=suboptions;navMenu.style.marginTop=navY(option.items.length)})}else{button.addEventListener("click",function(e){navMenu.style.marginTop=navY(0);if(lastSub){lastSub.style.height=0;lastSub=null}})}}var lastSub=null;for(var i=0;i<options.length;i++){createOption(options[i])}navMenu.style.marginTop=navY(0);window.addEventListener("resize",function(){sw=window.innerWidth;sh=window.innerHeight;container.setSize(sw,sh)});"use strict";define("frame_inverse",function(){var sw=window.innerWidth;var sh=window.innerHeight;var maxSize=rand.getInteger(100,300);var minSize=rand.getInteger(4,10);var maxBoxes=Math.floor(sw*sh/200);var cols=colours.getRandomPalette();var canvas=dom.canvas(sw,sh);var ctx=canvas.ctx;var pixels=[];var boxes=0;var renders=0;var f=rand.getNumber(0,1);var force=null;var VERTICAL=1,HORIZONTAL=2,SQUARE=3;if(f>.9){force=VERTICAL}else if(f>.8){force=HORIZONTAL}else if(f>.7){force=SQUARE}var i=0;while(i<sw){pixels[i]=[];var j=0;while(j<sh){pixels[i][j]=0;j++}i++}function getPixel(x,y){return pixels[x][y]}function draw(x,y,w,h,colour){ctx.fillStyle=colour;ctx.fillRect(x,y,w,h);var iw=x+w;var jh=y+h;var i=x;while(i<iw){var j=y;while(j<jh){pixels[i][j]=colour;j++}i++}boxes++}function go(){if(boxes<maxBoxes){if(renders%20){requestAnimationFrame(go);for(var t=0;t<2e3;t++){hitit()}}else{progress("render:progress",boxes/maxBoxes);setTimeout(go,200)}}else{progress("render:complete",canvas.canvas)}renders++}function hitit(){var i=rand.getInteger(0,sw-1);var j=rand.getInteger(0,sh-1);var targColor=getPixel(i,j);var dimLarge=rand.getNumber(minSize,maxSize);var dimSmall=rand.getNumber(1,minSize);var sizeX=dimLarge;var sizeY=dimSmall;switch(force){case HORIZONTAL:break;case VERTICAL:sizeX=dimSmall;sizeY=dimLarge;break;case SQUARE:sizeX=dimLarge;sizeY=dimLarge;break;default:if(rand.getNumber(0,1)>.5){sizeX=dimSmall;sizeY=dimLarge}}if(i+sizeX>sw||j+sizeY>sh){return}var k=i;while(k<i+sizeX){var l=j;while(l<j+sizeY){if(getPixel(k,l)!=targColor){return false}l++}k++}sizeX-=2;sizeY-=2;if(sizeX>=1&&sizeY>=1){var xp=i+1;var yp=j+1;col=cols[parseInt(Math.random()*5)];draw(xp,yp,sizeX,sizeY,col)}}function init(){var bg=colours.getRandomColour();cols.splice(cols.indexOf(bg),1);ctx.fillStyle=bg;ctx.fillRect(0,0,sw,sh);go()}return{init:init,stage:canvas.canvas}});"use strict";define("fur",["perlin"],function(perlin){var pixel=4;var furSize=20;var w=160;var h=160;var sw=w*pixel,sh=h*pixel;var c=dom.canvas(sw,sh);var d=c.ctx;var channelX=perlin.noise(w,h);var channelY=perlin.noise(w,h);var distort=[],distortion=4;for(var i=0,il=w*h;i<il;i++){var r=rand.getInteger(125,145);var g=rand.getInteger(105,125);var b=rand.getInteger(75,95);distort.push({x:rand.getNumber(-1,1)*distortion,y:rand.getNumber(-1,1)*distortion,colour:"rgba("+r+","+g+","+b+",0.5)"})}function drawIt(time){requestAnimationFrame(drawIt);var t=time*.002;var scale=.004;var leanX=channelX.cycle(t,scale);var leanY=channelY.cycle(t,scale);d.fillStyle="black";d.fillRect(0,0,sw,sh);for(var i=0,il=w*h;i<il;i++){var xi=i%w;var yi=Math.floor(i/w);var lx=leanX[i]-.5;var ly=leanY[i]-.5;var x=(distort[i].x+xi+.5)*pixel;var y=(distort[i].y+yi+.5)*pixel;d.strokeStyle=distort[i].colour;d.beginPath();d.moveTo(x,y);d.lineTo(x+15+lx*furSize,y+5+ly*furSize);d.stroke()}}return{resize:function resize(w,h){c.setSize(w,h,true)},init:function init(){drawIt(0)},stage:c.canvas}});"use strict";var con=con||console;var geom=function(){function intersectionBetweenPoints(p0,p1,p2,p3){var p0_x=p0.x,p0_y=p0.y,p1_x=p1.x,p1_y=p1.y,p2_x=p2.x,p2_y=p2.y,p3_x=p3.x,p3_y=p3.y;if(p0_x==p2_x&&p0_y==p2_y)return null;if(p0_x==p3_x&&p0_y==p3_y)return null;if(p1_x==p2_x&&p1_y==p2_y)return null;if(p1_x==p3_x&&p1_y==p3_y)return null;var s1_x,s1_y,s2_x,s2_y;s1_x=p1_x-p0_x;s1_y=p1_y-p0_y;s2_x=p3_x-p2_x;s2_y=p3_y-p2_y;var s,t;s=(-s1_y*(p0_x-p2_x)+s1_x*(p0_y-p2_y))/(-s2_x*s1_y+s1_x*s2_y);t=(s2_x*(p0_y-p2_y)-s2_y*(p0_x-p2_x))/(-s2_x*s1_y+s1_x*s2_y);if(s>=0&&s<=1&&t>=0&&t<=1){return{x:p0_x+t*s1_x,y:p0_y+t*s1_y}}return null}function linearEquationFromPoints(p0,p1){var dx=p1.x-p0.x;var dy=p1.y-p0.y;if(dx==0||dx>-1e-6&&dx<1e-6){con.warn("divide by zero error in geom.linearEquationFromPoints");return{c:null,m:dy>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,x:p0.x}}var m=dy/dx;var c=p0.y-m*p0.x;return{c:c,m:m}}function intersectionAnywhere(p0,p1,p2,p3){var intersectionX,intersectionY;var line0=linearEquationFromPoints(p0,p1);var line1=linearEquationFromPoints(p2,p3);var isLine1Vertical=line0.c===null;var isLine2Vertical=line1.c===null;if(isLine1Vertical&&isLine2Vertical){return null}else if(isLine1Vertical){intersectionX=line0.x;intersectionY=line1.m*intersectionX+line1.c}else if(isLine2Vertical){intersectionX=line1.x;intersectionY=line0.m*intersectionX+line0.c}else{if(line0.m-line1.m==0){return null}else{intersectionX=(line1.c-line0.c)/(line0.m-line1.m);intersectionY=line0.m*intersectionX+line0.c}}if(intersectionY==0){con.log("intersectionY IS 0!",isLine1Vertical,isLine2Vertical,line0,line1);con.log("intersectionY p0 p1",p0,p1);con.log("intersectionY p2 p3",p2,p3)}return{x:intersectionX,y:intersectionY}}function pointInPolygon(polygon,point){var nvert=polygon.length;if(nvert&&nvert>=3&&point.x!==undefined&&point.y!==undefined){var testx=point.x;var testy=point.y;var i,j,c=false;for(i=0,j=nvert-1;i<nvert;j=i++){var vxi=polygon[i].x;var vyi=polygon[i].y;var vxj=polygon[j].x;var vyj=polygon[j].y;if(vyi>testy!=vyj>testy&&testx<(vxj-vxi)*(testy-vyi)/(vyj-vyi)+vxi){c=!c}}return c}else{if(nvert<3){con.warn("pointInPolygon error - polygon has less than 3 points",polygon)}else{con.warn("pointInPolygon error - invalid data vertices:",nvert,"polygon:",polygon,"point:",point)}return null}}function linearInterpolate(a,b,ratio){return{x:a.x+(b.x-a.x)*ratio,y:a.y+(b.y-a.y)*ratio}}function perpendincularPoint(a,b,distance){var p={x:a.x-b.x,y:a.y-b.y};var n={x:-p.y,y:p.x};var normalisedLength=Math.sqrt(n.x*n.x+n.y*n.y);n.x/=normalisedLength;n.y/=normalisedLength;return{x:distance*n.x,y:distance*n.y}}function parallelPoints(p0,p1,offset){var per=perpendincularPoint(p0,p1,offset);var parrallel0={x:p0.x+per.x,y:p0.y+per.y};var parrallel1={x:p1.x+per.x,y:p1.y+per.y};return[parrallel0,parrallel1]}function insetPoints(points,offset){var parallels=[],insets=[];for(var i=0,il=points.length;i<il;i++){var pp0=points[i];var pp1=points[(i+1)%il];parallels.push(parallelPoints(pp0,pp1,offset))}con.log("parallels.length",parallels.length);for(i=0,il=parallels.length;i<il;i++){var parallel0=parallels[i];var parallel1=parallels[(i+1)%il];var intersection=intersectionAnywhere(parallel0[0],parallel0[1],parallel1[0],parallel1[1]);con.log("intersection",intersection);var inside=pointInPolygon(points,intersection);if(inside){insets.push(intersection)}else{con.warn("geom.insetPoints fail, not inside");return null}}return insets}return{insetPoints:insetPoints,intersectionAnywhere:intersectionAnywhere,intersectionBetweenPoints:intersectionBetweenPoints,lerp:linearInterpolate,linearEquationFromPoints:linearEquationFromPoints,parallelPoints:parallelPoints,perpendincularPoint:perpendincularPoint,pointInPolygon:pointInPolygon}}();if(typeof module!=="undefined")module.exports=geom;"use strict";define("hex_rounded",function(){var camera;var renderer;var stageWidth=500;var stageHeight=500;function init(){var interaction=false;var mouse={x:0,y:0};var mouseActual={x:0,y:0};var scene=new THREE.Scene;scene.fog=new THREE.Fog(0,100,5e3);var cameraTarget={x:0,y:0,z:0};camera=new THREE.PerspectiveCamera(100,stageWidth/stageHeight,1,2e4);camera.position.x=0;camera.position.z=-5e3;var lightWhite=new THREE.PointLight(16777215,1,1e4);scene.add(lightWhite);lightWhite.position.set(0,0,-5e3);var group=new THREE.Object3D;scene.add(group);renderer=new THREE.WebGLRenderer;renderer.setSize(stageWidth,stageHeight);document.body.appendChild(renderer.domElement);var hexs=[];var hexsTargetable=[];var fireflies=[];var radius=600;var perRow=11;var numHexs=perRow*perRow;var xGap=radius*2*-Math.cos(30*Math.PI/180);var yGap=radius*3*Math.sin(30*Math.PI/180);var xOffset=perRow/2*-xGap;var yOffset=perRow/2*-yGap;var numFireflies=10;function ran(max){return(Math.random()-.5)*max}function addHex(x,y,z,isEdge){var bevelThickness=radius*.1;var innerRadius=(radius-bevelThickness)*.8;var shape=new THREE.Shape;var edges=6;function polygon(i,edges){var angle=i/edges*Math.PI*2,nextAngle=(i+1)/edges*Math.PI*2,nextNextAngle=(i+2)/edges*Math.PI*2,xp=Math.sin(angle)*innerRadius,yp=Math.cos(angle)*innerRadius,nxp=Math.sin(nextAngle)*innerRadius,nyp=Math.cos(nextAngle)*innerRadius,nnxp=Math.sin(nextNextAngle)*innerRadius,nnyp=Math.cos(nextNextAngle)*innerRadius;var rounded=.2;var startStraightX=xp+(nxp-xp)*rounded;var startStraightY=yp+(nyp-yp)*rounded;var endStraightX=nxp-(nxp-xp)*rounded;var endStraightY=nyp-(nyp-yp)*rounded;var endCurveX=nxp+(nnxp-nxp)*rounded;var endCurveY=nyp+(nnyp-nyp)*rounded;if(i==0){shape.moveTo(startStraightX,startStraightY)}shape.lineTo(endStraightX,endStraightY);shape.quadraticCurveTo(nxp,nyp,endCurveX,endCurveY)}for(var i=0;i<edges;i++){polygon(i,edges)}var height=100+Math.random()*radius;var colour=height>radius*.9?9453568:5263440;var extrudeSettings={amount:height,bevelEnabled:true,bevelSegments:1,steps:1,bevelThickness:bevelThickness};var g=shape.extrude(extrudeSettings);var m=new THREE.MeshPhongMaterial({color:colour});var hex=new THREE.Mesh(g,m);group.add(hex);hex.move=function(){this.undecided+=ran(.5);this.kindadecided-=(this.kindadecided-this.undecided)*.1;this.dir-=(this.dir-this.kindadecided)*.1;this.position.z+=this.dir};hex.reset=function(){hex.undecided=ran(.5);hex.kindadecided=ran(.5);hex.dir=hex.kindadecided;hex.position.set(x,y,z-height)};hex.reset();return hex}for(var i=0;i<numHexs;i++){var row=Math.floor(i/perRow);var col=i%perRow+(row%2==0?.5:0);var isEdge=col<2||col>perRow-2.5||row<2||row>perRow-2.5;var x=xOffset+col*xGap;var y=yOffset+row*yGap;var hex=addHex(x,y,0,isEdge);hexs.push(hex);if(!isEdge){hexsTargetable.push(hex)}}function addFirefly(){var fly=new THREE.Object3D;group.add(fly);var below=Math.random()>.7;function light(){return 160+ran(96)}var colour=light()<<16|light()<<8|light();var f=200;var geometry=new THREE.BoxGeometry(f,f,f);var material=new THREE.MeshPhongMaterial({color:colour,shininess:1,shading:THREE.SmoothShading});var light=new THREE.PointLight(colour,5,2e3);fly.add(light);fly.position.set(ran(1e3),ran(1e3),below?200:-2e3+ran(1e3));fly.v=20+ran(10);fly.vx=ran(10);fly.vy=ran(10);fly.vz=ran(10);fly.undecided=ran(Math.PI);fly.kindadecided=ran(Math.PI);fly.dir=fly.kindadecided;fly.move=function(){this.undecided+=ran(.5);this.kindadecided-=(this.kindadecided-this.undecided)*.1;this.dir-=(this.dir-this.kindadecided)*.1;this.ax=Math.sin(this.dir)*this.v;this.ay=Math.cos(this.dir)*this.v;this.position.x+=this.ax;this.position.y+=this.ay;var limit=4e3;if(this.position.x<-limit)this.position.x=limit;if(this.position.x>limit)this.position.x=-limit;if(this.position.y<-limit)this.position.y=limit;if(this.position.y>limit)this.position.y=-limit};return fly}for(var i=0;i<numFireflies;i++){fireflies[i]=addFirefly()}function pickOne(){return hexsTargetable[~~(Math.random()*hexsTargetable.length)]}var target=pickOne();var loop=0;function render(t){requestAnimationFrame(render);if(loop<Math.floor(t/4e3)){loop++;target=pickOne();group.position.z=2e3;for(var i=0;i<numHexs;i++){hexs[i].reset(t,i)}}for(var i=0;i<numFireflies;i++){fireflies[i].move(t,i)}for(var i=0;i<numHexs;i++){hexs[i].move(t,i)}camera.position.x-=(camera.position.x-target.position.x)*.02;camera.position.y-=(camera.position.y-target.position.y)*.02;cameraTarget.x-=(cameraTarget.x-mouse.x*5)*.2;cameraTarget.y-=(cameraTarget.y-mouse.y*5)*.2;camera.lookAt(new THREE.Vector3(camera.position.x-cameraTarget.x,camera.position.y-cameraTarget.y,0));group.position.z-=35;target.position.z+=40;renderer.render(scene,camera)}dom.on(window,["mousemove","touchmove"],function(e){if(interaction){var event=e.changedTouches&&e.changedTouches[0]||e;event.x=event.x||event.pageX;event.y=event.y||event.pageY;mouse.x=event.x-stageWidth/2;mouse.y=event.y-stageHeight/2}});dom.on(window,["mousedown","touchstart"],function(e){interaction=true});dom.on(window,["mouseup","touchend"],function(e){interaction=false});render(0)}return{init:init,resize:function resize(w,h){stageWidth=w;stageHeight=h;renderer.setSize(w,h);camera.aspect=w/h;camera.updateProjectionMatrix()}}});"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var hexagon_tile=function hexagon_tile(){var spreadSeed;var spreadGradient=.1;function getJitter(){spreadSeed+=1.89127398;return(Math.sin(spreadSeed)+Math.cos(spreadSeed*2.12387891))/2*.1}var size=100,vector=false,sw=size,sh=size,angle60=2*Math.PI/6,radiusOuter,strokeSize,radiusInner,smoothSize,randomHexes,stage,inner,hexagons,hexs,batchSize=1e3,batches,currentBatch=0;var stage,inner;var settings={spread:{type:"Number",label:"Spread",min:1,max:10,cur:10},background:{type:"Boolean",label:"Background",cur:true}};if(vector){stage=dom.svg("svg",{width:sw,height:sh});inner=dom.svg("g");stage.appendChild(inner)}else{stage=dom.canvas(sw,sh)}function init(options){spreadSeed=rand.getSeed();spreadGradient=rand.getLastRandom()*.5;size=options.size;sw=options.sw||size;sh=options.sh||size;stage.setSize(sw,sh);settings.spread.cur=10;settings.background.cur=true;if(options.settings){settings=options.settings}progress("settings:initialised",settings);var palette=colours.getRandomPalette();var backgroundColor=colours.getRandomColour();radiusOuter=(5+rand.random()*25)/1e3;strokeSize=rand.random()*rand.random()*rand.random()*radiusOuter;radiusInner=radiusOuter-strokeSize+strokeSize*.01;smoothSize=.01+rand.random()*10;if(vector){while(inner.firstChild){inner.removeChild(inner.firstChild)}stage.setAttribute("style","background-color:"+backgroundColor)}else{if(settings.background.cur){stage.ctx.fillStyle=backgroundColor;stage.ctx.fillRect(0,0,size,size)}}var path=[],points=[];for(var i=0;i<6;i++){var angle=i*angle60,x=radiusInner*Math.cos(angle),y=radiusInner*Math.sin(angle);path[i]=(i===0?"M":"L")+x+","+y;points[i]={x:x,y:y}}path.push("Z");var minHeight=radiusOuter*Math.sin(angle60);var cols=Math.ceil(1/radiusOuter/3)+1;var rows=Math.ceil(1/minHeight)+1;hexagons=cols*rows;hexs=[];for(var i=0;i<hexagons;i++){var row=Math.floor(i/cols);var second=row%2==0;var col=i%cols+(second?.5:0);var x=col*radiusOuter*3;var y=row*minHeight;var hex;if(vector){var group=dom.svg("g");group.setAttribute("transform","translate("+x+","+y+")");inner.appendChild(group);hex=dom.svg("path",{d:path.join(" ")});group.appendChild(hex)}else{hex=points}hexs[i]={index:i,hex:hex,x:x,y:y,colour:null,rendered:false}}randomHexes=rand.shuffle(hexs.slice());render()}function batch(){var shouldRender=settings.spread.cur/settings.spread.max*10;con.log("shouldRender",shouldRender);var maxRender=hexagons;var loopStart=currentBatch*batchSize,loopEnd=loopStart+batchSize;if(loopEnd>maxRender)loopEnd=maxRender;for(var h=loopStart;h<loopEnd;h++){var index=randomHexes[h].index;var item=hexs[index];var close=[];for(var i=0;i<hexagons;i++){if(i!=h){var otherItem=randomHexes[i];if(otherItem.rendered){var dx=item.x-otherItem.x,dy=item.y-otherItem.y,d=Math.sqrt(dx*dx+dy*dy);if(d<radiusOuter*smoothSize){close.push(otherItem.colour)}}}}var colour;if(close.length>0){colour=colours.mixColours(close)}else{colour=colours.getNextColour()}if(vector){item.hex.setAttribute("style","fill:"+colour)}else{var dx=item.x-.5+getJitter(),dy=item.y-.5+getJitter();var distanceFromCenter=Math.round(Math.sqrt(dx*dx+dy*dy)*10);if(distanceFromCenter<shouldRender){stage.ctx.fillStyle=colour;stage.ctx.beginPath();for(var i=0;i<6;i++){var x=(item.x+item.hex[i].x)*size,y=(item.y+item.hex[i].y)*size;if(i===0){stage.ctx.moveTo(x,y)}else{stage.ctx.lineTo(x,y)}}stage.ctx.closePath();stage.ctx.fill()}}hexs[index].rendered=true;hexs[index].colour=colour}currentBatch++;if(currentBatch==batches){progress("render:complete",experiment.stage)}else{progress("render:progress",currentBatch/batches);setTimeout(batch,25)}}function render(){batches=Math.ceil(hexagons/batchSize);currentBatch=0;batch()}function update(settings){init({size:size,settings:settings})}var experiment={init:init,render:render,settings:settings,stage:vector?stage:stage.canvas,update:update};return experiment};if(isNode){module.exports=hexagon_tile()}else{define("hexagon_tile",hexagon_tile)}"use strict";define("infinite_scrolling_cogs",function(){var sw=window.innerWidth,sh=window.innerHeight;function makeCanvas(w,h){var can=document.createElement("canvas");can.width=w;can.height=h;return can}var stage=makeCanvas(sw,sh);function init(){var context=stage.getContext("2d");var padding=5;var cogs=[];var prevCog;var pi=3.14159265;var pi2=pi*2;var dir=-1;var cx=.5*sw;var cy=0;var tr=0;var ang=0;var speed=.02;var cogNumber=0;var holeStyle={fillStyle:"#000",lineWidth:0};var curvature=1.7;function number(min,max){return Math.random()*(max-min)+min}function integer(min,max){return~~number(min,max+1)}function colourGrey(options){var defaults={darkest:0,lightest:255,alpha:1};for(var p in options){defaults[p]=options[p]}var white=defaults.white?defaults.white:integer(defaults.darkest,defaults.lightest);var r=g=b=white;var a=defaults.alpha;return"rgba("+r+","+g+","+b+","+a+")"}function drawCircle(c,x,y,r,style,antiClockwise,renderNow){c.moveTo(x+r,y);if(antiClockwise==undefined)antiClockwise=false;var defaults={fillStyle:"#fff",lineWidth:0,strokeStyle:"#000"};for(var p in style){defaults[p]=style[p]}c.fillStyle=defaults.fillStyle;c.lineWidth=defaults.lineWidth;c.strokeStyle=defaults.strokeStyle;if(renderNow)c.beginPath();c.arc(x,y,r,0,pi2,antiClockwise);if(renderNow){c.closePath();if(defaults.fillStyle)c.fill();if(defaults.lineWidth)c.stroke()}}function createCog(forceX,forceY){var ctx;var size;prevCog=cogs[cogNumber-1];if(forceX&&forceY&&prevCog){var dy=forceY-prevCog.yp;var dx=forceX-prevCog.xp;ang=Math.atan(dy/dx);ang+=dx<0?pi:0;dx=Math.abs(dx);dy=Math.abs(dy);dx-=Math.abs(prevCog.size);dy-=Math.abs(prevCog.size);size=Math.sqrt(dx*dx+dy*dy)}else{ang=number(0,pi2);size=number(60,100)}if(size<50||size>400){return}var teeth=~~(size/10);dir*=-1;if(cogNumber){tr+=size-10;cx+=tr*Math.cos(ang);cy+=tr*Math.sin(ang)}tr=size-10;var minRad=size-25;var maxRad=size;var verts=[];var step=pi2/(teeth*4);var mod=0;var oddEven=0;var halfRadius=(maxRad-minRad)/curvature+minRad;var realX,realY,halfX,halfY;for(var j=0;j<teeth*4;j++){var i=j*step;var topBottomLand=~~mod%2;var r=topBottomLand*(maxRad-minRad)+minRad;mod+=.5;oddEven+=1;var angle=i-step/2;realX=r*Math.cos(angle);realY=r*Math.sin(angle);if(oddEven%2==0){v={tb:topBottomLand,ex:realX,ey:realY}}else{halfX=halfRadius*Math.cos(i-step);halfY=halfRadius*Math.sin(i-step);v={tb:topBottomLand,mp:true,ex:realX,ey:realY,mx:halfX,my:halfY}}verts.push(v)}function drawBand(minRadius,maxRadius){if(number(0,1)<.3)return;var midRadius=(maxRadius+minRadius)/2;var bandSize=maxRadius-minRadius;drawCircle(ctx,0,0,midRadius,{fillStyle:null,strokeStyle:colourGrey({darkest:0,lightest:40,alpha:.5}),lineWidth:bandSize},false,true)}function drawCutouts(minRadius,maxRadius){var midRadius=(maxRadius+minRadius)/2;var bandSize=maxRadius-minRadius;if(integer(0,1)==0){generateHoles(midRadius,bandSize)}else{generateSegment(midRadius,bandSize)}}function generateHoles(midRadius,bandSize){var holeSize=bandSize/2*number(.6,.9);var holes=~~(number(.5,.9)*pi2*midRadius/holeSize/2);holeSize*=number(.5,.9);for(var i=0;i<holes;i++){var angle=i/holes*pi2;drawCircle(ctx,midRadius*Math.cos(angle),midRadius*Math.sin(angle),holeSize,holeStyle,true)}}function generateSegment(midRadius,bandSize){var capped=integer(0,1)==0;var segments=~~Math.pow(teeth,1/(capped?integer(2,4):integer(2,3)))+1;var holeSize=number(.5,.8)*bandSize;var segmentSize=(pi2/segments-(Math.asin(holeSize/midRadius)*capped?1:.5))*number(.5,.9);var innerRadius=midRadius-holeSize/2;var outerRadius=midRadius+holeSize/2;for(var i=0;i<segments;i++){var startAngle=i/segments*pi2;var endAngle=startAngle+segmentSize;ctx.moveTo(Math.cos(startAngle)*innerRadius,Math.sin(startAngle)*innerRadius);ctx.arc(0,0,innerRadius,startAngle,endAngle,false);if(capped){ctx.arc(Math.cos(endAngle)*midRadius,Math.sin(endAngle)*midRadius,holeSize/2,endAngle+pi,endAngle,true)}else{ctx.lineTo(Math.cos(endAngle)*outerRadius,Math.sin(endAngle)*outerRadius)}ctx.arc(0,0,outerRadius,endAngle,startAngle,true);if(capped){ctx.arc(Math.cos(startAngle)*midRadius,Math.sin(startAngle)*midRadius,holeSize/2,startAngle,startAngle+pi,true)}else{ctx.lineTo(Math.cos(startAngle)*innerRadius,Math.sin(startAngle)*innerRadius)}}}var cog={index:cogNumber,size:size,rotation:number(0,pi2),teeth:teeth,dir:dir,xp:cx,yp:cy,canvas:null};if(cogNumber){prevCog=cogs[cogNumber-1];cog.rotation=prevCog.teeth/cog.teeth*-prevCog.rotation+ang*(prevCog.teeth+cog.teeth)/cog.teeth;if(cog.teeth%2==0){cog.rotation+=pi2/(cog.teeth*2)}}cog.render=function(){var dims=(this.size+padding)*2;this.canvas=makeCanvas(dims,dims);ctx=this.canvas.getContext("2d");ctx.save();ctx.translate(this.size+padding,this.size+padding);ctx.shadowBlur=2;ctx.shadowColor="#000";ctx.beginPath();v=verts[0];ctx.moveTo(v.ex,v.ey);for(var i=1;i<verts.length;i++){var v=verts[i];if(v.mp){ctx.quadraticCurveTo(v.mx,v.my,v.ex,v.ey)}else{ctx.lineTo(v.ex,v.ey)}}v=verts[0];ctx.quadraticCurveTo(v.mx,v.my,v.ex,v.ey);var axleSize=minRad*.2;drawCircle(ctx,0,0,minRad*.2,holeStyle,true);drawCutouts(axleSize+minRad*.1,minRad*.9);ctx.closePath();ctx.fillStyle=colourGrey({darkest:70,lightest:200,alpha:1});ctx.fill();ctx.stroke();if(Math.random()>.5){drawCircle(ctx,0,0,minRad*.16,holeStyle,true,true)}ctx.globalCompositeOperation="source-atop";drawBand(axleSize,axleSize+minRad*.1);drawBand(minRad*.9,minRad)};cog.draw=function(){if(!cog.canvas){cog.render()}context.save();context.translate(this.xp,this.yp);context.rotate(this.rotation);context.drawImage(this.canvas,-this.size-padding,-this.size-padding);context.restore()};cog.rotate=function(){this.rotation+=pi2/this.teeth*this.dir*speed;this.draw()};cogs[cogNumber]=cog;cogNumber++}var scrollY=0;function onLoop(){requestAnimationFrame(onLoop);scrollY--;if(scrollY-sh-200<-cy){incrementCog()}context.fillStyle="#ddd";context.fillRect(0,0,sw,sh);context.save();context.translate(0,scrollY);for(var i=0;i<cogs.length;i++){cogs[i].rotate()}context.restore()}var y=0;function incrementCog(){var newX=(cx<sw/2?number(0,3):number(-3,0))*sw/12;var x=cx+newX;createCog(x,y);y=cy+number(0,200)}for(var i=0;i<5;i++){incrementCog()}document.body.appendChild(stage);onLoop()}return{init:init,stage:stage}});"use strict";define("infinite_stairs",function(){var camera,scene,renderer;var sw=window.innerWidth,sh=window.innerHeight;var flightWidth=300;var stepDepth=40;var stepHeight=30;var textures={};function loadTextures(assets){var loader=new THREE.TextureLoader;for(var i=0;i<assets.length;i++){var assetName=assets[i];textures[assetName]=loader.load("/assets/"+assetName)}}function createFlight(numFlight){var numSteps=6;var treadHeight=stepHeight/4;var treadDepth=stepDepth*1.25;var numLandingSteps=Math.floor(flightWidth/treadDepth);var flight=new THREE.Group;holder.add(flight);var materialWood=new THREE.MeshPhongMaterial({map:textures["wood-dark.jpg"]});function randUV(geometry){var uvs=geometry.faceVertexUvs[0].length;for(var f=0;f<uvs;f+=2){var u0=rand.getNumber(0,.75),u1=u0+rand.getNumber(.1,.25);var v0=rand.getNumber(0,.75),v1=v0+rand.getNumber(.1,.25);geometry.faceVertexUvs[0][f]=[new THREE.Vector2(u0,v1),new THREE.Vector2(u0,v0),new THREE.Vector2(u1,v1)];geometry.faceVertexUvs[0][f+1]=[new THREE.Vector2(u0,v0),new THREE.Vector2(u1,v0),new THREE.Vector2(u1,v1)]}return geometry}var wallHeight=numSteps*stepHeight*2*4;var wallWidth=numSteps*stepDepth*2.3*4;var wallPanelWidth=100;var wallPanelDepth=5;var wallPanelHeight=wallHeight;var wallPanelSpacing=105;var numWallPanels=Math.floor(wallWidth/wallPanelWidth);function createWall(xFlip){var wall=new THREE.Group;flight.add(wall);wall.position.set(xFlip*flightWidth/2,0,0);for(var i=0;i<numWallPanels;i++){var wallGeom=randUV(new THREE.BoxGeometry(wallPanelDepth,wallPanelHeight,wallPanelWidth));var wallPanel=new THREE.Mesh(wallGeom,materialWood);wallPanel.position.set(0,0,i*wallPanelSpacing);wallPanel.castShadow=true;wallPanel.receiveShadow=true;wall.add(wallPanel)}return wall}if(numFlight==0){var wallLeft=createWall(-1);var wallRight=createWall(1)}return{flight:flight,end:{x:0,y:numSteps*stepHeight,z:(numSteps-1)*stepDepth+numLandingSteps*treadDepth}}}function makeLight(color,intensity,distance){var lightHolder=new THREE.Group;var light=new THREE.PointLight(color,intensity,distance);light.castShadow=true;light.shadow.mapSize.width=512;light.shadow.mapSize.height=512;light.shadow.camera.near=.5;light.shadow.camera.far=500;lightHolder.add(light);scene.add(lightHolder);return lightHolder}function init(){loadTextures(["wood-dark.jpg"]);scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(100,sw/sh,1,2e4);scene.add(camera);camera.position.set(0,250,-100);camera.position.set(1500,1600,-1e3);camera.lookAt(new THREE.Vector3(0,250,100));controls=new THREE.OrbitControls(camera);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);renderer.shadowMap.enabled=true;renderer.shadowMap.type=THREE.PCFSoftShadowMap;holder=new THREE.Group;scene.add(holder);var first=createFlight(0);var lightAmbient=new THREE.AmbientLight(16777215,1);scene.add(lightAmbient);document.body.appendChild(renderer.domElement);render(0)}function render(time){requestAnimationFrame(render);renderer.render(scene,camera)}return{init:init}});"use strict";var sw=400,sh=400;var bmp=dom.canvas(sw,sh);var ctx=bmp.ctx;var cx=sw/2;var cy=sh/2;var frame=0;function newLine(){ctx.clearRect(0,0,sw,sh);var dot=70,cols=9,rows=13;var gap,rotation;var phaseLength=100;var phases=4;var anim=frame%(phaseLength*phases);var phase=Math.floor(anim/phaseLength);anim=(anim-phase*phaseLength)/phaseLength;switch(phase){case 0:gap=1-anim;rotation=1;break;case 1:gap=0;rotation=1-anim;break;case 2:gap=anim;rotation=0;break;case 3:gap=1;rotation=anim;break}var angle=rotation*30/360*Math.PI*2;var cos=dot*Math.cos(angle);var sin=dot*Math.sin(angle);function drawCube(x,y,face){var ax=x,ay=y,bx=x+cos*rotation,by=y-sin,cx=x+cos+cos*rotation,cy=y,dx=cx,dy=y+dot,ex=x+cos,ey=y+sin+dot,fx=x,fy=y+dot,gx=ex,gy=y+sin;ctx.beginPath();switch(face){case 0:ctx.fillStyle="#444";ctx.moveTo(ax,ay);ctx.lineTo(gx,gy);ctx.lineTo(ex,ey);ctx.lineTo(fx,fy);break;case 1:ctx.fillStyle="#666";ctx.moveTo(gx,gy);ctx.lineTo(cx,cy);ctx.lineTo(dx,dy);ctx.lineTo(ex,ey);break;case 2:ctx.fillStyle="#888";ctx.moveTo(ax,ay);ctx.lineTo(gx,gy);ctx.lineTo(cx,cy);ctx.lineTo(bx,by);break}ctx.closePath();ctx.fill()}var gapX=gapY=.4+gap*.6;for(var i=0;i<cols;i++){var x=-10+i*cos*2*gapX;for(var j=rows-1;j>-1;j--){var y=-300+j*dot*2*gapY+i*sin*2*gapY;drawCube(x,y,1);drawCube(x,y,2);drawCube(x,y,0)}}frame+=.5;requestAnimationFrame(newLine)}document.body.appendChild(bmp.canvas);newLine();"use strict";define("isometric_words",[],function(){var pic="\n                     \n           \n               \n                   \n                   \n                   \n                   \n               \n           \n                     \n\n";var cubeSize=10;function getCamera(direction){var d=1e3*direction;return{x:-1*d,y:1*d,z:1*d}}var camera,scene,renderer;var camPos=getCamera(1);var sw=window.innerWidth,sh=window.innerHeight;var holder;function cube(){var colour=colours.getNextColour();var material=new THREE.MeshLambertMaterial({color:colour});var geometry=new THREE.BoxGeometry(cubeSize,cubeSize,cubeSize);return new THREE.Mesh(geometry,material)}function randomRotate(){return(Math.random()-.5)*1}function init(){colours.getRandomPalette();scene=new THREE.Scene;camera=new THREE.OrthographicCamera(sw/-2,sw/2,sh/2,sh/-2,1,2e4);scene.add(camera);camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);var lightAbove=new THREE.DirectionalLight(16765136,1);lightAbove.position.set(0,1,0);scene.add(lightAbove);var lightLeft=new THREE.DirectionalLight(13696976,1);lightLeft.position.set(1,0,0);scene.add(lightLeft);var lightBelow=new THREE.DirectionalLight(13684991,1);lightBelow.position.set(0,0,1);scene.add(lightBelow);var light=new THREE.AmbientLight(6316128);scene.add(light);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);holder.rotation.set(randomRotate(),randomRotate(),randomRotate());var lines=pic.split("\n");var width=lines.reduce(function(a,b){return Math.max(a,b.length)},0);var height=lines.length;lines.forEach(function(line,y){line.split("").forEach(function(pixel,x){if(pixel===""){var c=cube();holder.add(c);var magicOffset=rand.getInteger(-10,10);c.position.set((x-width/2+magicOffset)*cubeSize,(-y+height/2-magicOffset)*cubeSize,-magicOffset*cubeSize)}})});document.body.appendChild(renderer.domElement);render(0);morph()}var weird=true;function morph(){weird=!weird;var rotateMod=weird?1:0;TweenMax.to(holder.rotation,5,{x:rotateMod*randomRotate(),y:rotateMod*randomRotate(),z:rotateMod*randomRotate(),ease:Quint.easeInOut,onComplete:morph})}function render(time){renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init}});"use strict";define("lego_stack",["lib/schteppe/cannon.0.6.2.min.js","cannon_demo"],function(cn,CannonDemo){function go(){var demo=new CannonDemo({trackballControls:true});var world=setupWorld(demo);world.gravity.set(0,0,-10);var blocks=[];function createBlock(){var kLength=.5,kRadius=.5,wallThickness=.2;var width=2;var length=rand.getInteger(1,4)*2;var height=rand.getInteger(1,2);var knob=new CANNON.Cylinder(kRadius,kRadius,kLength,12);var roof=new CANNON.Box(new CANNON.Vec3(width,length,wallThickness));var bodyT=new CANNON.Box(new CANNON.Vec3(width,wallThickness,height));var bodyR=new CANNON.Box(new CANNON.Vec3(wallThickness,length,height));var bodyB=new CANNON.Box(new CANNON.Vec3(width,wallThickness,height));var bodyL=new CANNON.Box(new CANNON.Vec3(wallThickness,length,height));var block=new CANNON.Body({mass:.1});block.addShape(roof,new CANNON.Vec3(0,0,height));block.addShape(bodyT,new CANNON.Vec3(0,length-wallThickness,0));block.addShape(bodyR,new CANNON.Vec3(width-wallThickness,0,0));block.addShape(bodyB,new CANNON.Vec3(0,-length+wallThickness,0));block.addShape(bodyL,new CANNON.Vec3(-width+wallThickness,0,0));for(var w=0;w<width;w++){for(var l=0;l<length;l++){var knobPosition=new CANNON.Vec3((w-width/2+.5)*2,(l-length/2+.5)*2,height+kLength/2);block.addShape(knob,knobPosition)}}block.position.set(0,0,10+blocks.length*5);var colour=[14483456,17408,16759552,2237166][rand.getInteger(0,3)];world.add(block);demo.addVisual(block,new THREE.MeshPhongMaterial({color:colour}));block.linearDamping=.1;block.angularDamping=.1;blocks.push(block)}demo.create(function(){createBlock();update()});function update(time){requestAnimationFrame(update);if(blocks.length<100&&blocks.length<Math.floor(time/1e3)){createBlock()}}function setupWorld(demo){var world=demo.getWorld();world.gravity.set(0,0,-40);world.broadphase=new CANNON.NaiveBroadphase;world.solver.iterations=10;var groundShape=new CANNON.Plane;var groundBody=new CANNON.Body({mass:0});groundBody.addShape(groundShape);groundBody.position.set(0,0,1);world.addBody(groundBody);demo.addVisual(groundBody);world.quatNormalizeFast=false;world.quatNormalizeSkip=0;return world}demo.start()}function check(){con.log("check");if(typeof THREE==="undefined"){setTimeout(check,10)}else{go()}}check()});"use strict";var linked_line=function linked_line(){var generate=function generate(size,preoccupied){return new Promise(function(resolve,reject){if(Math.round(size/2)===size/2||Math.round(size)!==size){alert("linked_line - invalid size, needs to be odd integer - you supplied: "+size);return con.warn("linked_line - invalid size, needs to be odd integer - you supplied:",size)}var attempts=0;var wid=size;var hei=size;var block=2;var blockZoom=4;var sw=(wid+.5)*block;var sh=(hei+.5)*block;var swZ=(wid+.5)*block*blockZoom;var shZ=(hei+.5)*block*blockZoom;var bmp=dom.canvas(sw,sh);var bmpZ=dom.canvas(swZ,shZ);var bmpW=dom.canvas(swZ,shZ);var bmpR=dom.canvas(swZ,shZ);var ctx=bmp.ctx;var ctxZ=bmpZ.ctx;var ctxW=bmpW.ctx;var ctxR=bmpR.ctx;var debug=dom.element("div");var occupied={array:[],oneD:[],monkeys:[]};var backup={};var store=function store(){backup.array=occupied.array.slice();backup.oneD=occupied.oneD.slice()};var restore=function restore(){occupied.array=backup.array.slice();occupied.oneD=backup.oneD.slice()};var preoccupy=function preoccupy(options){var item={x:options.x,y:options.y,type:"NULL"};occupied.oneD[getIndex(item.x,item.y)]=item;occupied.array.push(item)};var makeItem=function makeItem(options){var x=options.x==undefined?rand.random():options.x;var y=options.y==undefined?rand.random():options.y;var item={x:x,y:y,type:"TUNNEL",surrounded:false,prev:options.prev,next:options.next};occupied.oneD[getIndex(x,y)]=item;occupied.array.push(item);return item};var first,last;var getIndex=function getIndex(x,y){return y*wid+x};var getXY=function getXY(index){return{x:index%sw,y:Math.floor(index/sw)}};var init=function init(){for(var y=0;y<hei;y++){for(var x=0;x<wid;x++){occupied.oneD.push(-1);ctx.fillRect(x*block-2+block/2,y*block-2+block/2,4,4)}}if(preoccupied){preoccupied.forEach(preoccupy)}var newItem,lastItem;for(var i=0;i<hei;i++){if(i<hei/2){x=i;y=hei/2-.5}else{x=wid/2-.5;y=i}if(i==0){newItem=makeItem({x:x,y:y});first=newItem}else{newItem=makeItem({x:x,y:y,prev:lastItem});lastItem.next=newItem}lastItem=newItem}last=newItem;render(0)};var checkSurrounded=function checkSurrounded(item){for(var i=-1;i<2;i++){for(var j=-1;j<2;j++){var x=item.x+i,y=item.y+j;if(x>=0&&x<wid&&y>=0&&y<hei){var index=getIndex(x,y);if(occupied.oneD[index]===-1)return false}}}item.surrounded=true;return true};var checkDir=function checkDir(x,y,dir){switch(dir){case 0:y--;break;case 1:x++;break;case 2:y++;break;case 3:x--;break}var index=getIndex(x,y);return{ok:x>=0&&x<wid&&y>=0&&y<hei&&occupied.oneD[index]===-1,x:x,y:y}};var checkPoints=function checkPoints(){for(var _len=arguments.length,points=Array(_len),_key=0;_key<_len;_key++){points[_key]=arguments[_key]}for(var i=0,il=points.length-1;i<il;i++){var p0=points[i],p1=points[i+1];if(Math.abs(p0.x-p1.x)!==0&&Math.abs(p0.y-p1.y)!==0){return false}}if(points[0].x===points[1].x&&points[1].x===points[2].x)return false;if(points[0].y===points[1].y&&points[1].y===points[2].y)return false;return true};var insertItemAnywhere=function insertItemAnywhere(){var index=rand.getInteger(0,occupied.array.length-1);var item=occupied.array[index];if(!item)return;debug.innerHTML="item "+occupied.array.length;var surrounded=checkSurrounded(item);if(surrounded){occupied.array.splice(index,1);return}if(item&&item.next&&item.prev){insertItemAfter(item)}else{}};var insertItemAfter=function insertItemAfter(afterItem){store();var prev=afterItem;var next=afterItem.next;var x=afterItem.x;var y=afterItem.y;var startDir=rand.getInteger(0,3);var nextDir=rand.getInteger(0,3);var pending0=checkDir(x,y,startDir);var pending1=checkDir(pending0.x,pending0.y,nextDir);var inline=checkPoints(prev,pending0,pending1,next);if(pending0.ok&&pending1.ok&&inline){var newItem0=makeItem({x:pending0.x,y:pending0.y});var newItem1=makeItem({x:pending1.x,y:pending1.y});prev.next=newItem0;newItem0.prev=prev;newItem0.next=newItem1;newItem1.prev=newItem0;newItem1.next=next;next.prev=newItem1}else{restore()}};var extractWalls=function extractWalls(){var pixels=ctx.getImageData(0,0,sw,sh).data;ctxW.fillStyle="#fff";ctxW.fillRect(0,0,sw,sh);var walls=[];for(var i=0,j=0,il=pixels.length;i<il;i+=4,j++){var xy=getXY(j);var r=pixels[i];if(r==255){ctxW.fillStyle="#f00";ctxW.fillRect(xy.x,xy.y,1,1);walls.push(xy)}}var wallrects=[];var row=-1;var w;for(i=0,il=walls.length;i<il;i++){w=walls[i];if(row!=w.y){row=w.y;wallrects.push({x:w.x,y:w.y,w:1,h:1})}else{if(walls[i-1].x==w.x-1){wallrects[wallrects.length-1].w++}else{wallrects.push({x:w.x,y:w.y,w:1,h:1})}}}for(i=0,il=wallrects.length;i<il;i++){var w0=wallrects[i];for(var j=i+1;j<il;j++){var w1=wallrects[j];if(w0&&w1){if(w0.x==w1.x&&w0.w==w1.w&&w0.y+w0.h==w1.y){wallrects[i].h++;wallrects[j]=null}}}}wallrects=wallrects.filter(function(item){return item});ctxR.fillStyle="#fff";ctxR.fillRect(0,0,swZ,shZ);for(i=0,il=wallrects.length;i<il;i++){w=wallrects[i];if(w){ctxR.beginPath();ctxR.rect(w.x*blockZoom+2,w.y*blockZoom+2,w.w*blockZoom-4,w.h*blockZoom-4);ctxR.lineWidth=1;ctxR.lineStyle="rgba(0,0,0,0.00)";ctxR.closePath();ctxR.stroke()}}resolve({walls:walls,wallrects:wallrects})};ctxZ.scale(blockZoom,blockZoom);ctxZ.imageSmoothingEnabled=false;ctxW.scale(blockZoom,blockZoom);ctxW.imageSmoothingEnabled=false;var arrLen=0,done=0;var render=function render(time){attempts++;ctx.fillStyle="#fff";ctx.fillRect(0,0,sw,sh);for(var i=0;i<40;i++){insertItemAnywhere()}ctx.beginPath();ctx.lineWidth=block/2*.25;var item=first;while(item){var x=(item.x+3/4)*block;var y=(item.y+3/4)*block;if(item==first){ctx.moveTo(x-block,y)}else if(!item.next){ctx.lineTo(x,y);ctx.lineTo(x,y+block)}else{ctx.lineTo(x,y)}item=item.next}ctx.stroke();for(var i=0;i<occupied.array.length;i++){var item=occupied.array[i];ctx.fillStyle=item.type=="NULL"?"#f00":"#00ff00";ctx.fillRect(item.x*2+1,item.y*2+1,1,1)}ctxZ.drawImage(bmp.canvas,0,0);if(arrLen===occupied.array.length){done++}else{arrLen=occupied.array.length;done=0}if(done<300){if(attempts%50==0){con.log("having a breather... ",done);setTimeout(render,20)}else{render()}}else{extractWalls()}};init()})};return{generate:generate}};define("linked_line",linked_line);"use strict";var isNode=typeof module!=="undefined";var mandala=function mandala(){var settings={spread:{type:"Number",label:"Spread",min:1,max:10,cur:10}};var TAU=Math.PI*2;var sw,sh,centre,spokes;var stage=dom.canvas(1,1);var ctx=stage.ctx;function init(options){size=options.size;sw=options.sw||size;sh=options.sh||size;stage.setSize(sw,sh);centre=sh/2;var palette=colours.getRandomPalette();con.log("Mandala init",palette);spokes=rand.getInteger(2,40)*2;settings.spread.cur=10;if(options.settings){settings=options.settings}progress("settings:initialised",settings);render()}function render(){var spread=settings.spread.cur/settings.spread.max;con.log("spread",spread);var a=1/spokes*TAU;var maxR=Math.sqrt(.5*.5*2);var r=maxR*size;var bgColour=colours.getRandomColour();var masker=dom.canvas(sw,sh);var maskBorder=2;masker.ctx.translate(maskBorder,maskBorder);masker.ctx.lineCap="flat";masker.ctx.beginPath();masker.ctx.moveTo(0,0);masker.ctx.lineTo(Math.sin(0)*r,Math.cos(0)*r);masker.ctx.lineTo(Math.sin(a)*r,Math.cos(a)*r);masker.ctx.lineTo(0,0);masker.ctx.fillStyle="red";masker.ctx.strokeStyle="red";masker.ctx.lineWidth=maskBorder;masker.ctx.stroke();var pattern=dom.canvas(sw,sh);pattern.ctx.translate(maskBorder,maskBorder);pattern.ctx.beginPath();pattern.ctx.moveTo(0,0);pattern.ctx.lineTo(Math.sin(0)*r,Math.cos(0)*r);pattern.ctx.lineTo(Math.sin(a)*r,Math.cos(a)*r);pattern.ctx.lineTo(0,0);pattern.ctx.fillStyle=bgColour;pattern.ctx.strokeStyle=bgColour;pattern.ctx.lineWidth=maskBorder;pattern.ctx.stroke();pattern.ctx.fill();document.body.appendChild(masker.canvas);document.body.appendChild(pattern.canvas);var max=7;function sorter(a,b){return a<b?-1:1}function drawBands(){for(var i=0;i<1;i++){var drawBand=function drawBand(colour,widthMod){pattern.ctx.lineWidth=stripeSize*widthMod*size*.01;pattern.ctx.strokeStyle=colour;for(var j=0;j<bands;j++){var x0=-.1;var y0=bandStart+j*bandSize;con.log(y0,spread);if(y0*maxR<spread){var x1=x0+Math.sin(bandAngle)*3;var y1=y0+Math.cos(bandAngle)*3;pattern.ctx.beginPath();pattern.ctx.moveTo(x0*centre,y0*centre);pattern.ctx.lineTo(x1*centre,y1*centre);pattern.ctx.stroke()}}};var bands=rand.getInteger(3,40);var bandSize=rand.getNumber(.01,.1);var stripeSize=rand.getNumber(1,bandSize*.6);var bandAngle=rand.getNumber(.25,.5)*TAU;var bandStart=rand.getNumber(0,.5);drawBand(colours.getNextColour(),1)}}function drawRegions(){var regionSizes={left:[],right:[]};for(var i=0;i<regionSets;i++){regionSizes.left.push(rand.random());regionSizes.right.push(rand.random())}regionSizes.left.sort(sorter);regionSizes.right.sort(sorter);for(i=0;i<regionSets-1;i++){pattern.ctx.fillStyle=colours.getNextColour();var x0=Math.sin(0)*regionSizes.left[i];var y0=Math.cos(0)*regionSizes.left[i];var x1=Math.sin(a)*regionSizes.right[i];var y1=Math.cos(a)*regionSizes.right[i];var x2=Math.sin(a)*regionSizes.right[i+1];var y2=Math.cos(a)*regionSizes.right[i+1];var x3=Math.sin(0)*regionSizes.left[i+1];var y3=Math.cos(0)*regionSizes.left[i+1];pattern.ctx.beginPath();pattern.ctx.moveTo(x0*r,y0*r);pattern.ctx.lineTo(x1*r,y1*r);pattern.ctx.lineTo(x2*r,y2*r);pattern.ctx.lineTo(x3*r,y3*r);pattern.ctx.closePath();pattern.ctx.fill();pattern.ctx.strokeStyle="black";pattern.ctx.stroke();var points=[{x:x0,y:y0},{x:x1,y:y1},{x:x2,y:y2},{x:x3,y:y3}];var insetPoints=geom.insetPoints(points,-.01);con.log("duble",points,insetPoints);if(insetPoints){pattern.ctx.beginPath();pattern.ctx.fillStyle=colours.getNextColour();for(var i=0;i<insetPoints.length;i++){var p=insetPoints[i];pattern.ctx[i==0?"moveTo":"lineTo"](p.x*r,p.y*r)}pattern.ctx.fill()}}}function drawCircles(){for(var i=0;i<circleSets;i++){var angle=rand.getNumber(-a,2*a);var distance=rand.getNumber(0,r);var radius=rand.getNumber(0,r/4);var x=Math.sin(angle)*distance;var y=Math.cos(angle)*distance;pattern.ctx.fillStyle=colours.getNextColour();pattern.ctx.beginPath();pattern.ctx.drawCircle(x,y,radius);pattern.ctx.fill()}}var bandSets=rand.getInteger(0,max);max-=bandSets;var regionSets=2;max-=regionSets;var circleSets=max;con.log(bandSets,regionSets,circleSets);drawRegions();for(var i=0;i<spokes;i++){stage.ctx.save();if(i%2==1){stage.ctx.scale(-1,1);stage.ctx.translate(-centre,centre);stage.ctx.rotate((i-1)*a)}else{stage.ctx.translate(centre,centre);stage.ctx.rotate(i*a)}stage.ctx.drawImage(pattern.canvas,-maskBorder,-maskBorder);stage.ctx.restore()}}function update(settings){init({size:size,settings:settings})}var experiment={init:init,render:render,settings:settings,stage:stage.canvas,update:update};progress("render:complete",stage.canvas);return experiment};if(isNode){module.exports=mandala()}else{define("mandala",mandala)}(function(){var borderIndex,borderLength,branchrate,can,carve,check,con,ctx,d,draw,e,entry,exitNum,exits,field,fill,frontier,getMaze,harden,init,iterations,iterativeDraw,keepDrawing,logShape,maze,ran,random,row,time,unit,x,xwide,y,y1,yhigh,_i,_j,_k,_l,_m;con=console;d=document;ctx=null;can=d.createElement("canvas");time=0;xwide=16;yhigh=16;unit=16;ran=Math.random();random={randint:function(min,max){return parseInt(min+Math.random()*(max-min))},shuffle:function(array){var i,m,t;m=array.length;while(m){i=Math.floor(Math.random()*m--);t=array[m];array[m]=array[i];array[i]=t}return array}};logShape=function(_this){return function(){var s,x,y,_i,_j;s="";for(y=_i=0;0<=yhigh?_i<yhigh:_i>yhigh;y=0<=yhigh?++_i:--_i){for(x=_j=0;0<=xwide?_j<xwide:_j>xwide;x=0<=xwide?++_j:--_j){s+=field[y][x]}s+="\n"}return con.log(s)}}(this);field=[];for(y=_i=0;0<=yhigh?_i<yhigh:_i>yhigh;y=0<=yhigh?++_i:--_i){row=[];for(x=_j=0;0<=xwide?_j<xwide:_j>xwide;x=0<=xwide?++_j:--_j){row.push("?")}field.push(row)}frontier=[];carve=function(y,x){var extra,i,_k,_len,_results;extra=[];field[y][x]=".";if(x>0){if(field[y][x-1]==="?"){field[y][x-1]=",";extra.push([y,x-1])}}if(x<xwide-1){if(field[y][x+1]==="?"){field[y][x+1]=",";extra.push([y,x+1])}}if(y>0){if(field[y-1][x]==="?"){field[y-1][x]=",";extra.push([y-1,x])}}if(y<yhigh-1){if(field[y+1][x]==="?"){field[y+1][x]=",";extra.push([y+1,x])}}extra=random.shuffle(extra);_results=[];for(_k=0,_len=extra.length;_k<_len;_k++){i=extra[_k];_results.push(frontier.push(i))}return _results};harden=function(y,x){return field[y][x]="#"};check=function(y,x,nodiagonals){var edgestate;if(nodiagonals==null){nodiagonals=true}edgestate=0;if(x>0){if(field[y][x-1]==="."){edgestate+=1}}if(x<xwide-1){if(field[y][x+1]==="."){edgestate+=2}}if(y>0){if(field[y-1][x]==="."){edgestate+=4}}if(y<yhigh-1){if(field[y+1][x]==="."){edgestate+=8}}if(nodiagonals){if(edgestate===1){if(x<xwide-1){if(y>0){if(field[y-1][x+1]==="."){return false}}if(y<yhigh-1){if(field[y+1][x+1]==="."){return false}}}return true}else if(edgestate===2){if(x>0){if(y>0){if(field[y-1][x-1]==="."){return false}}if(y<yhigh-1){if(field[y+1][x-1]==="."){return false}}}return true}else if(edgestate===4){if(y<yhigh-1){if(x>0){if(field[y+1][x-1]==="."){return false}}if(x<xwide-1){if(field[y+1][x+1]==="."){return false}}}return true}else if(edgestate===8){if(y>0){if(x>0){if(field[y-1][x-1]==="."){return false}}if(x<xwide-1){if(field[y-1][x+1]==="."){return false}}}return true}return false}else{if([1,2,4,8].indexOf(edgestate)!==-1){return true}return false}};borderIndex=0;borderLength=xwide*2+yhigh*2-4;exits=[];exits=[xwide/2,xwide+yhigh*2-4+xwide/2];exitNum=0;for(y=_k=0;0<=yhigh?_k<yhigh:_k>yhigh;y=0<=yhigh?++_k:--_k){for(x=_l=0;0<=xwide?_l<xwide:_l>xwide;x=0<=xwide?++_l:--_l){if(x===0||y===0||x===xwide-1||y===yhigh-1){if(exits.indexOf(borderIndex)===-1){harden(y,x)}else{exitNum++;if(exitNum===1){carve(y,x)}else{carve(y,x)}d=y===0?1:-1;for(entry=_m=1;_m<=4;entry=++_m){y1=y+entry*d;harden(y1,x-2);harden(y1,x-1);harden(y1,x+1);harden(y1,x+2)}}borderIndex++}}}logShape();e=Math.E;branchrate=10;iterations=0;init=function(cb,_xwide,_yhigh){can.width=xwide*unit;can.height=yhigh*unit;ctx=can.getContext("2d");return draw(cb)};keepDrawing=function(_this){return function(){return frontier.length>2&&iterations<1e10}}(this);iterativeDraw=function(){var choice,index,pos;if(keepDrawing()){pos=Math.random();pos=Math.pow(pos,Math.pow(e,-branchrate));if(pos>=1||pos<0){console.log(pos)}index=Math.floor(pos*frontier.length);choice=frontier[index];if(check(choice[0],choice[1])){carve(choice[0],choice[1])}else{harden(choice[0],choice[1])}frontier.splice(index,1)}return iterations++};fill=function(_this){return function(){var f,rgb,_n,_results;_results=[];for(y=_n=0;0<=yhigh?_n<yhigh:_n>yhigh;y=0<=yhigh?++_n:--_n){_results.push(function(){var _o,_results1;_results1=[];for(x=_o=0;0<=xwide?_o<xwide:_o>xwide;x=0<=xwide?++_o:--_o){f=field[y][x];rgb={"#":50,".":150,"?":200,",":200}[f];ctx.fillStyle="rgba("+rgb+","+rgb+","+rgb+",1)";_results1.push(ctx.fillRect(x*unit,y*unit,unit,unit))}return _results1}())}return _results}}(this);draw=function(cb){var f,_n,_o,_p;time+=.5;for(d=_n=0;_n<1;d=++_n){iterativeDraw()}if(keepDrawing()){console.log("drawing");requestAnimationFrame(draw)}else{console.log("done");for(y=_o=0;0<=yhigh?_o<yhigh:_o>yhigh;y=0<=yhigh?++_o:--_o){for(x=_p=0;0<=xwide?_p<xwide:_p>xwide;x=0<=xwide?++_p:--_p){f=field[y][x];if(f==="?"||f===","){field[y][x]="#"}}}}return fill()};getMaze=function(_this){return function(){return field}}(this);maze={getMaze:getMaze,init:init,stage:can,resize:function(){return console.log("resize maze not implemented!")},kill:function(){return console.log("kill maze not implemented!")}};window.maze=maze;define("maze",window.maze)}).call(this);"use strict";define("maze_cube",["linked_line"],function(linkedLine){var blocks=11;var cubeSize=1512;var size=cubeSize/blocks;var camera,scene,renderer;var mouse={x:0,y:0,toggle:true};var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;var holder;var controls;function cube(w,h,d,colour){var group=new THREE.Group;var material=new THREE.MeshPhongMaterial({color:colour,emissive:8400896,specular:10518656,shininess:40});var geometry=new THREE.BoxGeometry(w,h,d);var object=new THREE.Mesh(geometry,material);object.castShadow=true;object.receiveShadow=true;group.add(object);return group}function init(){var mazes=[];var face=function face(preoccupied){return linkedLine.generate(blocks,preoccupied)};var add=function add(maze){con.log("adding walls:",mazes.length,maze.wallrects.length);mazes.push(maze.wallrects);progress("render:progress",mazes.length/6)};perf.start("gen");face().then(add).then(function(){return face([{x:1,y:2},{x:1,y:3},{x:3,y:3}])}).then(add).then(face).then(add).then(face).then(add).then(face).then(add).then(face).then(add).then(function(){con.log("success");perf.end("gen");init3D(mazes)}).catch(function(err){con.warn("fail",err)})}function init3D(mazes){scene=new THREE.Scene;scene.fog=new THREE.FogExp2(0,2e-4);camera=new THREE.PerspectiveCamera(90,sw/sh,1,2e4);scene.add(camera);var lightAbove=new THREE.DirectionalLight(9474192,1.5);lightAbove.castShadow=true;lightAbove.position.set(0,200,0);scene.add(lightAbove);renderer=new THREE.WebGLRenderer;renderer.setSize(sw,sh);renderer.shadowMap={type:THREE.BasicShadowMap,enabled:true};holder=new THREE.Group;scene.add(holder);var c=cube(cubeSize*2-size,cubeSize*2-size,cubeSize*2-size,4206624);holder.add(c);var makeFace=function makeFace(options){var face=new THREE.Group;holder.add(face);options.maze.forEach(function(item){var x=(item.x+item.w/2-blocks-.5)*size;var y=(item.y+item.h/2-blocks-.5)*size;var z=cubeSize+1;var c=cube(item.w*size,item.h*size,size,9474192);c.position.set(x,y,z);face.add(c)});if(options.rotation.x)face.rotation.x=options.rotation.x*Math.PI;if(options.rotation.y)face.rotation.y=options.rotation.y*Math.PI;if(options.rotation.z)face.rotation.z=options.rotation.z*Math.PI};makeFace({maze:mazes[0],rotation:{x:0},colour:16711680});makeFace({maze:mazes[1],rotation:{x:1,z:1.5},colour:65280});makeFace({maze:mazes[2],rotation:{x:.5,z:.5},colour:255});makeFace({maze:mazes[3],rotation:{x:1.5,z:1},colour:16776960});makeFace({maze:mazes[4],rotation:{y:.5,z:1.5},colour:16711935});makeFace({maze:mazes[5],rotation:{y:1.5,z:1},colour:65535});document.body.appendChild(renderer.domElement);progress("render:complete",renderer.domElement);render(0);function exportToObj(){con.log("exportToObj");var exporter=new THREE.OBJExporter;var result=exporter.parse(scene);var floatingDiv=document.createElement("div");floatingDiv.style.display="block";floatingDiv.style.background="white";floatingDiv.style.color="black";floatingDiv.innerHTML=result.split("\n").join("<br />");con.log("result.length",result.length);document.body.appendChild(floatingDiv)}function toggle(){mouse.toggle=!mouse.toggle}window.addEventListener("click",toggle);window.addEventListener("touchstart",toggle)}function render(time){if(mouse.toggle){holder.rotation.x+=Math.PI*.005;holder.rotation.z-=Math.PI*.002}camPos.z=5e3;camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init}});"use strict";var isNode=typeof module!=="undefined";var meandering_polygons=function meandering_polygons(){var sw=1e3,sh=1e3;var bgColour=colours.getNextColour();var dots=24;var arrDots=[];var bmp=dom.canvas(sw,sh);var ctx=bmp.ctx;var range=.2;function white(){var b=~~(230+Math.random()*25),a=Math.round((.7+Math.random()*.3)*100)/100,w="rgba("+b+","+b+","+b+","+a+")";return w}function init(){var j=0;while(j<dots){arrDots[j]={x:Math.random(),y:Math.random(),fx:0,fy:0,vx:Math.random()*.001,vy:Math.random()*.001,dir:Math.random()*Math.PI*2,dirFloat:0,rotation:0,rotationFloat:0,type:~~(Math.random()*2),bmp:null,size:0,generate:function generate(){this.size=6+~~(Math.random()*20);var bmp=dom.canvas(this.size,this.size);var ctx=bmp.ctx;switch(this.type){case 0:var lineWidth=Math.random()*2;var radius=this.size/2-lineWidth;ctx.beginPath();ctx.lineWidth=lineWidth;ctx.strokeStyle=white();ctx.drawCircle(this.size/2,this.size/2,radius);ctx.stroke();radius*=Math.random();ctx.beginPath();ctx.fillStyle=white();ctx.drawCircle(this.size/2,this.size/2,radius);ctx.fill();break;case 1:var sides=3+~~(Math.random()*7);ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=white();ctx.drawCircle(this.size/2,this.size/2,radius-1);for(var i=0;i<sides;i++){var angle=i/sides*Math.PI*2;var xp=this.size/2+this.size/2*.8*Math.cos(angle),yp=this.size/2+this.size/2*.8*Math.sin(angle);if(i==0){ctx.moveTo(xp,yp)}else{ctx.lineTo(xp,yp)}}ctx.closePath();ctx.stroke();break;case 2:break}this.bmp=bmp},draw:function draw(){if(this.bmp==null){this.generate()}ctx.save();ctx.translate(this.x*sw,this.y*sh);ctx.rotate(this.rotation);ctx.drawImage(this.bmp.canvas,-this.size/2,-this.size/2);ctx.restore()},attraction:-1e-5,speed:1e-4,friction:.9,move:function move(){this.rotationFloat+=(Math.random()>.5?-1:1)*.5;this.rotation-=(this.rotation-this.rotationFloat)*.01;this.dirFloat+=(Math.random()>.5?-1:1)*.1;this.dir-=(this.dir-this.dirFloat)*.01;this.vx+=Math.sin(this.dir)*this.speed+this.fx;this.vy+=Math.cos(this.dir)*this.speed+this.fy;this.vx*=this.friction;this.vy*=this.friction;this.x+=this.vx;this.y+=this.vy;if(this.x<-.2)this.x=1.2;if(this.x>1.2)this.x=-.2;if(this.y<-.2)this.y=1.2;if(this.y>1.2)this.y=-.2},force:function force(opposite,distance,deltaX,deltaY){this.fx=deltaX/distance*this.attraction;this.fy=deltaY/distance*this.attraction}};j++}render();var isDown=false,mouseTarget=null;addEventListener("mousedown",function(e){isDown=true;var mx=e.x/sw,my=e.y/sh;for(var k=0;k<dots;k++){var dot=arrDots[k];var dx=dot.x-mx,dy=dot.y-my,d=Math.sqrt(dx*dx+dy*dy);if(d<.1){ctx.beginPath();ctx.fillStyle="red";ctx.drawCircle(dot.x*sw,dot.y*sh,20);ctx.fill();mouseTarget=k;break}}});addEventListener("mouseup",function(e){isDown=false;mouseTarget=null});addEventListener("mousemove",function(e){if(isDown&&mouseTarget!=null){var mx=e.x/sw,my=e.y/sh;arrDots[mouseTarget].x=mx;arrDots[mouseTarget].y=my}})}var lines=[];function uniqueId(j,k){return j*(j-1)/2+k}for(var j=0;j<dots;j++){for(var k=0;k<j;k++){lines[uniqueId(j,k)]={points:[j,k],lineWidth:0,colour:white(),dashes:~~(Math.random()*5)}}}function render(){ctx.fillStyle="rgba(180,180,200,1)";ctx.fillRect(0,0,sw,sh);for(var j=0;j<dots;j++){var dot=arrDots[j];dot.move();dot.draw();for(var k=0;k<j;k++){var lineId=uniqueId(j,k);var other=arrDots[k];var dx=dot.x-other.x,dy=dot.y-other.y,d=Math.sqrt(dx*dx+dy*dy);var inRange=d<range;if(other.x<0||other.x>1||other.y<0||other.y>1)inRange=false;if(inRange){dot.force(other,d,dx,dy);other.force(dot,d,dx,dy);lines[lineId].lineWidth-=(lines[lineId].lineWidth-3)*.01}else{lines[lineId].lineWidth*=.9;if(lines[lineId].lineWidth<.1){lines[lineId].lineWidth=0}}}}for(var m=0,ml=lines.length;m<ml;m++){var lineM=lines[m];pointsM=lineM.points,a=arrDots[pointsM[0]],b=arrDots[pointsM[1]];if(lineM.lineWidth){for(var k=0;k<m;k++){var lineK=lines[k];if(lineK.lineWidth){var pointsK=lineK.points,c=arrDots[pointsK[0]],d=arrDots[pointsK[1]];var intersects=geom.intersectionBetweenPoints(a,b,c,d);if(intersects){debugCircle(intersects,lineM.colour)}}}drawLine(a,b,lineM)}}requestAnimationFrame(render)}function drawLine(a,b,line){if(line.lineWidth>0){ctx.save();ctx.beginPath();ctx.lineWidth=line.lineWidth;ctx.strokeStyle=line.colour;if(line.dashes>2)ctx.setLineDash([line.dashes]);ctx.lineCap="round";ctx.moveTo(a.x*sw,a.y*sh);ctx.lineTo(b.x*sw,b.y*sh);ctx.stroke();ctx.restore()}}function debugCircle(dot,colour){var radius=sw*range/2;var radius=3;ctx.beginPath();ctx.fillStyle=colour;ctx.drawCircle(dot.x*sw,dot.y*sh,radius);ctx.fill()}var resizeMode="contain";var meandering={stage:bmp.canvas,resize:function resize(w,h){sw=w;sh=h;bmp.canvas.width=sw;bmp.canvas.height=sh},init:init,kill:function kill(){}};return meandering};if(isNode){module.exports=meandering_polygons()}else{define("meandering_polygons",meandering_polygons)}"use strict";var mining_branches=function mining_branches(){var fgColour=colours.getRandomColour();var bgColour=colours.getNextColour();var planets=200;var size=400;var bmp;function makeCanvas(scale){var sw=size*scale;var sh=sw;bmp=dom.canvas(sw,sh);bmp.canvas.setSize(sw/scale,sh/scale);var ctx=bmp.ctx;var circleRads=Math.PI*2;var cx=.5;var cy=.5;var i,j;var lastPlanet;var arrPlanets=[];var arrRings=[[]];var ringIndex=0;var diameter=.01;var ringSize=.01;var rotation=0;var attempts=0;var settings={increaseMutation:rand.random()>.5,drawNodes:rand.random()>.5,straight:rand.random()>.5,megaNodes:rand.random()>.5,megaSubNodes:rand.random()>.5,constantMegaNodeSize:rand.random()>.5,constantMegaSubNodeSize:rand.random()>.5};function createPlanet(index,planet){planet.index=index;lastPlanet=planet;arrPlanets[index]=planet;arrRings[ringIndex].push(planet)}createPlanet(0,{x:cx,y:cy,distance:0,rotation:0,colour:fgColour,mutationRate:10});function newPlanet(index){var planet={x:cx+Math.sin(rotation)*diameter+(rand.random()-.5)*.05,y:cy+Math.cos(rotation)*diameter+(rand.random()-.5)*.05,rotation:rotation,distance:diameter};var ok=true;var lastDistance=1e7;i=arrPlanets.length-1;while(i>-1&&ok){var other=arrPlanets[i];var dx=planet.x-other.x;var dy=planet.y-other.y;var distance=Math.sqrt(dx*dx+dy*dy);if(distance<.04){ok=false}else{lastDistance=Math.min(distance,lastDistance);if(lastDistance==distance){planet.closest=arrPlanets[i]}}i--}if(planet.x==lastPlanet.x&&planet.y==lastPlanet.y){ok=false}if(ok){attempts=0;if(settings.increaseMutation){planet.mutationRate=planet.closest.mutationRate*1.04}else{planet.mutationRate=planet.closest.mutationRate*.9}planet.colour=colours.mutateColour(planet.closest.colour,planet.mutationRate);createPlanet(index,planet)}else{if(attempts<40){rotation+=rand.random()*20+Math.atan(1/diameter)}else{ringIndex++;arrRings[ringIndex]=[];diameter+=rand.random()*ringSize+1/400}attempts++;newPlanet(index)}}function drawNodes(){ctx.fillStyle=bgColour;ctx.fillRect(0,0,sw,sh);var j=arrPlanets.length-1;while(j>-1){var planet=arrPlanets[j];var xp=planet.x;var yp=planet.y;drawNode(planet,xp,yp);j--}if(settings.megaNodes){j=arrPlanets.length-1;while(j>-1){var planet=arrPlanets[j];var xp=planet.x;var yp=planet.y;drawInnerNode(planet,xp,yp);j--}}}function drawNode(planet,xp,yp){var closest=planet.closest;var colour=closest?closest.colour:planet.colour;var size=1-planet.distance;if(settings.drawNodes){var radius=size*scale*5;ctx.beginPath();ctx.fillStyle=colour;ctx.drawCircle(planet.x*sw,planet.y*sh,radius);ctx.fill()}if(closest){ctx.beginPath();ctx.lineWidth=Math.pow(1.1,size*6)*scale;ctx.strokeStyle=colour;ctx.lineCap="round";ctx.moveTo(xp*sw,yp*sh);if(settings.straight){ctx.lineTo(closest.x*sw,closest.y*sh)}else{if(closest.closest){var phx=closest.x+(closest.closest.x-closest.x)/2;var phy=closest.y+(closest.closest.y-closest.y)/2;var nx=closest.x+(closest.x-phx);var ny=closest.y+(closest.y-phy);ctx.quadraticCurveTo(nx*sw,ny*sh,closest.x*sw,closest.y*sh)}else{var hx=closest.x+(xp-closest.x)/2;var hy=closest.y+(yp-closest.y)/2;ctx.quadraticCurveTo(hx*sw,hy*sh,closest.x*sw,closest.y*sh)}}ctx.stroke()}}function drawInnerNode(planet,xp,yp){var size=1-planet.distance;var radius=size*scale*5;if(settings.megaNodes){ctx.beginPath();ctx.fillStyle=bgColour;ctx.drawCircle(planet.x*sw,planet.y*sh,radius*.7*(settings.constantMegaNodeSize?1:rand.random()));ctx.fill();if(settings.megaSubNodes&&rand.random()>.5){ctx.beginPath();ctx.fillStyle=planet.colour;ctx.drawCircle(planet.x*sw,planet.y*sh,radius*.9*(settings.constantMegaSubNodeSize?1:rand.random()));ctx.fill()}}}j=1;while(j<planets){newPlanet(j);j++}drawNodes();canvases.appendChild(bmp.canvas)}function generate(){while(canvases.childNodes.length){canvases.removeChild(canvases.childNodes[0])}seed=~~(rand.random()*1e9);colours.getRandomPalette();fgColour=colours.getRandomColour();bgColour=colours.getNextColour();makeCanvas(1)}var canvases=dom.element("div");var experiment={stage:canvases,resize:function resize(sw,sh){},init:generate};return experiment};if(isNode){module.exports=mining_branches()}else{define("mining_branches",mining_branches)}"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var con=console;var dom=require("./dom.js");var fs=require("fs");var size=300;var centre=size/2;var gridY=12;var gridX=gridY*4;var thirty=Math.PI/6;var sinThirty=Math.sin(thirty);var cosThirty=Math.cos(thirty);var c=dom.canvas(size,size);var ctx=c.ctx;var unit=90;var saveFile=function saveFile(canvas,frame,cb){var filename="/../export/"+(String(frame).length==1?"0":"")+frame+".png";canvas.toBuffer(function(err,buf){if(err){con.log("saveFile err",err)}else{fs.writeFile(__dirname+filename,buf,function(){con.log("saveFile success",typeof buf==="undefined"?"undefined":_typeof(buf),__dirname+filename);cb()})}})};var draw=function draw(x,y){var drawLeaf=function drawLeaf(angle){ctx.save();ctx.translate(x,y);ctx.rotate(angle);ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(sinThirty*unit,cosThirty*unit);ctx.lineTo(0,cosThirty*unit*2);ctx.lineTo(-sinThirty*unit,cosThirty*unit);ctx.closePath();ctx.fill();ctx.restore()};drawLeaf(thirty*1);drawLeaf(thirty*5);drawLeaf(thirty*9)};var frames=32,loops=3;var render=function render(frame){var scale=Math.sin(frame/frames*Math.PI*2-Math.PI/2)+1.98;unit=51;var angle=Math.floor(frame/frames)*Math.PI*2/3/4;ctx.fillStyle="#000";ctx.fillRect(0,0,size,size);ctx.fillStyle="#d11";ctx.save();ctx.translate(centre,centre);ctx.rotate(angle);ctx.translate(-centre,-centre);var gx=0;while(gx++<gridX){var gy=0;while(gy++<gridY){var x=centre+(gx-gridX/2)*cosThirty*unit*scale,y=centre+(gx%2*3+(gy-gridY/2)*6)*sinThirty*unit*scale;draw(x,y)}}ctx.restore();saveFile(c.canvas,frame,function(){frame++;if(frame<frames*loops){render(frame)}})};render(0);"use strict";var molecular_three=function molecular_three(){var camera,scene,renderer;var mouse={x:0,y:0};var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;function num(min,max){return Math.random()*(max-min)+min}var segmentCreationInterval=0;var segmentLastCreated;var segmentLengthInitial=50;var segmentLength=segmentLengthInitial;var segmentRadius=num(4,15);var sphereRadius=segmentRadius*num(1,3);var branchingAngle=num(0,10);var holder;var vectors=[];var generationComplete=false;var attempts=0;var bail=300;var renderMessage=dom.element("div",{innerHTML:"rendering",style:{color:"white",position:"absolute",top:"10px",width:"100%",textAlign:"center"}});function sphere(props){var widthSegments=10,heightSegments=10;var material=new THREE.MeshLambertMaterial({color:props.colour});var geometry=new THREE.SphereGeometry(props.radius,widthSegments,heightSegments);var object=new THREE.Mesh(geometry,material);return object}function cylinder(props){var group=new THREE.Group;var material=new THREE.MeshLambertMaterial({color:props.colour});var geometry=new THREE.CylinderGeometry(props.radius,props.radius,props.height,15);var object=new THREE.Mesh(geometry,material);object.position.y=props.height/2;group.add(object);return{colour:props.colour,group:group,object:object}}function getSectionEnd(cylinder){var numVertices=cylinder.object.geometry.vertices.length;var end=cylinder.object.geometry.vertices[numVertices-2];return new THREE.Vector3(end.x+cylinder.object.position.x,end.y+cylinder.object.position.y,end.z+cylinder.object.position.z)}function init(){colours.getRandomPalette();scene=new THREE.Scene;scene.fog=new THREE.FogExp2(0,.0015);camera=new THREE.PerspectiveCamera(80,sw/sh,1,1e4);scene.add(camera);var lightAbove=new THREE.DirectionalLight(16777215,1.5);lightAbove.position.set(0,200,100);scene.add(lightAbove);var lightLeft=new THREE.DirectionalLight(16777215,4);lightLeft.position.set(-100,0,100);scene.add(lightLeft);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);function checkDistance(reference){var globalPosition=new THREE.Vector3;globalPosition.setFromMatrixPosition(reference.matrixWorld);var st=(new Date).getTime();var distance;var distanceOk=true;for(var i=0,il=vectors.length;i<il&&distanceOk;i++){if(globalPosition==vectors[i])con.log("same one",globalPosition,vectors[i]);distance=globalPosition.distanceTo(vectors[i]);if(distance<segmentLength-5){distanceOk=false}}var en=(new Date).getTime();var proc=en-st;if(proc>3)con.warn("proc time = ",proc);return{vector:globalPosition,ok:distanceOk}}function drawSection(parent,endPoint){var colour=colours.mutateColour(parent.colour,50);var child=cylinder({radius:segmentRadius,height:segmentLength,colour:colour});child.group.position.set(endPoint.x,endPoint.y,endPoint.z);child.group.rotation.z=num(-.5,.5)*2*Math.PI*attempts/bail*branchingAngle;child.group.rotation.y=num(0,2)*Math.PI;var end=getSectionEnd(child);var endSphere=sphere({radius:3,colour:16711680});endSphere.position.set(end.x,end.y,end.z);child.group.add(endSphere);parent.group.add(child.group);parent.group.updateMatrixWorld();var distance=checkDistance(endSphere);child.group.remove(endSphere);if(distance.ok){vectors.push(distance.vector);var s=sphere({radius:sphereRadius,colour:colour});s.position.set(distance.vector.x,distance.vector.y,distance.vector.z);holder.add(s);return child}else{child.group.remove(endSphere);parent.group.remove(child.group);return null}}segmentCreationInterval=setInterval(function(){if((new Date).getTime()-segmentLastCreated>3e3){con.log("more than 3 seconds... bailing!");generationComplete=true;clearInterval(segmentCreationInterval)}},500);function addSection(parent){attempts++;segmentLength=(2-attempts/bail)*segmentLengthInitial/2;if(attempts<bail){renderMessage.innerHTML="Rendering "+Math.round(attempts/bail*100)+"%";var endPoint=getSectionEnd(parent);var kids=parseInt(num(1,3));for(var i=0;i<kids;i++){var newSection=drawSection(parent,endPoint);if(newSection){segmentLastCreated=(new Date).getTime();(function(a,p){var timeout=a*10;setTimeout(function(){if(generationComplete){con.log("wanted to created another, but time out...")}else{addSection(p)}},timeout)})(attempts,newSection)}}}else{generationComplete=true;if(renderMessage)document.body.removeChild(renderMessage);renderMessage=null}}var seeds=parseInt(num(10,50));var colour=colours.getRandomColour();for(var j=0;j<seeds;j++){var baseSection=cylinder({radius:segmentRadius,height:segmentLength,colour:colour});baseSection.group.rotation.set(num(0,2)*Math.PI,num(0,2)*Math.PI,num(0,2)*Math.PI);holder.add(baseSection.group);var end=getSectionEnd(baseSection);var endSphere=sphere({radius:sphereRadius,colour:colour});endSphere.position.set(end.x,end.y,end.z);baseSection.group.add(endSphere);baseSection.group.updateMatrixWorld();var distance=checkDistance(endSphere);if(distance.ok){vectors.push(distance.vector);addSection(baseSection)}else{baseSection.group.remove(endSphere);holder.remove(baseSection.group)}}document.body.appendChild(renderer.domElement);document.body.appendChild(renderMessage);function listen(eventNames,callback){for(var i=0;i<eventNames.length;i++){window.addEventListener(eventNames[i],callback)}}listen(["resize"],function(e){sw=window.innerWidth;sh=window.innerHeight;camera.aspect=sw/sh;camera.updateProjectionMatrix();renderer.setSize(sw,sh)});listen(["mousemove","touchmove"],function(e){e.preventDefault();if(e.changedTouches&&e.changedTouches[0])e=e.changedTouches[0];mouse.x=e.clientX/sw*2-1;mouse.y=-(e.clientY/sh)*2+1});render(0)}function render(time){if(generationComplete){holder.rotation.y+=.01}camPos.z=1e3;camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init,resize:function resize(){}}};define("molecular_three",molecular_three);"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var isNode=typeof module!=="undefined";var posJump;if(isNode){con=console;dom=require("./dom.js");geom=require("./geom.js");rand=require("./rand.js");Ease=require("../lib/robertpenner/ease.js");progress=function progress(){return fs=require("fs")};saveFile=function saveFile(canvas,frame,cb){var filename="/../export/"+(String(frame).length==1?"0":"")+frame+".png";canvas.toBuffer(function(err,buf){if(err){con.log("saveFile err",err)}else{fs.writeFile(__dirname+filename,buf,function(){con.log("saveFile success",typeof buf==="undefined"?"undefined":_typeof(buf),__dirname+filename);cb()})}})};posJump=.02}else{posJump=.005}var nested_rotating_polygon=function nested_rotating_polygon(){var TAU=Math.PI*2;var bmp=dom.canvas(1,1);var ctx=bmp.ctx;var size,sides,depthMax;var pos=0;var half=0;var BLACK="#000",WHITE="#fff";var frame=0;function init(options){size=options.size;bmp.setSize(size,size);sides=3;depthMax=6;progress("render:complete",bmp.canvas);render()}function render(){frame++;ctx.fillStyle=depthMax%2?BLACK:WHITE;ctx.fillRect(0,0,size,size);create({depth:0});pos+=posJump;if(pos>=1){pos=0;half++;half%=2}if(isNode){saveFile(bmp.canvas,frame,function(){if(frame<1/posJump*2){render()}else{con.log("stopping - frame:",frame,"pos:",pos)}})}else{requestAnimationFrame(render)}}function create(parent){var i;var depth=parent.depth+1;var points=[];if(parent.points){var progress=Ease.easeInOutQuart(pos,0,1,1)+half;for(i=0;i<sides;i++){var point0=parent.points[i];var point1=parent.points[(i+1)%sides];var p=geom.lerp({x:point0.x,y:point0.y},{x:point1.x,y:point1.y},progress/2);var xp=p.x,yp=p.y;points.push(p)}}else{for(i=0;i<sides;i++){var angle=i/sides*TAU+TAU/4;var xp=size/2+size/2*.98*Math.cos(angle),yp=size/2+size/2*.98*Math.sin(angle);points.push({x:xp,y:yp})}}ctx.fillStyle=depth%2?BLACK:WHITE;ctx.strokeStyle=ctx.fillStyle;ctx.lineWidth=2;ctx.beginPath();ctx.strokeStyle="0";for(var i=0;i<sides;i++){var xp=points[i].x,yp=points[i].y;if(i==0){ctx.moveTo(xp,yp)}else{ctx.lineTo(xp,yp)}}ctx.closePath();if(depth===depthMax)ctx.stroke();ctx.fill();if(depth<depthMax){create({depth:depth,points:points})}}var experiment={stage:bmp.canvas,init:init};return experiment};if(isNode){module.exports=exp=nested_rotating_polygon();con.log(exp);exp.init({size:700})}else{define("nested_rotating_polygon",nested_rotating_polygon)}"use strict";var sw=600,sh=600;function genRan(min,max){return Math.random()*(max-min)+min}var o,oscs=[];var oscillators=15;for(o=0;o<oscillators;o++){oscs[o]=[];oscs[o][0]=genRan(0,.1);oscs[o][1]=genRan(0,.1);oscs[o][2]=genRan(0,.1);oscs[o][3]=genRan(0,.1)}function getOsc(i,a,range){var temp=0;for(o=0;o<oscillators;o++){temp+=Math.sin(i*oscs[o][a])*range}temp/=oscillators;return temp}var bmp=dom.canvas(sw,sh);document.body.appendChild(bmp.canvas);var h=0;var xRange=30;var yRange=30;var xGap=sw/xRange*1;var yGap=sh/yRange*1;var xHalf=xRange/2;var yHalf=yRange/2;var frame=0;function newLine(){bmp.ctx.clearRect(0,0,sw,sh);var f=0;for(var h=0;h<yRange;h++){for(var v=0;v<xRange;v++){f++;var xyIndex=v+h;var xy=frame+xyIndex;var oscRange=15;var xpos=(v+.5)*xGap+getOsc(xy,2,oscRange);var ypos=(h+.5)*yGap+getOsc(xy,3,oscRange);bmp.ctx.fillStyle="#000";bmp.ctx.fillText(Math.round(xyIndex),xpos-2,ypos-2)}}frame+=1;if(frame<5e9)requestAnimationFrame(newLine)}newLine();"use strict";define("oscillator",function(){var sw=window.innerWidth;var sh=window.innerHeight;var size=800;var cols=colours.getRandomPalette();var bg=colours.getRandomColour();var fg=colours.getNextColour();var canvas=dom.canvas(sw,sh);var ctx=canvas.ctx;var gap=4;var h;var yo;var circleSize=1;var oscRange=10;var range=Math.ceil(size/gap);var xGap=sw/range;var yGap=sh/range;var calcs=0;var oscs=[];var oscillators=10;function genOsc(){for(var o=0;o<oscillators;o++){oscs[o]=[];oscs[o][0]=rand.getNumber(0,.1);oscs[o][1]=rand.getNumber(0,.1);oscs[o][2]=rand.getNumber(0,.1);oscs[o][3]=rand.getNumber(0,.1)}}function getOsc(i,a,range){var temp=0;for(var o=0;o<oscillators;o++){calcs++;temp+=Math.sin(i*oscs[o][a])*range}return temp}var start=rand.getInteger(0,1e6);function onLoop(time){ctx.fillStyle=bg;ctx.fillRect(0,0,sw,sh);ctx.fillStyle=fg;yo=0;h=time*.02;calcs=0;var rows=0;while(rows<range){for(var i=0;i<range;i++){var t=start+i;var j=getOsc(t,0,oscRange);var k=getOsc(t,1,oscRange);var l=getOsc(t+h,2,oscRange);var m=getOsc(t-h,3,oscRange);var xp=l+j+xGap*i;var yp=m+k+yo;ctx.beginPath();ctx.drawCircle(xp,yp,circleSize);ctx.fill()}h+=.4;yo+=yGap;rows++}}function init(){genOsc();onLoop(0)}return{init:init,stage:canvas.canvas}});"use strict";var isNode=typeof module!=="undefined";var overflow=function overflow(){var TAU=Math.PI*2;var sw,sw,cx,cy;var stage=dom.canvas(1,1);var ctx=stage.ctx;var polys=[];function init(options){size=options.size;sw=options.sw||size;sh=options.sh||size;stage.setSize(sw,sh);colours.getRandomPalette();createPolygon();createPolygon();polys.forEach(function(poly){ctx.strokeStyle=poly.colour;ctx.beginPath();poly.points.forEach(function(_ref,i){var x=_ref.x,y=_ref.y;var xs=x*sw,ys=y*sh;if(i){ctx.lineTo(xs,ys)}else{ctx.moveTo(xs,ys)}con.log(xs,ys)});ctx.closePath();ctx.stroke()})}function createPolygon(){var poly={colour:colours.getRandomColour(),points:[]};var sides=rand.getInteger(3,17);var radius=rand.getNumber(.1,.4);var cx=rand.getNumber(0,1);var cy=rand.getNumber(0,1);for(var i=0;i<sides;i++){var angle=i/sides*TAU;var x=cx+Math.sin(angle)*radius;var y=cy+Math.cos(angle)*radius;poly.points.push({x:x,y:y})}polys.push(poly)}var experiment={stage:stage.canvas,init:init};progress("render:complete",stage.canvas);return experiment};if(isNode){module.exports=overflow()}else{define("overflow",overflow)}"use strict";var sw=window.innerWidth,sh=window.innerHeight;var bmp=dom.canvas(sw,sh);var ctx=bmp.ctx;var patternMonochrome;var patternColoured;var dot=2;var widths;var pallete;var size;var rotation=0;var palettePreview;var preview;var title;var container=dom.element("div",{className:"container",style:{width:sw+"px",height:sh+"px"}});document.body.appendChild(container);container.appendChild(bmp.canvas);function newSize(){size=Math.ceil(Math.random()*10)*10}function newStripes(){var lines=2+~~(Math.random()*5);widths=[0];while(widths.length<lines){widths.push(Math.ceil(1+Math.random()*(size-1)/2)*2)}widths.push(size);var noDuplicates=[];widths.map(function(a,i){if(widths.indexOf(a)==i){noDuplicates.push(a)}});widths=noDuplicates.sort(function(a,b){return a<b?-1:1})}function newPalette(){colours.getRandomPalette();if(palettePreview){container.removeChild(palettePreview);palettePreview.removeEventListener("click",changePalette)}palettePreview=colours.showPalette();palettePreview.addEventListener("click",changePalette);container.appendChild(palettePreview)}function newColours(){palette=[];var attempts=0;while(palette.length<widths.length-1){var newColour=colours.getRandomColour();if(palette.indexOf(newColour)==-1||attempts>100){palette.push(newColour)}attempts++}}function reset(){newSize();newStripes();newPalette();newColours();render()}function changeStripes(){newStripes();newColours();render()}function changeSize(size){dot=size;render()}function changeRotation(){rotation+=Math.PI/4;render()}function changePalette(){newPalette();newColours();render()}function render(){patternColoured=dom.canvas(size*dot,size*dot);if(patternMonochrome)patternDetails.removeChild(patternMonochrome.canvas);patternMonochrome=dom.canvas(size*dot,size*dot);var colourMonochrome=[["#666","#aaa"],["#333","#888"]];for(var i=0;i<widths.length-1;i++){var x=widths[i];var w=widths[i+1]-x;var colourColumn=palette[i];var monoColumn=colourMonochrome[0][i%2];for(var j=0;j<widths.length-1;j++){var y=widths[j];var h=widths[j+1]-y;var colourRow=palette[j];var monoRow=colourMonochrome[1][j%2];for(var px=0;px<w;px++){for(var py=0;py<h;py++){patternColoured.ctx.fillStyle=(px+py)%2==0?colourColumn:colourRow;patternColoured.ctx.fillRect((x+px)*dot,(y+py)*dot,dot,dot);patternMonochrome.ctx.fillStyle=(px+py)%2==0?monoColumn:monoRow;patternMonochrome.ctx.fillRect((x+px)*dot,(y+py)*dot,dot,dot)}}}}patternDetails.appendChild(patternMonochrome.canvas);ctx.save();ctx.rect(0,0,sw,sh);ctx.rotate(rotation);ctx.fillStyle=ctx.createPattern(patternColoured.canvas,"repeat");ctx.fill();ctx.restore()}var buttonsTop=dom.element("div",{className:"buttons top"});container.appendChild(buttonsTop);var buttonsBottom=dom.element("div",{className:"buttons bottom"});container.appendChild(buttonsBottom);var patternDetails=dom.element("div",{className:"pattern"});container.appendChild(patternDetails);patternDetails.addEventListener("click",changeStripes);var buttonExport=dom.button("get css",{className:"button export"});buttonExport.addEventListener("click",function(e){var img=patternColoured.canvas.toDataURL("image/jpeg");if(preview===undefined){preview=dom.element("div",{className:"preview"});var title=dom.element("div",{className:"title",innerHTML:"And the CSS..."});preview.appendChild(title);var close=dom.button("close",{className:"close"});close.addEventListener("click",function(e){container.removeChild(preview)});preview.appendChild(close);preview.css=dom.element("div",{className:"css"});preview.appendChild(preview.css)}container.appendChild(preview);var r="rotate("+rotation+"rad)";var cssArr=["background-image: url("+img+");","background-repeat: repeat;","-webkit-transform: "+r+";","-moz-transform: "+r+";","-ms-transform: "+r+";","-o-transform: "+r+";","transform: "+r+";"];preview.css.innerHTML=cssArr.join("<br>")});buttonsTop.appendChild(buttonExport);function save(canvas,type){var dataURL=canvas.toDataURL("image/jpeg");var filename="check_"+type+"_"+(Math.random()*1e9<<0).toString(16)+"-.jpg";var link=dom.element("a",{href:dataURL,download:filename});link.click()}var buttonSaveOne=dom.button("pattern image",{className:"button"});buttonSaveOne.addEventListener("click",function(e){save(patternColoured.canvas,"pattern")});buttonsTop.appendChild(buttonSaveOne);var buttonSaveTiled=dom.button("tiled image",{className:"button"});buttonSaveTiled.addEventListener("click",function(e){save(bmp.canvas,"tiled")});buttonsTop.appendChild(buttonSaveTiled);var sizes=[1,2,3,4];for(var s in sizes){var size=sizes[s];var buttonSize=dom.button(size+"x",{className:"button",size:size});buttonSize.addEventListener("click",function(){changeSize(this.size)});buttonsBottom.appendChild(buttonSize)}var buttonRotation=dom.button("rotation",{className:"button"});buttonRotation.addEventListener("click",function(){changeRotation()});buttonsBottom.appendChild(buttonRotation);bmp.canvas.addEventListener("click",reset);window.addEventListener("resize",function(){bmp.canvas.width=sw=window.innerWidth;bmp.canvas.height=sh=window.innerHeight;container.setSize(sw,sh);render()});reset();"use strict";var isNode=typeof module!=="undefined";var pattern_circles=function pattern_circles(){var size,sw,sh;var bmp=dom.canvas(1,1);var ctx=bmp.ctx;var circles;var colourBG;var rotation;function init(options){size=options.size;sw=size;sh=size;var cx=sw/2;var cy=sh/2;bmp.setSize(sw,sh);ctx.clearRect(0,0,sw,sh);ctx.fillRect(cx-2,cy-2,4,4);rotation=Math.random()*Math.PI/2;var size=10+~~(Math.random()*50);var lines=2+~~(Math.random()*5);var widths=[];while(widths.length<lines){widths.push(Math.ceil(Math.random()*size))}widths.push(size);var noDuplicates=[];widths.map(function(a,i){if(widths.indexOf(a)==i){noDuplicates.push(a)}});widths=noDuplicates.sort(function(a,b){return a<b?-1:1});colours.getRandomPalette();var palette=[];while(palette.length<widths.length){palette.push(colours.getRandomColour())}colourBG=colours.getRandomColour();con.log("colourBG",colourBG);var patternSize=size+size*Math.random();circles=dom.canvas(patternSize,patternSize);document.body.appendChild(circles.canvas);for(var i=widths.length-1;i>-1;i--){var radius=widths[i];var colour=palette[i];circles.ctx.beginPath();circles.ctx.fillStyle=colour;circles.ctx.drawCircle(size/2,size/2,radius/2);circles.ctx.fill();circles.ctx.closePath();con.log(i)}render()}function render(){con.log("render");ctx.save();ctx.fillStyle=colourBG;ctx.rect(0,0,sw,sh);ctx.fill();ctx.rotate(rotation);ctx.fillStyle=ctx.createPattern(circles.canvas,"repeat");ctx.fill();ctx.restore();progress("render:complete",bmp.canvas)}var experiment={stage:bmp.canvas,init:init};return experiment};if(isNode){module.exports=pattern_circles()}else{define("pattern_circles",pattern_circles)}"use strict";var perlin=function perlin(){function noise(w,h){var r=Math.random;var s,h,s,u,v;function init(){s=[];u=[];v=[];for(var i=0;i<8;i++){s.push([]);v.push([r(),r()])}for(i=0;i<262;i++){u.push(~~(r()*256))}return this}function z(uIndex,k,t,j){var F=.5-t*t-j*j;try{var zz=F<0?0:Math.pow(F,4)*(s[k%8][0]*t+s[k%8][1]*j)}catch(err){con.log(err,k,uIndex)}return zz}function q(k,t){var e=.2;var a=(k+t)*.3;var m=~~(k+a);var b=~~(t+a);a=(m+b)*e;var c=k-(m-a);var j=t-(b-a);var C=c>j;var u0=m+u[b];var u1=m+C+u[b+!C];var u2=m+1+u[b+1];var out=38*(z(u0,u[u0],c,j)+z(u1,u[u1],c-C+e,j-!C+e)+z(u2,u[u2],c-.6,j-.6));var clamp=.2;return out}function cycle(time,scale){for(var i=0;i<8;i++){s[i][0]=Math.sin(v[i][0]*time);s[i][1]=Math.cos(v[i][1]*time)}var channel=[];for(var i=0,il=w*h;i<il;i++){var xp=i%w*scale;var yp=Math.floor(i/w)*scale;channel.push(q(xp,yp)+.5)}return channel}init();return{cycle:cycle}}return{noise:noise}};define("perlin",perlin);"use strict";var vertexShader="varying vec2 vUv;\nvoid main()\n{\n  vUv = uv;\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n}";var fragmentShader="\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float distance;\nuniform float pulse;\nuniform float rows;\nuniform float cols;\nvarying vec2 vUv;\nfloat checkerRows = 1.5;\nfloat checkerCols = 2.0;\nvoid main( void ) {\n  vec2 position = abs(-1.0 + 2.0 * vUv);\n\n  float edging = abs((pow(position.y, 5.0) + pow(position.x, 5.0)) / 1.0);\n\n  float perc = 0.25 + distance * edging * 0.75;\n  vec2 checkPosition = vUv;\n  \n  float checkerX = mod(checkPosition.x, 1.0 / rows) * rows; // loop of 0 to 1 per row: /|/|/|//\n  checkerX = abs(checkerX - 0.5) * 2.0; // make up and down: /// \n  checkerX = pow(checkerX, 3.0); // power to sharpen edges: __/__/\n\n  float checkerY = mod(checkPosition.y, 1.0 / cols) * cols;\n  checkerY = abs(checkerY - 0.5) * 2.0;\n  checkerY = pow(checkerY, 3.0);\n\n  float checkerMod = 0.0;\n  if (rows > 1.0 && floor(checkPosition.x * rows) == checkerMod) {\n    perc = 2.0;\n  }\n  if (cols > 1.0 && floor(checkPosition.y * cols) == checkerMod) {\n    perc = 2.0;\n  }\n\n  // float checker = (checkerX * checkerY) * 2.0;\n  float checker = (checkerX + checkerY) * 0.5;\n  float r1 = r * checker + 0.1;\n  float g1 = g * checker + 0.05;\n  float b1 = b * checker + 0.2;\n  float red = r1 * perc + pulse;\n  float green = g1 * perc + pulse;\n  float blue = b1 * perc + pulse + 0.05;\n\n  // float red = r;\n  // float green = g;\n  // float blue = b;\n\n  gl_FragColor = vec4(red, green, blue, 1.0);\n}";var perlin_grid=function perlin_grid(noise){var stage=document.createElement("div");var camera,scene,renderer;var mouse={x:0,y:0};var camPos={x:0,y:0,z:10};var sw=window.innerWidth,sh=window.innerHeight;var size={width:300,height:100,depth:300};var edgeSize=50;var gridUnits=7;var gridAbove=[];var gridBelow=[];var seed=Math.random();var holderAbove,holderBelow;function num(min,max){return Math.random()*(max-min)+min}function createMaterial(rows,cols,colourRand,distance){var colourBase={r:.7,g:.3,b:.6};var colour={r:colourBase.r+colourRand.r,g:colourBase.g+colourRand.g,b:colourBase.b+colourRand.b};var uniforms={r:{type:"f",value:colour.r},g:{type:"f",value:colour.g},b:{type:"f",value:colour.b},distance:{type:"f",value:distance},pulse:{type:"f",value:0},rows:{type:"f",value:rows},cols:{type:"f",value:cols}};var material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:vertexShader,fragmentShader:fragmentShader});return material}function cube(options){var width=options.dimensions.width;var height=options.dimensions.height;var depth=options.dimensions.depth;var colour=options.colour;var checker=options.checker;var distance=options.distance;var shaderRed=createMaterial(checker[0][0],checker[0][1],colour,distance);var shaderYellow=createMaterial(checker[1][0],checker[1][1],colour,distance);var shaderGreen=createMaterial(checker[2][0],checker[2][1],colour,distance);var shaderBlue=createMaterial(checker[3][0],checker[3][1],colour,distance);var shaderCyan=createMaterial(checker[4][0],checker[4][1],colour,distance);var shaderMagenta=createMaterial(checker[5][0],checker[5][1],colour,distance);var geometry=new THREE.BoxGeometry(width,height,depth);var mesh=new THREE.Mesh(geometry,new THREE.MeshFaceMaterial([shaderRed,shaderYellow,shaderGreen,shaderBlue,shaderCyan,shaderMagenta]));return mesh}var draw=function draw(x,z,distanceFromCentre){var colourRand={r:num(0,.5),g:num(0,.5),b:num(0,.5)};var vertProps={width:edgeSize,height:size.height,depth:edgeSize};var distance=size.width/2-edgeSize;var holder=new THREE.Group;var verticalEdgeBL=cube({dimensions:vertProps,checker:[[1,2],[1,2],[1,1],[1,1],[1,2],[1,2]],colour:colourRand,distance:distanceFromCentre});verticalEdgeBL.position.set(-distance,0,-distance);holder.add(verticalEdgeBL);var verticalEdgeBR=cube({dimensions:vertProps,checker:[[1,2],[1,2],[1,1],[1,1],[1,2],[1,2]],colour:colourRand,distance:distanceFromCentre});verticalEdgeBR.position.set(distance,0,-distance);holder.add(verticalEdgeBR);var verticalEdgeFL=cube({dimensions:vertProps,checker:[[1,2],[1,2],[1,1],[1,1],[1,2],[1,2]],colour:colourRand,distance:distanceFromCentre});verticalEdgeFL.position.set(-distance,0,distance);holder.add(verticalEdgeFL);var verticalEdgeFR=cube({dimensions:vertProps,checker:[[1,2],[1,2],[1,1],[1,1],[1,2],[1,2]],colour:colourRand,distance:distanceFromCentre});verticalEdgeFR.position.set(distance,0,distance);holder.add(verticalEdgeFR);var horizProps={width:size.width-edgeSize,height:edgeSize,depth:edgeSize};var horizontalEdgeF=cube({dimensions:horizProps,checker:[[1,1],[1,1],[5,1],[5,1],[5,1],[5,1]],colour:colourRand,distance:distanceFromCentre});horizontalEdgeF.position.set(0,(size.height+edgeSize)/2,-distance);holder.add(horizontalEdgeF);var horizontalEdgeB=cube({dimensions:horizProps,checker:[[1,1],[1,1],[5,1],[5,1],[5,1],[5,1]],colour:colourRand,distance:distanceFromCentre});horizontalEdgeB.position.set(0,(size.height+edgeSize)/2,distance);holder.add(horizontalEdgeB);return holder};function init(){return;scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(90,sw/sh,1,1e4);camera.position.set(0,100,500);scene.add(camera);var light=new THREE.DirectionalLight(16777215,2);light.position.set(1,1,1).normalize();scene.add(light);var light=new THREE.DirectionalLight(16711935,2);light.position.set(-1,0,0).normalize();scene.add(light);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holderAbove=new THREE.Group;scene.add(holderAbove);holderBelow=new THREE.Group;scene.add(holderBelow);for(var x=0;x<gridUnits;x++){for(var z=0;z<gridUnits;z++){var px=(x-gridUnits/2+.5)*size.width;var py=0;var pz=(z-gridUnits/2+.5)*size.depth;var distanceFromCentre=1-Math.sqrt(px*px+pz*pz)/1200;var boxAbove=draw(x,z,distanceFromCentre);boxAbove.position.set(px,py,pz);holderAbove.add(boxAbove);gridAbove.push(boxAbove);var boxBelow=draw(x,z,distanceFromCentre);boxBelow.position.set(px,py,pz);boxBelow.rotation.set(Math.PI,Math.PI/2,0);holderBelow.add(boxBelow);gridBelow.push(boxBelow)}}stage.appendChild(renderer.domElement);animate(0)}function listen(eventNames,callback){for(var i=0;i<eventNames.length;i++){window.addEventListener(eventNames[i],callback)}}listen(["resize"],function(e){sw=window.innerWidth;sh=window.innerHeight;camera.aspect=sw/sh;camera.updateProjectionMatrix();renderer.setSize(sw,sh)});listen(["mousedown","touchstart"],function(e){e.preventDefault();isMouseDown=true});listen(["mousemove","touchmove"],function(e){e.preventDefault();if(e.changedTouches&&e.changedTouches[0])e=e.changedTouches[0];mouse.x=e.clientX/sw*2-1;mouse.y=-(e.clientY/sh)*2+1});listen(["mouseup","touchend"],function(e){e.preventDefault();isMouseDown=false});function render(time){var breathDistance=1+(1+Math.sin(time*.004))*2;function renderBox(holder,value,x,z,above){value=value*value*value*value;var scale=1+value*50;var px=(x-gridUnits/2+.5)*size.width*breathDistance;var py=scale*size.height/2*above;var pz=(z-gridUnits/2+.5)*size.depth*breathDistance;holder.position.set(px,py,pz)}for(var z=0;z<gridUnits;z++){for(var x=0;x<gridUnits;x++){var gridIndex=x+z*gridUnits;var valueAbove=(noise.perlin3(x/gridUnits,z/gridUnits,seed)+1)/2;var valueBelow=(noise.perlin3(x/gridUnits,z+gridUnits*gridUnits/gridUnits,seed)+1)/2;var holderAbove=gridAbove[gridIndex];var holderBelow=gridBelow[gridIndex];renderBox(holderAbove,valueAbove,x,z,1);renderBox(holderBelow,valueBelow,x,z,-1)}}seed+=.01;var camDistance=400;camPos.x-=(camPos.x-mouse.x*1)*.02;camPos.y-=(camPos.y-mouse.y*1e3)*.05;var rotY=camPos.x*4;camera.position.set(Math.sin(rotY)*camDistance,camPos.y,Math.cos(rotY)*camDistance);camera.lookAt(scene.position);renderer.render(scene,camera)}function animate(time){requestAnimationFrame(animate);if(Math.random()>.99){var holder=Math.random()>.5?holderAbove:holderBelow;TweenMax.to(holder.rotation,.75,{y:Math.PI/2*Math.round(num(-2,2)),eade:Quad.easeInOut})}render(time)}return{init:init,stage:stage}};define("perlin_grid",["noise"],perlin_grid);"use strict";var perlin_leaves=function perlin_leaves(perlin){var timer=function(c){var t={},f=function f(){return(new Date).getTime()};return{start:function start(k){t[k]=f()},end:function end(k){c.log(k,f()-t[k])}}}(console);var pixel=10;var w=40;var h=40;var M=Math;var r=M.random;var c=document.createElement("canvas");c.width=w*pixel;c.height=h*pixel;var ctx=c.getContext("2d");var logger=document.createElement("div");document.body.appendChild(logger);var channelRed=perlin.noise(w,h);var seed=Math.random()*1e3;function drawIt(time){var red=channelRed.cycle(seed+.01*time,.01);for(var i=0,il=w*h;i<il;i++){var xp=i%w;var yp=Math.floor(i/w);var dx=xp-w/2;var dy=yp-h/2;var d=w/2-Math.sqrt(dx*dx+dy*dy);var r=~~(red[i]*255*d);ctx.fillStyle="rgb("+r+","+r+","+r+")";ctx.fillRect(xp*pixel,yp*pixel,pixel,pixel)}requestAnimationFrame(drawIt)}return{init:function init(){drawIt(0)},stage:c}};define("perlin_leaves",["perlin"],perlin_leaves);"use strict";var perlin_noise=function perlin_noise(perlin){var timer=function(c){var t={},f=function f(){return(new Date).getTime()};return{start:function start(k){t[k]=f()},end:function end(k){c.log(k,f()-t[k])}}}(console);var pixel=10;var w=60;var h=60;var M=Math;var r=M.random;var c=document.createElement("canvas");c.width=w*pixel;c.height=h*pixel;var d=c.getContext("2d");var logger=document.createElement("div");document.body.appendChild(logger);var iterations=0;var channelRed=perlin.noise(w,h);var channelGreen=perlin.noise(w,h);var channelBlue=perlin.noise(w,h);var min=1e3;var max=-1e3;function drawIt(time){var t=time*.005;var scale=.01;var red=channelRed.cycle(t,scale);var green=channelGreen.cycle(t,scale);var blue=channelBlue.cycle(t,scale);for(var i=0,il=w*h;i<il;i++){var xp=i%w;var yp=Math.floor(i/w);var r=~~(red[i]*255),g=~~(green[i]*255),b=~~(blue[i]*255);d.fillStyle="rgb("+r+","+g+","+b+")";d.fillRect(xp*pixel,yp*pixel,pixel,pixel);min=M.min(r,min);max=M.max(r,max);min=M.min(g,min);max=M.max(g,max);min=M.min(b,min);max=M.max(b,max)}logger.innerHTML=min+"<br>"+max;requestAnimationFrame(drawIt)}return{init:function init(){drawIt(0)},stage:c}};define("perlin_noise",["perlin"],perlin_noise);"use strict";var pine_three=function pine_three(){var camera,scene,renderer;var mouse={x:0,y:0};var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;function num(min,max){return Math.random()*(max-min)+min}var branchingAngle=num(0,10);var holder;var vectors=[];var generationComplete=false;var attempts=0;var bail=300;function cylinder(props){var group=new THREE.Group;var material=new THREE.MeshLambertMaterial({color:props.colour});var geometry=new THREE.CylinderGeometry(props.radius,props.radius,props.height,15);var object=new THREE.Mesh(geometry,material);object.position.y=props.height/2;group.add(object);return{colour:props.colour,group:group,object:object}}function init(){colours.getRandomPalette();scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(80,sw/sh,1,1e4);scene.add(camera);var lightAbove=new THREE.DirectionalLight(16777215,1.5);lightAbove.position.set(0,200,100);scene.add(lightAbove);var lightLeft=new THREE.DirectionalLight(16777215,4);lightLeft.position.set(-100,0,100);scene.add(lightLeft);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);var segmentRadius=10,segmentLength=50;function drawSection(parent,endPoint){var colour=colours.mutateColour(parent.colour,50);var child=cylinder({radius:segmentRadius,height:segmentLength,colour:colour});parent.group.add(child.group);parent.group.updateMatrixWorld();return child}var colour=colours.getRandomColour();var endPoint=new THREE.Vector3(0,0,0);var baseSection={colour:colour,group:holder};var one=drawSection(baseSection,endPoint);document.body.appendChild(renderer.domElement);render(0)}function render(time){if(generationComplete){holder.rotation.y+=.01}camPos.z=1e3;camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init,resize:function resize(){}}};define("pine_three",pine_three);"use strict";var sw=600,sh=600;var bmp=dom.canvas(sw,sh);document.body.appendChild(bmp.canvas);var frame=0;var t=(1+Math.sqrt(5))/2;var CodedIcosahedron={name:"CodedIcosahedron",vertex:[[-1,t,0],[1,t,0],[-1,-t,0],[1,-t,0],[0,-1,t],[0,1,t],[0,-1,-t],[0,1,-t],[t,0,-1],[t,0,1],[-t,0,-1],[-t,0,1]],face:[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]]};var planesArray=[];function createPlanes(shape,r,offset){if(offset==undefined)offset=make3DPoint(0,0,0);var sectors=shape.face.length;for(var i=0;i<sectors;i++){var face=shape.face[i];var plane=[];for(var f=0,fl=face.length;f<fl;f++){var vi=face[f];var v=shape.vertex[vi];point=make3DPoint(offset.x+v[0]*r,offset.y+v[1]*r,offset.z+v[2]*r);plane[f]=point}planesArray.push(plane)}}createPlanes(CodedIcosahedron,100);con.log(planesArray);function animation(){bmp.ctx.clearRect(0,0,sw,sh);renderPlanes(bmp.ctx,planesArray,{fillColor:function fillColor(p){var brightness=(p.slope.y/Math.PI+1)*255;var r=Math.round(.23*brightness);var g=Math.round(.62*brightness);var b=Math.round(.9*brightness);return"rgba("+[r,g,b,1].join(",")+")"}});frame++;cubeAxisRotations.x-=.01;cubeAxisRotations.y+=.01}animation();window.addEventListener("keydown",function(){animation()});"use strict";var polyhedra_three=function polyhedra_three(){var stage=document.createElement("div");var camera,scene,projector,renderer;var mouse={x:0,y:0};var sw=window.innerWidth,sh=window.innerHeight;sw=sh=400;var theta=0;var h=[];var i=0;var radius=20;var n;var polyhedron;var settings={};settings.lineScale=1;settings.lineSize=1+Math.random()*10*settings.lineScale;settings.lineGap=2+Math.random()*3*settings.lineScale;settings.baseRotation=0;settings.varyRotation=Math.random()*Math.PI*2;function createPattern(size){var half=size/2;var canvas=dom.canvas(size,size);var ctx=canvas.ctx;ctx.save();ctx.translate(half,half);ctx.rotate(settings.baseRotation+Math.random()*settings.varyRotation);ctx.translate(-half,-half);ctx.fillStyle=colours.getRandomColour();var padding=Math.sqrt(half*half*2)-half;var colour;var y=-padding;while(y<size+padding){colour=colours.getNextColour();ctx.fillStyle=colour;ctx.fillRect(-padding,y,size+padding*2,settings.lineSize);y+=settings.lineSize+settings.lineGap}return canvas.canvas}function draw(props){var i,il;var faces=[],faceRange=[],totalFaces=0;props.face.map(function(face){for(i=0,il=face.length-2;i<il;i++){faces.push(face[0],face[i+1],face[i+2])}totalFaces+=il;faceRange.push(totalFaces)});var vertices=[];props.vertex.map(function(vertex){vertex.map(function(vertexIndex){vertices.push(vertexIndex)})});var materials=[];for(i=0,il=props.face.length;i<il;i++){var r=Math.round(Math.random()*255);var g=Math.round(Math.random()*255);var b=Math.round(Math.random()*255);var col=r<<16|g<<8|b;var material=new THREE.MeshLambertMaterial({color:col});materials.push(material)}var geometry=new THREE.PolyhedronGeometry(vertices,faces,200,0);con.log("geometry",geometry);var materialIndex=0;for(i=0,il=geometry.faces.length;i<il;i++){if(faceRange.indexOf(i)>-1)materialIndex++;geometry.faces[i].materialIndex=materialIndex}var material=new THREE.MeshFaceMaterial(materials);var object=new THREE.Mesh(geometry,material);return object}function init(){var time1=(new Date).getTime();scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(70,sw/sh,1,1e4);camera.position.set(0,100,500);scene.add(camera);var light=new THREE.DirectionalLight(16777215,2);light.position.set(1,1,1).normalize();scene.add(light);var light=new THREE.DirectionalLight(16711935,2);light.position.set(-1,0,0).normalize();scene.add(light);renderer=new THREE.WebGLRenderer;renderer.setSize(sw,sh);var mesh=POLYHEDRA.Icosidodecahedron;polyhedron=draw(mesh);scene.add(polyhedron);stage.appendChild(renderer.domElement);document.addEventListener("mousemove",onDocumentMouseMove,false);var time2=(new Date).getTime();render();var time3=(new Date).getTime();con.log("times",time2-time1,time3-time2);animate()}function onDocumentMouseMove(event){event.preventDefault();mouse.x=event.clientX/sw*2-1;mouse.y=-(event.clientY/sh)*2+1}function render(){var camRadius=500;theta+=mouse.x*4;polyhedron.rotation.y=theta*.1;camera.lookAt(scene.position);renderer.render(scene,camera)}function animate(){requestAnimationFrame(animate);render()}var experiment={stage:stage,init:init};return experiment};define("polyhedra_three",polyhedra_three);"use strict";var race_lines_three=function race_lines_three(){var isMouseDown=false;var emptySlot="emptySlot",planeTop="planeTop",planeBottom="planeBottom";var camera,scene,renderer;var mouse={x:0,y:0};var camPos={x:0,y:0,z:10};var sw=window.innerWidth,sh=window.innerHeight;var cols=20;var rows=16;var gap=20;var size={width:100,height:30,depth:150};var planeOffset=250;var allRowsDepth=rows*(size.depth+gap);var allColsWidth=cols*(size.depth+gap);var speedNormal=4;var speedFast=34;var speed=speedNormal;var boxes={planeBottom:[],planeTop:[]};var boxes1d=[];function num(min,max){return Math.random()*(max-min)+min}function draw(props){var colours={slow:{r:num(0,.2),g:num(.5,.9),b:num(.3,.7)},fast:{r:num(.9,1),g:num(.1,.7),b:num(.2,.5)}};var uniforms={r:{type:"f",value:colours.slow.r},g:{type:"f",value:colours.slow.g},b:{type:"f",value:colours.slow.b},distanceX:{type:"f",value:1},distanceZ:{type:"f",value:1},pulse:{type:"f",value:0},speed:{type:"f",value:speed}};var material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:vertexShader,fragmentShader:fragmentShader});var geometry=new THREE.BoxGeometry(props.width,props.height,props.depth);var object=new THREE.Mesh(geometry,material);object.colours=colours;return object}function init(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(100,sw/sh,1,1e4);scene.add(camera);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);for(var j=0,jl=rows;j<jl;j++){boxes.planeBottom[j]=[];boxes.planeTop[j]=[];for(var i=0,il=cols;i<il;i++){boxes.planeBottom[j][i]=emptySlot;boxes.planeTop[j][i]=emptySlot}}function createBox(){var xi=Math.floor(Math.random()*cols),xai=xi;var yi=Math.random()>.5?1:-1,yai=yi===-1?planeBottom:planeTop;var zi=Math.floor(Math.random()*rows),zai=zi;var x=(xi-cols/2)*(size.width+gap);var y=yi*planeOffset;var z=zi*(size.depth+gap);if(boxes[yai][zai][xai]===emptySlot){var box=draw(size);box.position.y=y;box.isWarping=false;box.offset={x:x,z:0};box.posZ=z;boxes[yai][zai][xai]=box;boxes1d.push(box);scene.add(box)}}for(var i=0,il=rows*cols;i<il;i++){createBox()}document.body.appendChild(renderer.domElement);function listen(eventNames,callback){for(var i=0;i<eventNames.length;i++){window.addEventListener(eventNames[i],callback)}}listen(["resize"],function(e){sw=window.innerWidth;sh=window.innerHeight;camera.aspect=sw/sh;camera.updateProjectionMatrix();renderer.setSize(sw,sh)});listen(["mousedown","touchstart"],function(e){e.preventDefault();isMouseDown=true});listen(["mousemove","touchmove"],function(e){e.preventDefault();if(e.changedTouches&&e.changedTouches[0])e=e.changedTouches[0];mouse.x=e.clientX/sw*2-1;mouse.y=-(e.clientY/sh)*2+1});listen(["mouseup","touchend"],function(e){e.preventDefault();isMouseDown=false});render(0)}function move(x,y,z){var box=boxes[y][z][x];if(box!==emptySlot){box.position.x=box.offset.x;box.position.z=box.offset.z+box.posZ;if(box.position.z>0){box.posZ-=allRowsDepth}if(!box.isWarping&&Math.random()>.999){var dir=Math.floor(Math.random()*5),xn=x,zn=z,yn=y,yi=0,xo=0,zo=0;switch(dir){case 0:xn++;xo=1;break;case 1:xn--;xo=-1;break;case 2:zn++;zo=1;break;case 3:zn--;zo=-1;break;case 4:yn=y===planeTop?planeBottom:planeTop;yi=y===planeTop?-1:1;break}if(boxes[yn][zn]&&boxes[yn][zn][xn]===emptySlot){boxes[y][z][x]=emptySlot;box.isWarping=true;boxes[yn][zn][xn]=box;if(dir===4){TweenMax.to(box.position,.5,{y:yi*planeOffset})}else{TweenMax.to(box.offset,.5,{x:box.offset.x+xo*(size.width+gap),z:box.offset.z+zo*(size.depth+gap)})}TweenMax.to(box.offset,.6,{onComplete:function onComplete(){box.isWarping=false}})}}}}function render(time){speed-=(speed-(isMouseDown?speedFast:speedNormal))*.05;var box;for(var b=0,bl=boxes1d.length;b<bl;b++){box=boxes1d[b];box.posZ+=speed;var distanceZ=1-((allRowsDepth-box.posZ)/allRowsDepth-1);box.material.uniforms.distanceZ.value=distanceZ;var distanceX=1-Math.abs(box.position.x)/(allColsWidth/3);box.material.uniforms.distanceX.value=distanceX;var colour=isMouseDown?box.colours.fast:box.colours.slow;box.material.uniforms.r.value-=(box.material.uniforms.r.value-colour.r)*.1;box.material.uniforms.g.value-=(box.material.uniforms.g.value-colour.g)*.1;box.material.uniforms.b.value-=(box.material.uniforms.b.value-colour.b)*.1;var currentSpeed=(speed-speedNormal)/(speedFast-speedNormal);box.material.uniforms.speed.value=currentSpeed;if(Math.random()>.99995-currentSpeed*.005){box.material.uniforms.pulse.value=1}box.material.uniforms.pulse.value-=box.material.uniforms.pulse.value*.1/(currentSpeed+1)}for(var j=0,jl=rows;j<jl;j++){for(var i=0,il=cols;i<il;i++){move(i,planeBottom,j);move(i,planeTop,j)}}camPos.x-=(camPos.x-mouse.x*400)*.02;camPos.y-=(camPos.y-mouse.y*150)*.05;camPos.z=-100;camera.position.set(camPos.x,camPos.y,camPos.z);camera.rotation.y=camPos.x/-1e3;camera.rotation.x=camPos.y/1e3;camera.rotation.z=(camPos.x-mouse.x*400)/2e3;renderer.render(scene,camera);requestAnimationFrame(render)}var vertexShader=["varying vec2 vUv;","void main()","{","  vUv = uv;","  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","  gl_Position = projectionMatrix * mvPosition;","}"].join("");var fragmentShader=["uniform float r;","uniform float g;","uniform float b;","uniform float distanceZ;","uniform float distanceX;","uniform float pulse;","uniform float speed;","varying vec2 vUv;","void main( void ) {","  vec2 position = abs(-1.0 + 2.0 * vUv);","  float edging = abs((pow(position.y, 5.0) + pow(position.x, 5.0)) / 2.0);","  float perc = (0.2 * pow(speed + 1.0, 2.0) + edging * 0.8) * distanceZ * distanceX;","  float red = r * perc + pulse;","  float green = g * perc + pulse;","  float blue = b * perc + pulse;","  gl_FragColor = vec4(red, green, blue, 1.0);","}"].join("");return{init:init,resize:function resize(){}}};define("race_lines_three",race_lines_three);"use strict";var con=console;var sw=window.innerWidth,sh=window.innerHeight;var bmp=document.createElement("canvas");bmp.width=sw;bmp.height=sh;document.body.appendChild(bmp);var ctx=bmp.getContext("2d");var circleRads=Math.PI*2;var numInitial=15;var numCurrent=numInitial;var numMax=30;var particles=[];var deaths=[];function moveParticle(p){if(p.dying){p.age++}p.dirFloat+=(Math.random()-.5)*Math.PI*.5;p.dir-=(p.dir-p.dirFloat)*.01;p.vx=Math.cos(p.dir)*p.speed;p.vy=Math.sin(p.dir)*p.speed;p.x+=p.vx;p.y+=p.vy;var padding=100;if(p.x>sw+padding)p.x-=sw+padding*2;if(p.x<-padding)p.x+=sw+padding*2;if(p.y>sh+padding)p.y-=sh+padding*2;if(p.y<-padding)p.y+=sh+padding*2;p.angle=Math.atan(p.vy/p.vx);var a=-p.angle;if(p.vx<=0)a+=Math.PI;for(var j=0;j<p.lines;j++){ctx.fillStyle=p.palette[j];var r=3;if(p.dying)r/=1+p.age*.01;var d=(j-p.lines/2+.5)*r*2;var x=p.x+Math.sin(a)*d;var y=p.y+Math.cos(a)*d;ctx.beginPath();ctx.arc(x,y,r,0,circleRads,false);ctx.closePath();ctx.fill()}if(p.dying&&p.age>500){killParticle(p)}else if(p.children==0&&numCurrent<numMax&&Math.random()>.99){spawnParticle(p)}}function killParticle(p){var index=particles.indexOf(p);particles.splice(index,1);numCurrent--;deaths.push({anim:0,lines:p.lines,x:p.x,y:p.y})}function animateDeath(death){death.anim++;var maxAnim=50;if(death.anim>maxAnim){var index=deaths.indexOf(death);deaths.splice(index,1)}else{var d=death.anim*.4;var perc=(maxAnim-death.anim)/maxAnim;for(var j=0;j<death.lines;j++){var a=j/death.lines*Math.PI*2;var x=death.x+Math.sin(a)*d;var y=death.y+Math.cos(a)*d;var r=perc+.01;ctx.fillStyle="rgba(255,255,255,"+perc+")";ctx.beginPath();ctx.arc(x,y,r,0,circleRads,false);ctx.closePath();ctx.fill()}}}function generateParticle(parent){if(parent){return{age:0,children:0,dir:parent.dir,dirFloat:parent.dirFloat,dying:false,lines:parent.lines,palette:parent.palette,speed:parent.speed,vx:parent.vx,vy:parent.vy,x:parent.x,y:parent.y}}else{var lines=3+parseInt(Math.random()*6);var palette=[];for(var i=0;i<lines;i++){palette.push("hsl("+i/lines*360+",50%,50%)")}return{age:0,children:0,dir:Math.random()*Math.PI*2,dirFloat:0,dying:false,lines:lines,palette:palette,speed:Math.random()*1.5+.5,vx:0,vy:0,x:Math.random()*sw,y:Math.random()*sh}}}function spawnParticle(parent){parent.dying=true;parent.children++;particles[numCurrent]=generateParticle(parent);numCurrent++}function generate(){for(var i=0;i<numInitial;i++){particles[i]=generateParticle()}}function render(time){ctx.fillStyle="rgba(0,0,0,0.04)";ctx.fillRect(0,0,sw,sh);for(var i=0;i<deaths.length;i++){animateDeath(deaths[i])}for(i=0;i<numCurrent;i++){moveParticle(particles[i])}requestAnimationFrame(render)}window.addEventListener("resize",function(){bmp.width=sw=window.innerWidth;bmp.height=sh=window.innerHeight});generate();render(0);"use strict";var con=console;var rand=function(){var m=4294967296,a=1664525,c=1013904223,seed,z;var alphaToInteger=function alphaToInteger(s){var num=0;for(var i=0,il=s.length;i<il;i++){num+=s.charCodeAt(i)*c;num%=m}return num};return{setSeed:function setSeed(val){var valDefined=val||val===0;if(valDefined){if(/[^\d]/.test(val)){val=alphaToInteger(val)}else{val=Number(val)}}else{val=Math.round(Math.random()*m)}z=seed=val},getSeed:function getSeed(){return seed},random:function random(){if(z===undefined){console.warn("no seed set");return null}z=(a*z+c)%m;return z/m},getLastRandom:function getLastRandom(){return z/m},getNumber:function getNumber(min,max){return min+this.random()*(max-min)},getInteger:function getInteger(min,max){return Math.floor(this.getNumber(min,max+1))},alphaToInteger:alphaToInteger,shuffle:function shuffle(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(rand.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array}}}();if(typeof module!=="undefined")module.exports=rand;"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var rectangular_fill=function rectangular_fill(){var size=800,sw=size,sh=size;var block,stroke;var rows=30;var cols=20;var populated=[];var available=[];var squares=[];var total=0;var bmp=dom.canvas(1,1);function setBlock(size){var width=Math.ceil(rand.random()*size);var height=Math.ceil(rand.random()*size);var colour=colours.getRandomColour();var startIndex=Math.floor(available.length*rand.random());var start=available[startIndex];var y=start%rows;var x=Math.floor(start/rows);var ok=true;var xxe=x+width;if(xxe>cols){xxe=cols;width=cols-x}var yye=y+height;if(yye>rows){yye=rows;height=rows-y}for(var xx=x;xx<xxe&&ok;xx++){for(var yy=y;yy<yye&&ok;yy++){if(populated[xx][yy])ok=false}}if(ok){for(var xx=x;xx<xxe&&ok;xx++){for(var yy=y;yy<yye&&ok;yy++){populated[xx][yy]=colour;var id=xx*rows+yy;var availIndex=available.indexOf(id);available.splice(availIndex,1)}}squares.push({colour:colour,x:x*block+stroke,y:y*block+stroke,w:width*block-2*stroke,h:height*block-2*stroke})}}var attempts=0;var lastProgress=0;function tryPosition(){attempts++;var size=17;if(attempts>1e4/2){size=1}else if(attempts>1e4){render();return con.warn("bailing!",attempts)}if(attempts%100==0){var currentProgress=(total-available.length)/total;if(lastProgress!==currentProgress)progress("render:progress",currentProgress);lastProgress=currentProgress}setBlock(size);if(available.length){if((attempts+1)%1e3==0){setTimeout(tryPosition,100)}else{tryPosition()}}else{render()}}function init(){colours.getRandomPalette();block=Math.round(20*(.2+rand.random()*.8));stroke=block*(.1+rand.random())*.4;bmp.setSize(block*cols,block*rows);for(var x=0;x<cols;x++){populated[x]=[];for(var y=0;y<rows;y++){populated[x][y]=0;available.push(x*rows+y)}}total=cols*rows;tryPosition()}function render(){bmp.ctx.setTransform(1,rand.random()*.2-.1,rand.random()*.2-.1,1,0,0);for(var s=0,sl=squares.length;s<sl;s++){var rect=squares[s];bmp.ctx.fillStyle=rect.colour;bmp.ctx.fillRect(rect.x,rect.y,rect.w,rect.h)}progress("render:complete",bmp.canvas)}return{name:"Rectangular Fill",stage:bmp.canvas,resize:function resize(w,h){bmp.setSize(w,h,true)},init:init,kill:function kill(){}}};if(isNode){module.exports=rectangular_fill()}else{define("rectangular_fill",rectangular_fill)}(function(){var canvas,centre,con,createSlider,ctx,d,draw,init,redraw,rotMod,settings,size;con=console;d=document;canvas=null;size=600;centre=size/2;ctx=null;rotMod=Math.PI/4;settings={};createSlider=function(prop,min,max,ini,granularity){var change,changeText,div,input,label,range;if(granularity==null){granularity=1}div=d.createElement("div");label=d.createElement("label");label.innerHTML=""+prop+":";input=d.createElement("input");input.type="text";input.value=ini;range=d.createElement("input");range.type="range";range.min=min/granularity;range.max=max/granularity;range.name=prop;range.value=ini/granularity;div.appendChild(label);div.appendChild(range);div.appendChild(input);d.body.appendChild(div);change=function(e){var v;v=e.target.value*granularity;settings[prop]=Number(v);input.value=v;return redraw()};changeText=function(e){var v;v=e.target.value;settings[prop]=Number(v);range.value=v/granularity;return redraw()};input.addEventListener("change",changeText);range.addEventListener("change",change);range.addEventListener("input",change);return settings[prop]=ini};createSlider("items",1,10,2);createSlider("maxRecursion",1,10,5);createSlider("angleSpiral",0,2,1,.01);createSlider("angleSpread",0,2,Math.PI/2,.01);createSlider("symmetry",-1,1,0,.01);createSlider("scale",0,10,1,.01);redraw=function(){canvas.width=canvas.width;return draw(centre,50,0,0)};draw=function(x,y,branchAngle,level){var alpha,angleSpiral,angleSpread,branchScale,h,half,items,j,maxRecursion,newX,newY,rgb,rotation,scale,w,_i,_results;level++;items=settings.items;maxRecursion=settings.maxRecursion;angleSpiral=settings.angleSpiral;angleSpread=settings.angleSpread;alpha=1-level/maxRecursion;_results=[];for(j=_i=0;0<=items?_i<items:_i>items;j=0<=items?++_i:--_i){half=(items-1)/2;branchScale=1-(j-half)/half*settings.symmetry;scale=settings.scale/level*branchScale;w=30*scale;h=100*scale;rotation=angleSpread*(j-half)+branchAngle*angleSpiral;ctx.save();ctx.translate(x,y);ctx.rotate(rotation);rgb=0;ctx.fillStyle="rgba("+rgb+","+rgb+","+rgb+","+alpha+")";ctx.fillRect(-w*1/2,0,w*1,h*1);ctx.restore();newX=x+h*-Math.sin(rotation);newY=y+h*Math.cos(rotation);if(level<maxRecursion){_results.push(draw(newX,newY,rotation,level,j))}else{_results.push(void 0)}}return _results};init=function(){canvas=d.createElement("canvas");canvas.width=canvas.height=size;d.body.appendChild(canvas);ctx=canvas.getContext("2d");return redraw()};init()}).call(this);"use strict";define("recursive_circle",function(){var TAU=Math.PI*2;var furSize=20;var sw=600,sh=sw;var maxRecursion=4;var stage=dom.canvas(sw,sh);var ctx=stage.ctx;function init(){render(0)}function render(time){var renders=0;var t=time*3e-4;var proportion=2/3;var ringItems=6;ctx.globalCompositeOperation="source-over";ctx.clearRect(0,0,sw,sh);function calc(recursion,cx,cy,size){var angleBase=Math.sin(t)*TAU/ringItems*recursion;renders++;var outerBoundary=size/2;var innerBoundary=outerBoundary*proportion/2;var inscribedRadius=(outerBoundary-innerBoundary)/2;var centreLine=innerBoundary+inscribedRadius;for(var i=0;i<ringItems;i++){var a=angleBase+i/ringItems*TAU;var x=cx+Math.sin(a)*centreLine;var y=cy+Math.cos(a)*centreLine;if(recursion<maxRecursion){calc(recursion+1,x,y,outerBoundary*proportion)}else{ctx.fillStyle="#fff";ctx.globalCompositeOperation="source-over";ctx.beginPath();ctx.drawCircle(x*sw,y*sw,inscribedRadius*sw);ctx.fill();ctx.fillStyle="#000";ctx.globalCompositeOperation="destination-out";ctx.beginPath();ctx.drawCircle(x*sw,y*sw,inscribedRadius*proportion/2*sw);ctx.fill()}}}calc(1,.5,.5,1);requestAnimationFrame(render)}return{resize:function resize(w,h){},init:init,stage:stage.canvas}});"use strict";var isNode=typeof module!=="undefined";if(isNode){var dom=require("./dom.js")}function splitPolygon(array,start,end){var copy=array.slice();var chunk1=copy.slice(0,start+1);var chunk3=copy.splice(end,array.length-end);var chunk2=array.slice().splice(start,end-start+1);var array1=chunk1.concat(chunk3);var array2=chunk2;return[array1,array2]}var recursive_polygon=function recursive_polygon(){var sw=700,sh=700;var bmp=dom.canvas(sw,sh);var insetDistance;var mutateThreshold;var mutateAmount;var maxDepth;var sides;var splitLongest;var splitEdgeRatioLocked;var insetLocked,insetLockedValue,insetThreshold;var wonky;function generateParent(){var colour=colours.getNextColour();var i=0;var cx=.5;var cy=.5;var points=[];var angles=[];while(angles.length<sides){angles.push(i/sides);i++}angles.sort();for(i=0;i<angles.length;i++){var angle=angles[i]*Math.PI*2;var radius=wonky?rand.getNumber(.4,.45):.45;var x=cx+Math.sin(angle)*radius;var y=cy+Math.cos(angle)*radius;points.push({x:x*sw,y:y*sh})}drawNext({points:points,colour:colour,depth:0})}var iterations=0;function drawNext(parent){delayedDraw();function delayedDraw(){var depth=parent.depth+1;if(depth>maxDepth)return;iterations++;if(iterations>1e4)return;var copied=parent.points.slice();var len=copied.length;var slicerStart,slicerEnd;if(len>3){var offset=rand.getInteger(0,len);var shifted=copied.splice(0,offset);copied=copied.concat(shifted);slicerStart=0;slicerEnd=rand.getInteger(2,len-2)}else{var edge=splitLongest?getLongest(copied):rand.getInteger(0,2);var splitRatio=splitEdgeRatioLocked?splitEdgeRatioLocked:rand.getNumber(.1,.9);var newPoint;switch(edge){case 0:newPoint=geom.lerp(copied[0],copied[1],splitRatio);copied.splice(1,0,newPoint);slicerStart=1;slicerEnd=3;break;case 1:newPoint=geom.lerp(copied[1],copied[2],splitRatio);copied.splice(2,0,newPoint);slicerStart=0;slicerEnd=2;break;case 2:newPoint=geom.lerp(copied[2],copied[0],splitRatio);copied.push(newPoint);slicerStart=1;slicerEnd=3}}var newArrays=splitPolygon(copied,slicerStart,slicerEnd);drawSplit(parent,newArrays[0],depth);drawSplit(parent,newArrays[1],depth)}}function drawSplit(parent,points,depth){var colour=mutateThreshold&&rand.random()<mutateThreshold?colours.mutateColour(parent.colour,mutateAmount):colours.getNextColour();var inset=insetLocked?insetLockedValue:rand.random()>insetThreshold;if(inset){var insetPoints=geom.insetPoints(points,insetDistance);if(insetPoints){drawPolygon(points,{fillStyle:colour,strokeStyle:colour,lineWidth:1});bmp.ctx.globalCompositeOperation="destination-out";drawPolygon(insetPoints,{fillStyle:"black"});bmp.ctx.globalCompositeOperation="source-over";drawNext({points:points,colour:colour,depth:depth})}}else{drawPolygon(points,{fillStyle:colour,strokeStyle:colour,lineWidth:1});if(rand.random()>.5){drawNext({points:points,colour:colour,depth:depth})}}}function fillAndStroke(options){if(options.lineWidth&&options.strokeStyle){bmp.ctx.strokeStyle=options.strokeStyle;bmp.ctx.lineWidth=options.lineWidth;bmp.ctx.stroke()}if(options.fillStyle){bmp.ctx.fillStyle=options.fillStyle;bmp.ctx.fill()}}function drawPolygon(points,options){bmp.ctx.beginPath();for(var i=0;i<points.length;i++){var p=points[i];bmp.ctx[i==0?"moveTo":"lineTo"](p.x,p.y)}bmp.ctx.closePath();fillAndStroke(options)}function drawLine(p0,p1,colour,lineWidth){bmp.ctx.strokeStyle=colour;bmp.ctx.lineWidth=lineWidth;bmp.ctx.beginPath();bmp.ctx.moveTo(p0.x,p0.y);bmp.ctx.lineTo(p1.x,p1.y);bmp.ctx.stroke()}function getLongest(points){function getLength(p0,p1){var dx=p0.x-p1.x,dy=p0.y-p1.y;return Math.sqrt(dx*dx+dy*dy)}var len=0,edgeIndex=null;for(var i=0,il=points.length;i<il;i++){var p0=points[i];var p1=points[(i+1)%il];var p0p1Len=getLength(p0,p1);if(p0p1Len>len){len=p0p1Len;edgeIndex=i}}return edgeIndex}function drawPoint(p,options){bmp.ctx.beginPath();bmp.ctx.drawCircle(p.x,p.y,5);fillAndStroke(options)}function init(){sides=3+Math.round(rand.random()*rand.random()*rand.random()*28);if(sides<5){wonky=rand.random()>.8}insetDistance=rand.getNumber(2,25);mutateThreshold=rand.getNumber(0,1);mutateAmount=rand.getNumber(5,30);maxDepth=rand.getInteger(1,10);splitLongest=rand.random()>.5;splitEdgeRatioLocked=rand.random()>.5?.5:false;insetLocked=rand.random()>.5;if(insetLocked){insetLockedValue=rand.random()>.5}else{insetThreshold=rand.random()*.5}con.log("sides",sides);con.log("wonky",wonky);con.log("insetDistance",insetDistance);con.log("mutateThreshold",mutateThreshold);con.log("mutateAmount",mutateAmount);con.log("maxDepth",maxDepth);con.log("splitLongest",splitLongest);con.log("splitEdgeRatioLocked",splitEdgeRatioLocked);con.log("insetLocked",insetLocked);con.log("insetLockedValue",insetLockedValue);con.log("insetThreshold",insetThreshold);colours.getRandomPalette();generateParent();progress("render:complete",bmp.canvas)}return{stage:bmp.canvas,init:init,settings:{}}};if(isNode){module.exports=recursive_polygon()}else{define("recursive_polygon",recursive_polygon)}"use strict";"use strict";define("seven_four_sevens",function(){var sw=900,sh=600;var canvas=dom.canvas(sw,sh);var images=[];var planes=[];var text=dom.element("div",{innerText:"Click to make a new waypoint, shift click to add multiple",style:{color:"white"}});var button=dom.button("Add planes",{className:"button"});document.body.appendChild(text);document.body.appendChild(button);dom.on(canvas.canvas,["click"],function(e){if(!e.shiftKey)_root.holdingpattern=[];_root.holdingpattern.push({_x:e.x,_y:e.y})});dom.on(button,["click"],function(e){planes.push(Plane())});var _root={holdingpattern:[{_x:rand.getNumber(0,sw),_y:rand.getNumber(0,sh)},{_x:rand.getNumber(0,sw),_y:rand.getNumber(0,sh)},{_x:rand.getNumber(0,sw),_y:rand.getNumber(0,sh)}],createSmoke:function createSmoke(){}};function Plane(){var PI=Math.PI;var PI2=Math.PI*2;var xdelta,ydelta,angle,targetangle,distance,deltaangle,planeframe;var cA,tA;var arrow={};var tAngle=0;var turnMax,turnRate;var count=0;var cf;var shape={gotoAndStop:function gotoAndStop(frame){shape._currentframe=frame},_currentframe:1,_rotation:0};var _x=Math.random()*sw;var _y=Math.random()*sh;var dir=Math.random()*PI2;var speed=Math.random()*.4+2;var scale=(speed-1)/2;con.log(speed,scale);var turnMax=Math.random()*.03+.01;var turnRate=turnMax/20;var holdingpatternpos=Math.floor(Math.random()*_root.holdingpattern.length);var targ=_root.holdingpattern[holdingpatternpos];function moveIt(){if(!targ){holdingpatternpos=Math.floor(Math.random()*_root.holdingpattern.length);targ=_root.holdingpattern[holdingpatternpos]}xdelta=_x-targ._x;ydelta=_y-targ._y;distance=Math.sqrt(Math.pow(xdelta,2)+Math.pow(ydelta,2));if(distance<75){holdingpatternpos++;if(holdingpatternpos>=_root.holdingpattern.length){holdingpatternpos=0}targ=_root.holdingpattern[holdingpatternpos]}arrow._xscale=arrow._yscale=distance/5;angle=Math.atan(ydelta/xdelta);if(xdelta<0){targetangle=.5*PI-angle}else{targetangle=1.5*PI-angle}deltaangle=dir-targetangle;if(Math.abs(deltaangle)>PI){if(deltaangle<0){deltaangle=deltaangle%PI+PI;dir=dir+PI2}else{deltaangle=deltaangle%PI-PI;dir=dir-PI2}}cf=shape._currentframe;if(deltaangle>.1){if(tAngle<turnMax){tAngle+=turnRate}else{tAngle=turnMax}shape.gotoAndStop(58-(Math.round(tAngle/turnMax*29)+28))}else if(deltaangle<-.1){if(tAngle>-turnMax){tAngle-=turnRate}else{tAngle=-turnMax}shape.gotoAndStop(58-(Math.round(tAngle/turnMax*29)+28))}else{tAngle=deltaangle/50;if(cf<28){shape.gotoAndStop(cf+1)}else if(cf>28){shape.gotoAndStop(cf-1)}}dir-=tAngle;arrow._rotation=-targetangle*180/PI;shape._rotation=-dir;_x+=Math.sin(dir)*speed;_y+=Math.cos(dir)*speed;canvas.ctx.save();canvas.ctx.translate(_x,_y);canvas.ctx.rotate(shape._rotation);var flipX=false;var cfFrame=Math.floor(shape._currentframe/3.1);if(cfFrame>9){flipX=true;cfFrame=19-cfFrame}var cfImage=images[cfFrame];var img=cfImage.masked.canvas;canvas.ctx.scale((flipX?-1:1)*scale,scale);canvas.ctx.translate(-img.width/2,-img.height/2);canvas.ctx.drawImage(img,0,0);canvas.ctx.restore();count++;if(count>3){count=0;_root.createSmoke(this)}}return moveIt}function init(){var frames=10,loaded=0;function loadComplete(){loaded++;if(loaded==frames*2){for(var f=0;f<frames;f++){var maskImage=images[f].mask;var mask;var mask=dom.canvas(maskImage.width,maskImage.height);mask.ctx.drawImage(maskImage,0,0);var data=mask.ctx.getImageData(0,0,maskImage.width,maskImage.height);var i=0;while(i<data.data.length){var rgb=data.data[i++]+data.data[i++]+data.data[i++];data.data[i++]=255-rgb/3}mask.ctx.putImageData(data,0,0);var masked=dom.canvas(maskImage.width,maskImage.height);masked.ctx.drawImage(images[f].plane,0,0);masked.ctx.globalCompositeOperation="destination-out";masked.ctx.drawImage(mask.canvas,0,0);masked.ctx.globalCompositeOperation="source-over";images[f].masked=masked}startAnimation()}}function startAnimation(){planes=[Plane()];function update(){requestAnimationFrame(update);canvas.ctx.fillStyle="#1a4859";canvas.ctx.fillRect(0,0,sw,sh);for(var i=0;i<_root.holdingpattern.length;i++){var waypoint=_root.holdingpattern[i];canvas.ctx.beginPath();canvas.ctx.drawCircle(waypoint._x,waypoint._y,20);canvas.ctx.closePath();canvas.ctx.fillStyle="#259bc6";canvas.ctx.fill();canvas.ctx.beginPath();canvas.ctx.fillStyle="white";canvas.ctx.font="18px Helvetica";canvas.ctx.fillText(i+1,waypoint._x-5,waypoint._y+5);canvas.ctx.fill()}for(i=0;i<planes.length;i++){var p=planes[i];p()}}update()}for(var i=0;i<frames;i++){var plane=new Image;plane.onload=loadComplete;plane.src="/assets/seven_four_sevens/Image "+(i+1)+" at frame 0.jpg";var mask=new Image;mask.onload=loadComplete;mask.src="/assets/seven_four_sevens/Image "+(i+1)+" alpha channel at frame 0.png";images[i]={plane:plane,mask:mask,masked:null}}}return{init:init,stage:canvas.canvas}});"use strict";var sw=600,sh=600;var bmp=dom.canvas(sw,sh);document.body.appendChild(bmp.canvas);var h=0;var cx=sw/2;var cy=sh/2;var frame=0;function newLine(){bmp.ctx.clearRect(0,0,sw,sh);var rings=25;var dotsPerRing=10+Math.sin(frame*4e-4)*4;var ring=20+Math.sin(frame*.001)*4;function getArc(point){var perc=point/dotsPerRing;var angle=perc*Math.PI*2;var radius=perc*ring;return{x:cx+Math.sin(angle)*radius,y:cy+Math.cos(angle)*radius}}bmp.ctx.beginPath();bmp.ctx.strokeStyle="red";bmp.ctx.lineWidth=ring*.7;for(var h=0;h<dotsPerRing*rings;h++){var point=getArc(h-1);if(h==0){bmp.ctx.moveTo(point.x,point.y)}else{bmp.ctx.lineTo(point.x,point.y)}}bmp.ctx.stroke();frame+=1;if(frame<50)requestAnimationFrame(newLine)}newLine();(function(){var bits,centre,con,ctx,d,drawRing,gap,init,size,time,timeLoop,timeRingDelay,timeStep,yOffset;con=console;d=document;bits=20;gap=16;size=bits*gap*2;centre=size/2;ctx=null;time=0;yOffset=0;timeLoop=2e3;timeStep=300;timeRingDelay=20;init=function(){var can;can=d.createElement("canvas");can.width=can.height=size;d.body.appendChild(can);ctx=can.getContext("2d");return setInterval(function(_this){return function(){var i,_i,_results;time+=1;time%=timeLoop;ctx.clearRect(0,0,size,size);_results=[];for(i=_i=0;_i<bits;i=_i+=1){_results.push(drawRing(i))}return _results}}(this),1e3/60)};drawRing=function(i){var dot,inOutCubic,j,perside,rgb,s,timeEnd,timeMove,timeStart,x,y,zeroToOne,_i,_j,_results;perside=i*2;_results=[];for(s=_i=0;_i<4;s=_i+=1){ctx.save();ctx.translate(centre,centre);ctx.rotate(s*Math.PI/2);for(j=_j=0;_j<=perside;j=_j+=1){inOutCubic=function(t,b,c,d){var tc,ts;ts=(t/=d)*t;tc=ts*t;return b+c*(-2*tc+3*ts)};timeStart=(i+1)*timeRingDelay;timeEnd=timeStart+timeStep;timeMove=timeEnd-timeStart;zeroToOne=time>timeEnd?1:time>timeStart?(time-timeStart)/timeMove:0;yOffset=inOutCubic(zeroToOne,0,gap,1);x=gap*(-i-1/2);y=gap*(-j+i-1/2)+yOffset;rgb=0;ctx.fillStyle="rgba("+rgb+","+rgb+","+rgb+",1)";dot=6;ctx.fillRect(x-dot/2,y-dot/2,dot,dot)}_results.push(ctx.restore())}return _results};init()}).call(this);"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var rand=require("./rand.js");var dom=require("./dom.js")}var state_of_origin_52_6=function state_of_origin_52_6(){var QLD="QLD",NSW="NSW";var font="180px helvetica";var red="#f00";var bmpSize=200;var overScale;var output=dom.canvas(1,1);var machines={};var progressions={NSW:0,QLD:0};var complete={NSW:false,QLD:false};function initState(state,score,x,y,maxGlyphs){var count=0,countMax=150*maxGlyphs;var testCanvas=dom.canvas(bmpSize,bmpSize);var progressCanvas=dom.canvas(bmpSize,bmpSize);function pointInShape(point){testCanvas.ctx.globalCompositeOperation="source-over";testCanvas.ctx.drawImage(progressCanvas.canvas,0,0);testCanvas.ctx.globalCompositeOperation="source-in";drawShape(testCanvas.ctx,point,false,false);var pad=20;var width=Math.ceil(point.size+pad)*2;var height=Math.ceil(point.size+pad);var xs=Math.floor(point.x-width);var ys=Math.floor(point.y-height*2);width=width*2;height=height*2;var pixels=testCanvas.ctx.getImageData(xs,ys,width,height).data;var ok=true;for(var x=0;x<width&&ok;x++){for(var y=0;y<height&&ok;y++){var pixel=(y*width+x)*4;ok=pixels[pixel]===0}}testCanvas.ctx.globalCompositeOperation="source-over";testCanvas.ctx.fillStyle=ok?"rgba(0, 0, 255, 0.25)":"rgba(255, 0, 0, 0.25)";testCanvas.ctx.fillRect(xs,ys,width,height);return ok}function newPosition(){var padX=bmpSize*0;var padY=bmpSize*.1;return{x:padX+rand.random()*(bmpSize-padX*2),y:padY+rand.random()*(bmpSize-padY*2),size:getScaleFromCount(count)}}function drawShape(target,props,fx,renderOuput){var fillStyle;if(fx){}var renderScale=renderOuput?overScale/2:1;var scale=2*props.size/bmpSize*renderScale;var x=(props.x-props.size)*renderScale;var y=(props.y-props.size)*renderScale;if(renderOuput){x+=bmpSize*renderScale/2;if(state===NSW){y+=bmpSize*renderScale*.8}var grey=rand.getInteger(200,254);fillStyle="rgb("+grey+","+grey+","+grey+")"}else{fillStyle=red}target.save();target.translate(x,y);target.scale(scale,scale);target.font=font;target.fillStyle=fillStyle;target.fillText(state,0,0);target.restore()}function generate(){var proposed=newPosition();var ok=pointInShape(proposed);if(ok){count++;drawShape(output.ctx,proposed,true,true);drawShape(progressCanvas.ctx,proposed,true,false)}}function getScaleFromCount(c){var sc=.75+rand.random()*4*(.001+countMax-c)/countMax;return sc}progressCanvas.ctx.clearRect(0,0,bmpSize,bmpSize);progressCanvas.ctx.fillStyle=red;progressCanvas.ctx.fillRect(0,0,bmpSize,bmpSize);progressCanvas.ctx.globalCompositeOperation="destination-out";progressCanvas.ctx.save();progressCanvas.ctx.translate(bmpSize*x,bmpSize*y);progressCanvas.ctx.font=font;progressCanvas.ctx.fillText(score,0,0);progressCanvas.ctx.restore();progressCanvas.ctx.globalCompositeOperation="source-over";function bruteForce(){if(count<countMax){var iterationsPerFrame=100;for(var i=0;i<iterationsPerFrame&&count<countMax;i++){generate(true);generate(false)}progressions[state]=count/countMax}else{complete[state]=true}}machines[state]=bruteForce}function init(options){overScale=options.size/bmpSize;con.log("state of origin init",options,overScale);output.setSize(bmpSize*overScale,bmpSize*overScale);initState(QLD,52,-.02,.9,3);initState(NSW,6,.23,.9,2);loop()}function loop(){machines.NSW();machines.QLD();if(complete.NSW&&complete.QLD){progress("render:complete",output.canvas)}else{progress("render:progress",(progressions.NSW+progressions.QLD)/2);setTimeout(loop,1)}}var experiment={stage:output.canvas,init:init};return experiment};if(isNode){module.exports=state_of_origin_52_6()}else{define("state_of_origin_52_6",state_of_origin_52_6)}"use strict";var synth_ambient=function synth_ambient(Tone){function init(){var watchOut=dom.element("h1",{innerHTML:"Beware your speakers!"});document.body.appendChild(watchOut);var loadNext=dom.button("Load another permutation",{style:{border:"1px solid black",borderRadius:"5px",display:"inline-block",padding:"5px"}});document.body.appendChild(loadNext);dom.on(loadNext,["click"],function(){window.location="?synth_ambient,"+Math.round(Math.random()*1e10)});Tone.Transport.bpm.value=rand.getInteger(80,115);var notes=[["b2","g2","c3","b3","g3","c4"],["c#3","g#3","c#4","g#4","c#5"],["g3","b3","f#4","g4","b4","f#5","g5","b5"],["A3","C4","E4","A4","C5","E5","A5","C6","E6"],["e3","a#4","e4","a#5","e5"]];notes=notes[rand.getInteger(0,notes.length-1)];function timeGenerator(min,max){return Math.pow(2,rand.getInteger(min,max))+"n"}var delayPingPong=new Tone.PingPongDelay({delayTime:"6n",feedback:.9,wet:.2}).toMaster();var delayFeedback=new Tone.FeedbackDelay({delayTime:timeGenerator(2,4),feedback:.9,wet:.4}).toMaster();var lowPass=new Tone.Filter({frequency:rand.getNumber(6e3,2e4)}).toMaster();var freeverb=(new Tone.Freeverb).toMaster();freeverb.dampening.value=rand.getNumber(10,5e3);var phaser=new Tone.Phaser({frequency:rand.getNumber(10,3e3),octaves:rand.getInteger(1,7),baseFrequency:rand.getNumber(1e3,2e3)}).toMaster();var crusher=new Tone.BitCrusher(rand.getInteger(2,6)).toMaster();var chorus=new Tone.Chorus(rand.getNumber(2,6),rand.getNumber(1,3),rand.getNumber(.2,1)).toMaster();function connectGenerator(synth){if(rand.random()>.7)return synth.connect(freeverb);if(rand.random()>.7)return synth.connect(delayFeedback);if(rand.random()>.6)return synth.connect(lowPass);if(rand.random()>.5)return synth.connect(phaser);if(rand.random()>.5)return synth.connect(chorus);if(rand.random()>.5)return synth.connect(crusher);return synth}var kickTime=timeGenerator(1,2);var kick=connectGenerator(new Tone.MembraneSynth({envelope:{sustain:0,attack:.02,decay:.8},octaves:10}));var kickPart=new Tone.Loop(function(time){kick.triggerAttackRelease("C2","1n",time)},kickTime).start(0);var snare=connectGenerator(new Tone.NoiseSynth({volume:-5,envelope:{attack:.001,decay:.7,sustain:0},filterEnvelope:{attack:.001,decay:.6,sustain:0}}));var snarePart=new Tone.Loop(function(time){snare.triggerAttack(time)},"2n").start("4n");var hihatClosed=connectGenerator(new Tone.NoiseSynth({volume:-9,envelope:{attack:.001,decay:.1,sustain:0},filterEnvelope:{attack:.001,decay:.01,sustain:0}}));var hihatOpen=connectGenerator(new Tone.NoiseSynth({volume:-10,filter:{Q:1},envelope:{attack:.01,decay:.3},filterEnvelope:{attack:.01,decay:.03,baseFrequency:14e3,octaves:-2.5,exponent:4}}));var hihatTime=timeGenerator(2,4);var hihat=0;var hihatPart=new Tone.Loop(function(time){hihatClosed.triggerAttack(time);if((hihat+2)%4==0){hihatOpen.triggerAttack(time)}hihat++},hihatTime).start(0);var synthArpeggio=connectGenerator(new Tone.DuoSynth);synthArpeggio.voice0.oscillator.type="sine";synthArpeggio.voice1.oscillator.type="square";var synthPoly=connectGenerator(new Tone.PolySynth(6,Tone.Synth,{oscillator:{partials:[0,2,3,4]},envelope:{attack:.3,decay:.05,sustain:0,release:.02}}));var bass=connectGenerator(new Tone.MonoSynth({volume:-10,envelope:{attack:.1,decay:.3,release:2},filterEnvelope:{attack:.001,decay:.01,sustain:.5,baseFrequency:200,octaves:2.6}}));var bassTime=timeGenerator(2,4);var bassNotes=notes.slice(0,rand.getInteger(1,2));var bassPart=new Tone.Sequence(function(time,note){bass.triggerAttackRelease(note,bassTime,time)},bassNotes).start(0);bassPart.probability=.9;var noise=connectGenerator(new Tone.Noise({volume:-20,type:["white","brown","pink"][rand.getInteger(0,2)]}));var noiseVolume=rand.getNumber(0,.4);if(noiseVolume>.02){noise.start();Tone.Master.volume.rampTo(0,noiseVolume)}var notesArpeggio=notes.slice(0,rand.getInteger(2,6));var noteArpeggioCurrent=0;var noteArpeggioLoop=Math.pow(2,rand.getInteger(4,8));Tone.Transport.scheduleRepeat(function(time){var note=notesArpeggio[noteArpeggioCurrent%notesArpeggio.length];if(noteArpeggioCurrent<notesArpeggio.length)synthArpeggio.triggerAttackRelease(note,"16n",time);noteArpeggioCurrent++;noteArpeggioCurrent%=noteArpeggioLoop},"16n");var polyTime=timeGenerator(1,4);var notesPoly=notes.slice(0,rand.getInteger(2,6));Tone.Transport.scheduleRepeat(function(time){synthPoly.triggerAttackRelease(notesPoly,"8n")},polyTime);Tone.Transport.start()}return{init:init,resize:function resize(){}}};define("synth_ambient",["Tone"],synth_ambient);"use strict";var isNode=typeof module!=="undefined";var Canvas,fs;if(isNode){Canvas=require("canvas")}var con=console;var w=500;var sum=1e3;var v0=0;var v1=0;function createCanvas(w,h){var c;if(isNode){c=new Canvas(w,h)}else{c=document.createElement("canvas");c.width=w;c.height=h}var ctx=c.getContext("2d");return{canvas:c,ctx:ctx}}var bmp=createCanvas(w,w);var pixels=bmp.ctx.getImageData(0,0,w,w);document.body.appendChild(bmp.canvas);for(var i=0;i<w*w;i++){sum+=2654435769;v0+=(v1<<4)+2738958700^v1+sum^(v1>>5)+3355524772;v1+=(v0<<4)+2911926141^v0+sum^(v0>>5)+2123724318;var index=i*4,r=Math.abs(v0)%255,g=0,b=Math.abs(v1)%255;pixels.data[index+0]=r;pixels.data[index+1]=g;pixels.data[index+3]=b;pixels.data[index+4]=255}bmp.ctx.putImageData(pixels,0,0);if(typeof module!=="undefined")module.exports={generate:generate};"use strict";define("tentacle",function(){var TAU=Math.PI*2;var bmp=dom.canvas(1,1);var ctx=bmp.ctx;var size,sw,sh,cx,cy;var numLines=7;var lines=[];var lineLength=30;function init(options){size=400;sw=size;sh=size;cx=sw/2;cy=sh/2;bmp.setSize(sw,sh);for(var j=0;j<numLines;j++){var line=[];for(var i=0;i<lineLength;i++){line.push(createJoint(j,i))}lines.push(line)}render(0)}function createJoint(j,i){var pos=0;var x=0;var y=i*20;var rot=0;var rad=2+.3*(lineLength-i);return{pos:pos,rot:rot,x:x,y:y,move:function move(px,py){pos+=.01;rot=j/numLines*TAU+Math.sin(pos)*.24*(i+1);x=px+Math.sin(rot)*10;y=py+Math.cos(rot)*10;ctx.fillStyle="rgba(200, 160, 130, 0.3)";ctx.beginPath();ctx.drawCircle(cx+x,cy+y,rad);ctx.fill();return{x:x,y:y}}}}function render(time){if(time<1e4)requestAnimationFrame(render);ctx.fillStyle="black";ctx.rect(0,0,sw,sh);ctx.fill();for(var j=0;j<numLines;j++){var p={x:0,y:0};for(var i=0;i<lineLength;i++){var joint=lines[j][i];p=joint.move(p.x,p.y)}}}var experiment={stage:bmp.canvas,init:init};return experiment});"use strict";var tetris_cube=function tetris_cube(){var stage=document.createElement("div");var camera,scene,projector,renderer,holder;var mouse={x:0,y:0};var sw=window.innerWidth,sh=window.innerHeight;var theta=0,gamma=0;var dim=4;var size=40;var cubes=[];var groups=[];var available=[];function cube(){var material=new THREE.MeshLambertMaterial({color:0});var geometry=new THREE.BoxGeometry(size,size,size);return new THREE.Mesh(geometry,material)}function init(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(70,sw/sh,1,1e4);camera.position.set(0,100,500);scene.add(camera);var light=new THREE.DirectionalLight(16777215,2);light.position.set(1,1,1).normalize();scene.add(light);var light=new THREE.DirectionalLight(16711935,2);light.position.set(-1,0,0).normalize();scene.add(light);renderer=new THREE.WebGLRenderer;renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);function p(index){return(index-dim/2+.5)*size}function getPositionFromIndex(index){var x=index%dim;var y=Math.floor(index/dim)%dim;var z=Math.floor(index/(dim*dim));return{x:x,y:y,z:z}}function getIndexFromPosition(_ref){var x=_ref.x,y=_ref.y,z=_ref.z;return x+y*dim+z*dim*dim}for(var i=0;i<dim*dim*dim;i++){var c=cube();var _getPositionFromIndex=getPositionFromIndex(i),x=_getPositionFromIndex.x,y=_getPositionFromIndex.y,z=_getPositionFromIndex.z;available.push(i);c.position.set(p(x),p(y),p(z));c.groupId=0;cubes.push(c);holder.add(c)}var globalGroupId=1;var loners=[];var MODE_GROUP_EXPAND="MODE_GROUP_EXPAND";var MODE_LONER_UNITE="MODE_LONER_UNITE";var checkMode=MODE_GROUP_EXPAND;function checkNeighbours(sourceIndex){function checkNeighbour(targetPosition){var targetIndex=getIndexFromPosition(targetPosition);if(checkMode===MODE_GROUP_EXPAND&&cubes[targetIndex].groupId===0){setGroup(targetIndex,cubes[sourceIndex].groupId);count++}else if(checkMode===MODE_LONER_UNITE&&cubes[targetIndex].groupId>0){setGroup(sourceIndex,cubes[targetIndex].groupId);count++}else{}}var _getPositionFromIndex2=getPositionFromIndex(sourceIndex),x=_getPositionFromIndex2.x,y=_getPositionFromIndex2.y,z=_getPositionFromIndex2.z;var count=0;var queue=[];function queueCheck(pos){queue.push(pos)}if(x===0){queueCheck({x:x+1,y:y,z:z})}else if(x===dim-1){queueCheck({x:x-1,y:y,z:z})}else{queueCheck({x:x-1,y:y,z:z});queueCheck({x:x+1,y:y,z:z})}if(y===0){queueCheck({x:x,y:y+1,z:z})}else if(y===dim-1){queueCheck({x:x,y:y-1,z:z})}else{queueCheck({x:x,y:y-1,z:z});queueCheck({x:x,y:y+1,z:z})}if(z===0){queueCheck({x:x,y:y,z:z+1})}else if(z===dim-1){queueCheck({x:x,y:y,z:z-1})}else{queueCheck({x:x,y:y,z:z-1});queueCheck({x:x,y:y,z:z+1})}rand.shuffle(queue);for(var q=0;q<queue.length;q++){checkNeighbour(queue[q])}if(count===0){loners.push(sourceIndex)}if(checkMode===MODE_GROUP_EXPAND)nextGroup()}function nextGroup(){var availableIndex=Math.floor(available.length*Math.random());if(available.length){availableIndex=available[availableIndex];globalGroupId++;setGroup(availableIndex,globalGroupId);checkNeighbours(availableIndex)}else{con.log("all done...",groups);var pos=0;setTimeout(function(){groups.forEach(function(group,groupIndex){var cols=4;var average={x:(-cols/2+groupIndex%cols)*size*4,y:Math.floor(-1+groupIndex/cols)*size*4,z:0};group.forEach(function(mesh){TweenMax.to(mesh.position,.5,{x:mesh.position.x+average.x,y:mesh.position.y+average.y,z:mesh.position.z+average.z,delay:groupIndex*.1})})})},1700)}}function setGroup(targetIndex,groupId){var maxSize=checkMode===MODE_LONER_UNITE?6:4;if(!groups[groupId])groups[groupId]=[];if(groups[groupId].length===maxSize){return}var c=cubes[targetIndex];groups[groupId].push(c);c.groupId=groupId;var availableIndex=available.indexOf(targetIndex);available.splice(availableIndex,1)}setGroup(0,globalGroupId);checkNeighbours(0);con.log(loners);rand.shuffle(loners);con.log(loners);checkMode=MODE_LONER_UNITE;for(i=0;i<loners.length;i++){checkNeighbours(loners[i])}for(i=0;i<cubes.length;i++){var c=cubes[i];var r=c.groupId*20%255;var g=100;var b=100;var col=r<<16|g<<8|b;c.material.color.setHex(col)}stage.appendChild(renderer.domElement);document.addEventListener("mousemove",onDocumentMouseMove,false);render();animate()}function onDocumentMouseMove(event){event.preventDefault();mouse.x=event.clientX/sw*2-1;mouse.y=-(event.clientY/sh)*2+1}function render(){var camRadius=500;gamma+=mouse.y*4;holder.rotation.x=gamma*.1;holder.rotation.y=theta*.1;camera.lookAt(scene.position);renderer.render(scene,camera)}function animate(){requestAnimationFrame(animate);render()}var experiment={stage:stage,init:init};return experiment};define("tetris_cube",tetris_cube);"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var text_grid=function text_grid(){var settings={boxes:{label:"Boxes",min:2,max:64,cur:7,type:"Number"},phrase:{label:"Phrase",cur:"D Q36RUCN    FGVNFVGQax6q2 b",type:"String"},background:{type:"Boolean",label:"Background",cur:true}};var bmp=dom.canvas(100,100);var ctx=bmp.ctx;var widthOnHeight=.6;var size,sw,sh,blockW,blockH;var rows;var cols;var phrase;function drawBlock(index,x,y){var w=1,h=1;ctx.save();ctx.translate(x*blockW,y*blockH);try{drawText(index)}catch(err){con.log("err drawText",err)}ctx.restore()}function drawText(index){var str=phrase[index];var xo=0;var yo=.8*blockH;var fontSize=.2*size;var font="Helvetica";ctx.font=fontSize+"px "+font;var gradient=ctx.createLinearGradient(0,-blockH,0,0);gradient.addColorStop(0,colours.getRandomColour());gradient.addColorStop(1,colours.getRandomColour());ctx.fillStyle=gradient;var textDimensions=ctx.measureText(str).width;xo=(blockW-textDimensions)/2;ctx.translate(xo,yo);ctx.fillText(str,0,0)}function init(options){size=options.size;sw=size;sh=size;if(options.settings){settings=options.settings}progress("settings:initialised",settings);phrase=settings.phrase.cur;cols=settings.boxes.cur;rows=Math.floor(phrase.length/cols);blockW=Math.ceil(1/cols*size);blockH=Math.ceil(blockW/widthOnHeight);bmp.setSize(sw,sh);ctx.clearRect(0,0,sw,sh);colours.getRandomPalette();colours.setPaletteRange(3);render()}function render(){if(settings.background.cur){}renderBatch(0)}function renderBatch(batch){var total=rows*cols;var x=batch%cols;var y=Math.floor(batch/cols);drawBlock(batch,x,y);if(batch<total-1){progress("render:progress",batch/total);setTimeout(function(){renderBatch(batch+1)},1)}else{progress("render:complete",bmp.canvas)}}function update(settings){init({size:size,settings:settings})}var experiment={stage:bmp.canvas,init:init,render:render,settings:settings,update:update};return experiment};if(isNode){module.exports=text_grid()}else{define("text_grid",text_grid)}"use strict";define("triangles",function(){var camera,scene,renderer;var sw=window.innerWidth,sh=window.innerHeight;var holder,grid=[],lightA,lightB,lightC;var TAU=Math.PI*2;var triangles=48;var triSize=130;var triangleShape;var theta=1/6*Math.PI;var lenA=triSize/Math.cos(theta);var lenB=lenA*Math.sin(theta);var lenC=(lenA+lenB)/2;function generateShape(){var shape=new THREE.Shape;var points=3;var triRadius=.99*lenA;for(var i=0;i<points+1;i++){var a=i/points*TAU;var point={x:Math.sin(a)*triRadius,y:Math.cos(a)*triRadius};if(i==0){shape.moveTo(point.x,point.y)}else{shape.lineTo(point.x,point.y)}}return shape}function triangle(){triangleShape=triangleShape||generateShape();var colour=Math.random()>.98?1376239:Math.random()>.99?16716933:4274759;var geometry=new THREE.ShapeGeometry(triangleShape);var material=new THREE.MeshPhongMaterial({color:colour,side:THREE.DoubleSide,specular:16777215,shininess:rand.getNumber(40,60)});return{mesh:new THREE.Mesh(geometry,material),falling:false}}function init(){scene=new THREE.Scene;scene.fog=new THREE.FogExp2(0,5e-4);camera=new THREE.PerspectiveCamera(100,sw/sh,1,2e4);camera.position.set(0,1e3,1300);camera.lookAt(scene.position);scene.add(camera);lightA=new THREE.DirectionalLight(16761024,.8);scene.add(lightA);lightB=new THREE.DirectionalLight(16761087,.8);scene.add(lightB);lightC=new THREE.DirectionalLight(12632319,.8);scene.add(lightC);ambientLight=new THREE.AmbientLight(16777215,.8);scene.add(ambientLight);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);for(var p=0;p<triangles*triangles;p++){var tri=triangle();holder.add(tri.mesh);var xi=p%triangles-triangles/2+.5;var zi=Math.floor(p/triangles);var rowEven=zi%2;var row4th=Math.floor(zi/2)%2;var pos={x:xi*2*triSize+(rowEven^row4th?-triSize:0),y:0,z:-5e3+getZ(zi)};var rot={x:Math.PI/2,y:0,z:rowEven*Math.PI};tri.rowIndex=zi;tri.mesh.position.set(pos.x,pos.y,pos.z);tri.mesh.rotation.set(rot.x,rot.y,rot.z);tri.origin={pos:pos,rot:rot};grid.push(tri)}document.body.appendChild(renderer.domElement);dom.on(window,["resize"],resize);render(0)}function resize(e){sw=window.innerWidth;sh=window.innerHeight;camera.aspect=sw/sh;camera.updateProjectionMatrix();renderer.setSize(sw,sh)}function getZ(zi){var rowEven=zi%2;return zi*lenC+(rowEven?0:lenC-lenB)}function fall(tri){tri.falling=true;TweenMax.to(tri.mesh.position,2.4,{y:-5e3,ease:Quint.easeIn});TweenMax.to(tri.mesh.scale,.5,{x:.1,y:.1,z:.1,delay:2,ease:Quint.easeIn});TweenMax.to(tri.mesh.rotation,2.5,{x:rand.getNumber(-2,2),y:rand.getNumber(-2,2),z:rand.getNumber(-2,2),ease:Quint.easeIn,onComplete:reset(tri)})}function reset(tri){return function(){var pos=tri.origin.pos,rot=tri.origin.rot;tri.rowIndex-=triangles;pos.z=tri.mesh.position.z-getZ(triangles)+45;tri.mesh.scale.set(1,1,1);tri.mesh.position.set(pos.x,pos.y,pos.z);tri.mesh.rotation.set(rot.x,rot.y,rot.z);tri.falling=false}}function render(time){requestAnimationFrame(render);holder.rotation.z=Math.sin(time*5e-4)*.05;var fallLimitZ=-1e3-Math.sin(time*3e-4)*750;grid.forEach(function(tri,index){tri.mesh.position.z+=15;if(tri.mesh.position.z>fallLimitZ&&tri.falling==false&&Math.random()>.9){fall(tri)}});function moveLight(light,x,y,z){var sc=3e-5*(time+1e4);light.position.set(Math.sin(x*sc)*5,1,Math.sin(z*sc)-1)}moveLight(lightA,15,0,12);moveLight(lightB,14,0,13);moveLight(lightC,20,0,16);renderer.render(scene,camera)}return{init:init}});"use strict";var tunnel_tour_three=function tunnel_tour_three(){var camera,scene,renderer;var mouse={x:0,y:0};var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;function num(min,max){return Math.random()*(max-min)+min}var segmentIndex=0;var segmentLength=200;var segmentsInitial=10;function draw(props){var material=new THREE.MeshLambertMaterial({color:10526880});var geometry=new THREE.BoxGeometry(props.width,props.height,props.depth);var object=new THREE.Mesh(geometry,material);return object}function createStraight(groupPos){var group=new THREE.Group;group.position.set(groupPos.x,groupPos.y,groupPos.z);var bits=parseInt(num(3,15));var size={width:20,height:20,depth:100};var radius=200;for(var i=0,il=bits;i<il;i++){var a=i/il*Math.PI*2;var x=Math.sin(a)*radius;var y=Math.cos(a)*radius;var z=0;var box=draw(size);box.position.set(x,y,z);box.rotation.set(0,0,-a);group.add(box)}scene.add(group)}function createSection(index){createStraight({x:0,y:0,z:index*-segmentLength})}function init(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(100,sw/sh,1,1e4);scene.add(camera);var lightAbove=new THREE.DirectionalLight(16777215,.5);lightAbove.position.set(0,200,100);scene.add(lightAbove);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);for(var j=0,jl=segmentsInitial;j<jl;j++){createSection(j)}document.body.appendChild(renderer.domElement);function listen(eventNames,callback){for(var i=0;i<eventNames.length;i++){window.addEventListener(eventNames[i],callback)}}listen(["resize"],function(e){sw=window.innerWidth;sh=window.innerHeight;camera.aspect=sw/sh;camera.updateProjectionMatrix();renderer.setSize(sw,sh)});listen(["mousemove","touchmove"],function(e){e.preventDefault();if(e.changedTouches&&e.changedTouches[0])e=e.changedTouches[0];mouse.x=e.clientX/sw*2-1;mouse.y=-(e.clientY/sh)*2+1});render(0)}function render(time){camPos.x=mouse.x*100;camPos.y=mouse.y*100;camPos.z-=20;if(camPos.z%segmentLength==0){segmentIndex=-Math.floor(camPos.z/segmentLength);createSection(segmentsInitial+segmentIndex)}camera.position.set(camPos.x,camPos.y,camPos.z);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init,resize:function resize(){}}};define("tunnel_tour_three",tunnel_tour_three);"use strict";var con=console;var isNode=typeof module!=="undefined";if(isNode){var rand=require("./rand.js");var dom=require("./dom.js");var colours=require("./colours.js")}var typography=function typography(){var settings={boxes:{label:"Boxes",min:2,max:64,cur:4,type:"Number"},background:{type:"Boolean",label:"Background",cur:false}};var bmp=dom.canvas(100,100);var ctx=bmp.ctx;var size,sw,sh,block;var rows=4;var cols=4;function typoInteger(min,max){return Math.round(rand.getNumber(min,max))}var numerals=[],numeralsLength=typoInteger(1,5),n=0;while(n++<numeralsLength){numerals.push(typoInteger(0,9))}numerals=numerals.join("");function getString(){var phrase="Typography";var strings=[phrase,numerals];var str=strings[Math.floor(rand.random()*strings.length)];var ss=Math.round(rand.random()*str.length);var se=ss+Math.round(rand.random()*(str.length-ss));str=str.substr(ss,se);var textCase=Math.floor(rand.random()*3);switch(textCase){case 0:str=str.toLowerCase();break;case 1:str=str.toUpperCase();break;default:}return str}function drawBlock(x,y){ctx.save();ctx.translate(x*block,y*block);if(rand.random()>.6){var w=typoInteger(1,3);var h=typoInteger(1,3);ctx.fillStyle=colours.getRandomColour();ctx.fillRect(0,0,block*w,block*h)}try{if(rand.random()>.8){drawInnerBlock()}}catch(err){con.log("err drawInnerBlock",err)}try{if(rand.random()>.9){drawSubdivion()}}catch(err){con.log("err drawSubdivion",err)}try{if(rand.random()>.9){drawPattern()}}catch(err){con.log("err drawPattern",err)}try{if(rand.random()>.8){drawRuler()}}catch(err){con.log("err drawRuler",err)}try{if(rand.random()>.4){drawText()}}catch(err){con.log("err drawText",err)}ctx.restore()}function drawInnerBlock(){var border=.1*block;ctx.fillStyle=colours.getRandomColour();ctx.fillRect(border,border,block-border*2,block-border*2)}function drawSubdivion(){var divs=Math.pow(2,Math.ceil(rand.random()*3));var size=block/divs;for(var i=0;i<divs*divs;i++){var x=i%divs;var y=Math.floor(i/divs);ctx.fillStyle=colours.getRandomColour();ctx.fillRect(x*size,y*size,size,size)}}function drawRuler(){ctx.save();var angle=Math.floor(rand.random()*4)/4;ctx.rotate(angle*Math.PI*2);var majors=Math.pow(2,typoInteger(1,4));var minors=typoInteger(1,4);var majorSize=typoInteger(5,10)*size/400;var minorSize=majorSize*rand.getNumber(.2,.8);ctx.fillStyle=colours.getRandomColour();var width=1*size/300;for(var m=0;m<majors;m++){var x=m/majors*block;var y=0;ctx.fillRect(x,y,width,majorSize);for(var n=0;n<minors;n++){var xn=x+n/minors*block/majors;var yn=0;ctx.fillRect(xn,yn,width,minorSize)}}ctx.restore()}function drawPattern(){var rotation=Math.round(rand.random()*4)/4*Math.PI;var rowSize=Math.round((2+Math.floor(rand.random()*8))*size/1e3);var patternColoured=dom.canvas(rowSize,rowSize*2);ctx.save();ctx.beginPath();ctx.rect(0,0,block,block);ctx.rotate(rotation);patternColoured.ctx.fillStyle=colours.getNextColour();for(var py=0;py<block/rowSize*4;py++){patternColoured.ctx.fillRect(0,py*rowSize*2,block*rowSize,rowSize)}ctx.fillStyle=ctx.createPattern(patternColoured.canvas,"repeat");ctx.fill();ctx.restore()}function drawText(){var angle=Math.floor(rand.random()*4)/4;var xo=rand.random()*block;var yo=rand.random()*block;var fontSize=Math.round(Math.pow(2,2+rand.random()*6)*size/400);var font="Helvetica";ctx.rotate(angle*Math.PI*2);ctx.translate(xo,yo);ctx.font=fontSize+"px "+font;ctx.fillStyle=colours.getRandomColour();ctx.fillText(getString(),0,0)}function init(options){size=options.size;sw=size;sh=size;settings.background.cur=false;settings.boxes.cur=4;if(options.settings){settings=options.settings}progress("settings:initialised",settings);cols=settings.boxes.cur;rows=settings.boxes.cur;block=Math.ceil(1/cols*size);bmp.setSize(sw,sh);ctx.clearRect(0,0,sw,sh);colours.getRandomPalette();colours.setPaletteRange(3);render()}function render(){if(settings.background.cur){ctx.fillStyle=colours.getCurrentColour();ctx.fillRect(0,0,sw,sh)}renderBatch(0)}function renderBatch(batch){var total=rows*cols;var x=batch%cols;var y=Math.floor(batch/cols);drawBlock(x,y);if(batch<total){progress("render:progress",batch/total);setTimeout(function(){renderBatch(batch+1)},5)}else{progress("render:complete",bmp.canvas)}}function update(settings){init({size:size,settings:settings})}var experiment={stage:bmp.canvas,init:init,render:render,settings:settings,update:update};return experiment};if(isNode){module.exports=typography()}else{define("typography",typography)}"use strict";var con=console;var isNode=typeof module!=="undefined";var unknown=function unknown(){var size=800,sw=size,sh=size;var bmp=dom.canvas(size,size);var ctx=bmp.ctx;return{stage:bmp.canvas,resize:function resize(w,h){bmp.canvas.setSize(w,h)},init:function init(){var rows=10;var y=-10;colours.getRandomPalette();var rOffset=rand.getNumber(0,2);var rBase=rand.getNumber(1,2);var rPower=rand.getNumber(1.01,1.5);var gOffset=rand.getNumber(-2,2);var gBase=rand.getNumber(8e3,1e4);var gPower=rand.getNumber(.4,.6);var yOffset=rand.getNumber(-2,2);var yBase=rand.getNumber(1.2,2);var yPower=rand.getNumber(1.2,1.6);var yMultiplier=rand.getNumber(2,3);for(var i=0;i<rows;i++){var r=Math.pow((rOffset+rows-i)*rBase,rPower);var g=Math.pow((gOffset+rows-i)*gBase,gPower);y+=Math.pow((yOffset+rows-i)*yBase,yPower)*yMultiplier;ctx.fillStyle=colours.getNextColour();var cols=i+1;for(var j=0;j<cols;j++){var x=sw/2+(j-(cols-1)/2)/cols*g;ctx.beginPath();ctx.drawCircle(x,y,r);ctx.closePath();ctx.fill()}}},kill:function kill(){}}};if(isNode){module.exports=unknown()}else{define("unknown",unknown)}"use strict";var isNode=typeof module!=="undefined";var voronoi=function(){var con=console;var dot;var sites;var site=[];var regions=[];var bounds=[];var sizeX,sizeY;var width,height;function init(options){dot=options.dot||1;sites=options.sites||10;sizeX=options.sizeX||200;sizeY=options.sizeY||200;width=sizeX*dot;height=sizeY*dot;return{width:width,height:height}}function sq2(x1,x2,y1,y2){var dx=x1-x2,dy=y1-y2;return dx*dx+dy*dy}function manhattan(x,x2,y,y2){return Math.abs(x-x2)+Math.abs(y-y2)}function minkowsky(X1,X2,Y1,Y2){return(Math.abs(X2-X1)*3+Math.abs(Y2-Y1)*3)*.33}function nearest_site(x1,y1){var k,ret=0;var d,dist=0;for(k=0;k<sites;k++){var x2=site[k][0];var y2=site[k][1];d=sq2(x1,x2,y1,y2);if(!k||d<dist){dist=d;ret=k}}return ret}function genPoints(pointIterator){if(pointIterator==undefined)return con.warn("need to pass in a pointIterator function, which returns an array");for(var k=0;k<sites;k++){site[k]=pointIterator(k,sites);regions[k]=[];bounds[k]=[]}}function genMap(){var i,j,k,nearest=[],color,index,pixels=sizeX*sizeY;var a=(new Date).getTime();for(i=0;i<sizeY;i++){for(j=0;j<sizeX;j++){index=i*sizeX+j;nearest[index]=nearest_site(j,i);if(index%1e5==0)con.log("findSites",Math.round(index/pixels*100)+"%")}}var b=(new Date).getTime();con.log("Found sites",b-a);for(i=0;i<sizeY;i++){for(j=0;j<sizeX;j++){var index=i*sizeX+j;var ns=nearest[index];regions[ns].push([j,i]);if(bounds[ns][0]==undefined){bounds[ns][0]=i}else if(i<bounds[ns][0]){bounds[ns][0]=i}if(bounds[ns][1]==undefined){bounds[ns][1]=j}else if(j>bounds[ns][1]){bounds[ns][1]=j}if(bounds[ns][2]==undefined){bounds[ns][2]=i}else if(i>bounds[ns][2]){bounds[ns][2]=i}if(bounds[ns][3]==undefined){bounds[ns][3]=j}else if(j<bounds[ns][3]){bounds[ns][3]=j}if(index%1e5==0)con.log("generatingRegion",Math.round(index/pixels*100)+"%")}}var c=(new Date).getTime();con.log("Generated regions",c-b);calcRegionBounds()}function drawRegions(renderRegion){if(renderRegion==undefined)con.warn("need to pass in a renderRegion function.");for(k=0;k<sites;k++){renderRegion(regions[k],bounds[k]);con.log("drawRegions",Math.round(k/sites*100)+"%")}}function drawSites(ctx){for(k=0;k<sites;k++){ctx.fillStyle="blue";var centreMarker=2;var x=site[k][0]*dot;var y=site[k][1]*dot;ctx.fillRect(x-centreMarker/2,y-centreMarker/2,centreMarker,centreMarker)}}function calcRegionBounds(){for(k=0;k<sites;k++){bounds[k]={x:bounds[k][3]*dot,y:bounds[k][0]*dot,width:(bounds[k][1]-bounds[k][3])*dot,height:(bounds[k][2]-bounds[k][0])*dot}}}function drawRegionBounds(ctx){for(k=0;k<sites;k++){ctx.fillStyle="rgba(0,0,255,0.2)";var b=bounds[k];ctx.fillRect(b.x,b.y,b.width,b.height)}}return{init:init,genMap:genMap,genPoints:genPoints,drawRegions:drawRegions,drawRegionBounds:drawRegionBounds,drawSites:drawSites}}();if(isNode)module.exports=voronoi;"use strict";colours=require("./colours.js");voronoi=require("./voronoi.js");stripes=require("./voronoi_stripes.js");stripes.generate(process.argv[2]);"use strict";var isNode=typeof module!=="undefined";var Canvas,fs;if(isNode){Canvas=require("canvas");fs=require("fs")}var con=console;var dot=1,sizeX=sizeY=isNode?4e3:400;var total=10,current=8;function frand(x){return Math.random()*x}var settings={};settings.overallScale=50+frand(150);settings.pointMethod=~~(Math.random()*4);settings.pointBias=frand(2);settings.lineScale=settings.overallScale;settings.lineSize=1+frand(100);settings.lineGap=1+frand(100);settings.baseRotation=Math.PI*2;settings.varyRotation=Math.PI*(Math.random()>.5?2:.2);settings.varyPerRegion=false;settings.varyPerLine=false;settings.varyDuotone=false;if(settings.varyDuotone){colours.setRandomPalette(0)}function positionPoint(index,total){var dim=Math.floor(Math.sqrt(total));var x=index%dim+.5;var y=Math.floor(index/dim)+.5;var blockX=width/dim/dot;var blockY=height/dim/dot;var centreX=width/2/dot;var centreY=height/2/dot;var radius=index/total*centreX;var angle=index/total*Math.PI*index*(.5+frand(20));var methods=[[frand(sizeX),frand(sizeY)],[centreX+Math.sin(angle)*width/3,centreY+Math.cos(angle)*height/3],[centreX+Math.sin(angle)*radius,centreY+Math.cos(angle)*radius],[(x-settings.pointBias/2+frand(settings.pointBias))*blockX,(y-settings.pointBias/2+frand(settings.pointBias))*blockY]];return methods[settings.pointMethod]}function renderRegion(region,bounds){var pattern=createPattern((bounds.width>bounds.height?bounds.width:bounds.height)+10);var regionCanvas=createCanvas(width,height);regionCanvas.ctx.globalCompositeOperation="source-over";regionCanvas.ctx.fillStyle="red";for(var r=0;r<region.length;r++){var x=region[r][0];var y=region[r][1];regionCanvas.ctx.fillRect(x*dot,y*dot,dot,dot)}regionCanvas.ctx.globalCompositeOperation="source-in";regionCanvas.ctx.drawImage(pattern,bounds.x-5,bounds.y-5);ctx.drawImage(regionCanvas.canvas,0,0)}function createPattern(size){var half=size/2;var canvas=createCanvas(size,size);var ctx=canvas.ctx;ctx.translate(half,half);ctx.rotate(settings.baseRotation+frand(settings.varyRotation));ctx.translate(-half,-half);if(settings.varyDuotone){colours.setColourIndex(1);ctx.fillStyle=colours.getCurrentColour()}else{ctx.fillStyle=colours.getRandomColour()}var padding=Math.sqrt(half*half*2)-half;if(settings.varyPerRegion){settings.lineScale=.5+frand(settings.overallScale);settings.lineSize=1+frand(10)*settings.lineScale;settings.lineGap=2+frand(3)*settings.lineScale}var colour;if(settings.varyDuotone){colour=colours.getNextColour()}var y=-padding;while(y<size+padding){if(settings.varyPerLine){settings.lineSize=1+frand(10)*settings.lineScale;settings.lineGap=2+frand(3)*settings.lineScale}if(!settings.varyDuotone){colour=colours.getRandomColour()}ctx.fillStyle=colour;ctx.fillRect(-padding,y,size+padding*2,settings.lineSize);y+=settings.lineSize+settings.lineGap}return canvas.canvas}function createCanvas(w,h){var c;if(isNode){c=new Canvas(w,h)}else{c=document.createElement("canvas");c.width=w;c.height=h}var ctx=c.getContext("2d");return{canvas:c,ctx:ctx}}var v=voronoi.init({dot:dot,sizeX:sizeX,sizeY:sizeY});var width=v.width;var height=v.height;var canvas=createCanvas(width,height);if(!isNode)document.body.appendChild(canvas.canvas);var ctx=canvas.ctx;var q0=createCanvas(width/2,height/2),q1=createCanvas(width/2,height/2),q2=createCanvas(width/2,height/2),q3=createCanvas(width/2,height/2);function drawQuarter(source,target,q){var x=q%2*-width/2;var y=Math.floor(q/2)*-height/2;con.log("drawQuarter",q,x,y);target.canvas.width=target.canvas.width;target.ctx.drawImage(source.canvas,x,y);var out=fs.createWriteStream(__dirname+"/../export/shirt"+current+"_"+q+".png");var stream=target.canvas.pngStream();stream.on("data",function(chunk){out.write(chunk)});stream.on("end",function(){console.log("saved png")})}function saveFile(canvas){if(isNode){canvas.toBuffer(function(err,buf){if(err){con.log(err)}else{fs.writeFile(__dirname+"/../export/shirt"+current+".png",buf,function(){con.log("writeFile","shirt"+current+".png")})}})}else{con.warn("browser export not written")}}function generate(num){current=num;settings.sites=16+frand(20);settings.varyDuotone=Math.random()>.5;var txt=["sites","overallScale","pointMethod","pointBias","baseRotation","varyRotation","varyDuotone","varyPerRegion","varyPerLine","lineScale","lineSize","lineGap"].map(function(v){return v+":"+settings[v]}).join("\n");if(isNode)fs.writeFile(__dirname+"/../export/_shirt"+current+".txt",txt);con.log(txt);con.log("===================");canvas.canvas.width=canvas.canvas.width;voronoi.init({dot:dot,sites:settings.sites,sizeX:sizeX,sizeY:sizeY});colours.setRandomPalette();con.log("generate",current,total);voronoi.genPoints(positionPoint);voronoi.genMap();voronoi.drawRegions(renderRegion);saveFile(canvas.canvas)}function next(){current++;if(current<total){var delay=5e3;if(current%5==0)delay=5e4;con.log("delaying",delay/1e3,"seconds");setTimeout(generate,delay)}}if(!isNode)generate(0);if(typeof module!=="undefined")module.exports={generate:generate};"use strict";var con=console;var sw=window.innerWidth,sh=window.innerHeight;var canvas=dom.canvas(sw,sh);var hit=dom.canvas(sw,sh);var hitpixels;var ctx=canvas.ctx;var circleRads=Math.PI*2;var numInitial=30;var numCurrent=numInitial;var numMax=numInitial*3;var particles=[];var zones=[];colours.getRandomPalette();function moveParticle(p){if(p.dying){p.age++}p.dirFloat+=(Math.random()-.5)*Math.PI*.5;p.dir-=(p.dir-p.dirFloat)*.01;p.vx=Math.cos(p.dir)*p.speed;p.vy=Math.sin(p.dir)*p.speed;p.x+=p.vx;p.y+=p.vy;var padding=100;if(p.x>sw+padding){p.x-=sw+padding*2;p.px=p.x}if(p.x<-padding){p.x+=sw+padding*2;p.px=p.x}if(p.y>sh+padding){p.y-=sh+padding*2;p.py=p.y}if(p.y<-padding){p.y+=sh+padding*2;p.py=p.y}var r=2;if(p.dying)r/=1+p.age*.01;var x=p.x;var y=p.y;var x1=Math.floor(p.x);var y1=Math.floor(p.y);var index=(x1+y1*sw)*4;var isRed=hitpixels.data[index];if(!isRed){ctx.lineWidth=r;ctx.strokeStyle=p.palette;ctx.beginPath();ctx.moveTo(p.px,p.py);ctx.lineTo(x,y);ctx.stroke()}if(isRed){p.dir=Math.random()*Math.PI*2}p.px=p.x;p.py=p.y;if(p.dying&&p.age>500){killParticle(p)}else if(p.children==0&&numCurrent<numMax&&Math.random()>.99){spawnParticle(p)}}function killParticle(p){var index=particles.indexOf(p);particles.splice(index,1);numCurrent--}function generateParticle(parent){if(parent){return{age:0,children:0,dir:parent.dir,dirFloat:parent.dirFloat,dying:false,palette:colours.mutateColour(parent.palette,10),speed:parent.speed,vx:parent.vx,vy:parent.vy,x:parent.x,y:parent.y,px:parent.x,py:parent.y}}else{var x=Math.random()*sw,y=Math.random()*sh;return{age:0,children:0,dir:Math.random()*Math.PI*2,dirFloat:0,dying:false,palette:colours.getNextColour(),speed:Math.random()*2.5+2.5,vx:0,vy:0,x:x,y:y,px:x,py:y}}}function spawnParticle(parent){parent.dying=true;parent.children++;particles[numCurrent]=generateParticle(parent);numCurrent++}function generate(){zones.push({x:50,y:50,w:100,h:100});zones.push({x:100,y:250,w:20,h:100});zones.push({x:300,y:50,w:100,h:300});for(var j=0;j<zones.length;j++){var z=zones[j];hit.ctx.fillStyle="rgba(50,0,0,1)";hit.ctx.fillRect(z.x,z.y,z.w,z.h)}hitpixels=hit.ctx.getImageData(0,0,sw,sh);for(var i=0;i<numInitial;i++){particles[i]=generateParticle()}}function render(time){ctx.fillStyle="rgba(0,0,0,0.04)";ctx.fillRect(0,0,sw,sh);ctx.drawImage(hit.canvas,0,0);for(var i=0;i<numCurrent;i++){moveParticle(particles[i])}requestAnimationFrame(render)}window.addEventListener("resize",function(){return con.warn("resize disabled!");sw=window.innerWidth;sh=window.innerHeight;canvas.setSize(sw,sh)});generate();document.body.appendChild(canvas.canvas);render(0);