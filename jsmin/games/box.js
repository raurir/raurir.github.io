"use strict";define("box",function(){con.log("define box");var lastPosition,keysDown={up:!1,down:!1,left:!1,right:!1},sw=400,sh=400,block=40,xwide=sw/block,yhigh=sh/block,cursor=block/2,bmp=dom.canvas(sw,sh),container=dom.element("div"),output=dom.element("div",{style:{color:"white"}}),position={x:sw/2,y:sh/2};function tilt(y,x){position.x+=x,position.y+=y}function render(){keysDown.left&&(position.x-=1),keysDown.right&&(position.x+=1),keysDown.up&&(position.y-=1),keysDown.down&&(position.y+=1),position.x<0&&(position.x=0),position.x>sw&&(position.x=sw),position.y<0&&(position.y=0),position.y>sh&&(position.y=sh);var positionIndexMin_x=Math.floor((position.x-cursor/2)/block),positionIndexMin_y=Math.floor((position.y-cursor/2)/block),positionIndexMax_x=Math.floor((position.x+cursor/2)/block),positionIndexMax_y=Math.floor((position.y+cursor/2)/block),positionOk=!0,rgb=20;"#"===field[positionIndexMin_y][positionIndexMin_x]&&(positionOk=!1),"#"===field[positionIndexMax_y][positionIndexMax_x]&&(positionOk=!1),!1===positionOk&&(rgb=60,position.x=lastPosition.x,position.y=lastPosition.y),lastPosition.x=position.x,lastPosition.y=position.y;for(var y=0;y<yhigh;y++)for(var x=0;x<xwide;x++)"#"===field[y][x]&&(bmp.ctx.fillStyle="rgba("+rgb+","+rgb+","+rgb+",1)",bmp.ctx.fillRect(x*block,y*block,block,block));bmp.ctx.fillStyle="rgba(0,0,0,0.4)",bmp.ctx.fillRect(0,0,sw,sh),bmp.ctx.fillStyle="#444",bmp.ctx.fillRect(position.x-cursor/2,position.y-cursor/2,cursor,cursor),requestAnimationFrame(render)}var field=null;return{init:function(){con.log("maze init",maze),maze.init(function(){field=maze.getMaze(),con.log("maze",field),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(){tilt(event.beta,event.gamma)},!0):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(){tilt(2*event.acceleration.x,2*event.acceleration.y)},!0):window.addEventListener("MozOrientation",function(){tilt(50*orientation.x,50*orientation.y)},!0);for(var startPosition=null;null==startPosition;){for(var y=0;y<yhigh;y++)for(var x=0;x<xwide;x++)"#"!==field[y][x]&&.99995<Math.random()&&(startPosition=!0,lastPosition={x:(position={x:x*block+block/2,y:y*block+block/2}).x,y:position.y});con.log("iteration")}!function(eventNames,callback){for(var i=0;i<eventNames.length;i++)window.addEventListener(eventNames[i],callback)}(["keydown","keyup"],function(e){var pressed="keydown"===e.type;switch(e.which){case 37:case 100:keysDown.left=pressed;break;case 38:case 104:keysDown.up=pressed;break;case 39:case 102:keysDown.right=pressed;break;case 40:case 98:keysDown.down=pressed}}),document.body.appendChild(container),container.appendChild(bmp.canvas),container.appendChild(output),con.log("render"),render()},xwide,yhigh)},stage:container,resize:function(){}}});