"use strict";var isNode="undefined"!=typeof module;if(isNode)var dom=require("../dom.js");var shapes=[1,2,3,4,5,6],fillDither=function(args){var c=args.c,r=args.r,size=args.size,settings=args.settings,_settings$alternate=(Object.keys(args).sort().join(","),Object.keys(settings).sort().join("\n"),settings.alternate),alternate=void 0===_settings$alternate?.5<r.getNumber(0,1):_settings$alternate,baseRotation=settings.baseRotation,_settings$bg=settings.bg,bg=void 0===_settings$bg?c.getRandomColour():_settings$bg,_settings$fg=settings.fg,fg=void 0===_settings$fg?c.getRandomColour(!0):_settings$fg,_settings$shape=settings.shape,shape=void 0===_settings$shape?shapes[r.getInteger(0,shapes.length-1)]:_settings$shape,varyRotation=settings.varyRotation,_settings$wiggle=settings.wiggle,wiggle=void 0===_settings$wiggle?10:_settings$wiggle,half=size/2,padding=Math.sqrt(half*half*2)-half,min=-padding,max=size+2*padding,stage=dom.canvas(size,size),ctx=stage.ctx,canvas=stage.canvas;ctx.translate(half,half),ctx.rotate(baseRotation+r.getNumber(0,varyRotation)),ctx.translate(-half,-half),ctx.fillStyle=bg,ctx.fillRect(min,min,max,max);var jump=size/40,yJump=jump,xJump=jump,diamondScale=r.getNumber(.5,1);ctx.fillStyle=fg,ctx.strokeStyle=fg;for(var i=void 0,y=min,row=0;y<max;){var ditherRatio=y/size,ditherAmount=ditherRatio*jump;if(ditherRatio<=0)row++,y+=yJump;else{if(1.1<=ditherRatio){ctx.fillRect(min,y,max-min,max-y);break}for(var x=min-(alternate&&row%2==0?xJump/2:0);x<max;){var wiggleX=wiggle*r.getNumber(-xJump,xJump)/2,wiggleY=wiggle*r.getNumber(-yJump,yJump)/2;if(1===shape)ctx.beginPath(),ctx.drawCircle(x+wiggleX,y+wiggleY,.7*ditherAmount),ctx.closePath(),ctx.fill();else if(2===shape)ctx.fillRect(x+wiggleX,y+wiggleY,ditherAmount,ditherAmount);else if(3===shape)ctx.save(),ctx.translate(x+wiggleX,y+wiggleY),ctx.scale(diamondScale,1),ctx.rotate(Math.PI/4),ctx.fillRect(0,0,ditherAmount,ditherAmount),ctx.restore();else if(4===shape)for(i=0;i<5*ditherAmount;i++){var xd=x+Math.random()*xJump,yd=y+Math.random()*yJump;ctx.fillRect(xd,yd,2,2)}else if(5===shape){var blocks=jump/2;for(i=0;i<Math.pow(blocks,2);i++)if(!(Math.random()>ditherRatio)){var _xd=x+i%blocks*2,_yd=y+2*Math.floor(i/blocks);ctx.fillRect(_xd-.3,_yd-.3,2.6,2.6)}}else if(6===shape)for(i=0;i<ditherAmount;i++){var angle=r.getNumber(0,2*Math.PI),distance=ditherRatio*jump*3,d1=r.getNumber(1,1)*Math.sin(angle)*distance,d2=r.getNumber(1,1)*Math.cos(angle)*distance,xs=x+xJump/2-d1,ys=y+yJump/2-d2,xe=x+xJump/2+d1,ye=y+xJump/2+d2,isForeground=r.random()<ditherRatio;ctx.strokeStyle=isForeground?fg:bg,ctx.lineWidth=isForeground?4:2,ctx.beginPath(),ctx.moveTo(xs,ys),ctx.lineTo(xe,ye),ctx.stroke()}else if(80!==shape)throw new Error("no shape!");x+=xJump}row++,y+=yJump}}return canvas};isNode&&(module.exports=fillDither);