"use strict";define("cube_pixelator",[],function(){var pixels=48;var cubeSize=8;var gridSize=10;var camera,scene,renderer;var mouse={x:0,y:0};var camPos={x:0,y:0,z:0};var sw=window.innerWidth,sh=window.innerHeight;var holder;var controls;var grid=[];var rotations=[];var images=[];var currentImage=0;function cube(w,h,d,colour){var geometry=new THREE.PlaneGeometry(w,h,1);var material=new THREE.MeshLambertMaterial({color:colour});return new THREE.Mesh(geometry,material)}function init(){for(var p=0;p<pixels*pixels;p++){rotations.push({rotation:Math.random()})}var fn1=function fn1(){return createBitmap("cash",fn2)};var fn2=function fn2(){return createBitmap("marilyn",fn3)};var fn3=function fn3(){return createBitmap("hicks",fn4)};var fn4=function fn4(){setTimeout(createScene,200)};fn1()}function createBitmap(image,resolve){var img=new Image;img.onload=function(){if(img.width!=img.height){throw new Error("squares only mate!")}var scale=pixels/img.width;var bmp=dom.canvas(pixels,pixels);var ctx=bmp.ctx;ctx.scale(scale,scale);ctx.drawImage(img,0,0);var grayscale=[];var pixelData=ctx.getImageData(0,0,pixels,pixels).data;for(var p=0;p<pixelData.length;p+=4){var r=pixelData[p];grayscale.push({rotation:r/255})}images.push(grayscale);progress("render:progress",images.length/4);setTimeout(resolve,100)};img.src="./assets/"+image+".jpg"}function createScene(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(90,sw/sh,1,2e4);scene.add(camera);var lightAbove=new THREE.DirectionalLight(16777215,1);lightAbove.position.set(0,1,.5);scene.add(lightAbove);var lightLeft=new THREE.DirectionalLight(15787425,.5);lightLeft.position.set(-1,.5,.5);scene.add(lightLeft);var lightBelow=new THREE.DirectionalLight(3158064,.2);lightBelow.position.set(0,-1,.25);scene.add(lightBelow);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);for(var p=0;p<pixels*pixels;p++){var c=cube(cubeSize,cubeSize,cubeSize,16777215);holder.add(c);var xi=p%pixels-pixels/2+.5;var yi=Math.floor(p/pixels)-pixels/2+.5;var x=xi*gridSize;var y=-yi*gridSize;var z=0;c.position.set(x,y,z);c.rotateSpeed=Math.random()-.5;grid.push(c)}document.body.appendChild(renderer.domElement);render(0);setInterval(toggleImage,6e3);progress("render:complete",renderer.domElement)}var toggleImage=function toggleImage(){currentImage++;currentImage%=images.length;con.log("toggleImage",currentImage);var newRotations=images[currentImage].slice();for(var i=0;i<pixels*pixels;i++){TweenMax.to(rotations[i],3,{rotation:newRotations[i].rotation,easing:Back.easeInOut,delay:i*.001})}};function render(time){grid.forEach(function(c,index){c.rotation.x=Math.PI/4-rotations[index].rotation*Math.PI/3});camPos.x=0+Math.sin(time*12e-5)*50;camPos.y=0+Math.sin(time*17e-5)*50;camPos.z=400+Math.sin(time*1e-4)*300;camera.position.set(camPos.x,camPos.y,camPos.z);camera.lookAt(scene.position);renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init}});