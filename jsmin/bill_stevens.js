"use strict";var _slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")};define("bill_stevens",function(){var camera,controls,scene,renderer,holder,stage=document.createElement("div"),sw=window.innerWidth,sh=window.innerHeight,cubes=[],occupied=(Array(Math.pow(4,3)).fill(0),Array(Math.pow(4,3)).fill(0)),populate=function(array,index){return array[index]++},getPositionFromIndex=function(grid){return function(index){return{x:index%grid,y:Math.floor(index/grid)%grid,z:Math.floor(index/(grid*grid))}}},getIndexFromPosition=function(_ref){return _ref.x+4*_ref.y+4*_ref.z*4},pieces=[{id:3,structure:[[[1,1,1,1]]]}].map(function(piece){var structure=piece.structure,w=0,h=0,d=0;return structure.forEach(function(xLayer,x){w=Math.max(w,x+1),xLayer.forEach(function(yRow,y){h=Math.max(h,y+1),yRow.forEach(function(piece,z){d=Math.max(d,z+1)})})}),Object.assign(piece,{dimensions:{w:w,h:h,d:d}})}),cube=function(scale){var d=30*scale,material=new THREE.MeshLambertMaterial({color:0}),geometry=new THREE.BoxGeometry(d,d,d);return new THREE.Mesh(geometry,material)},a=0,attemptBlock=function attemptBlock(){if(function(){var test=occupied.slice(),piece=pieces[Math.floor(Math.random()*pieces.length)],structure=piece.structure,p=function(index){return 30*index},hex=colours.getNextColour(),mutated=colours.mutateColour(hex,30),colour=Number("0x"+mutated.substr(1)),containerTest=new THREE.Group,containerReal=new THREE.Group;holder.add(containerTest),holder.add(containerReal),containerTest.x=rand.getInteger(0,4-piece.dimensions.w),containerTest.y=rand.getInteger(0,4-piece.dimensions.h),containerTest.z=rand.getInteger(0,4-piece.dimensions.d),containerTest.rotation.set(rand.getInteger(-1,1)*Math.PI/2,rand.getInteger(-1,1)*Math.PI/2,rand.getInteger(-1,1)*Math.PI/2),structure.forEach(function(xLayer,x){xLayer.forEach(function(yRow,y){yRow.forEach(function(piece,z){if(piece){var c=cube(.6);c.position.set(p(x),p(y),p(z)),c.material.color.setHex(colour),containerTest.add(c)}})})}),containerTest.position.set(30*containerTest.x,30*containerTest.y,30*containerTest.z),containerTest.updateMatrixWorld();var min={x:10,y:10,z:10},max={x:0,y:0,z:0},vectors=containerTest.children.map(function(c,index){var vector=new THREE.Vector3;vector.setFromMatrixPosition(c.matrixWorld);var cleansed={};return Object.entries(vector).forEach(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],value=_ref3[1],v=0<value&&value<.001||value<0&&-.001<value?0:value;cleansed[key]=v/30,min[key]=Math.min(min[key],cleansed[key]),max[key]=Math.max(max[key],cleansed[key])}),cleansed}),shift=function(newV,oldV,d){return min[d]<0?newV[d]=oldV[d]-min[d]:3<max[d]?newV[d]=oldV[d]-(max[d]-4+1):newV[d]=oldV[d],newV},shifted=vectors.map(function(oldV){var newV={};return shift(newV,oldV,"x"),shift(newV,oldV,"y"),shift(newV,oldV,"z"),newV});if(shifted.forEach(function(v){var positionIndex=getIndexFromPosition(v);populate(test,positionIndex)}),test.some(function(item){return 1<item}))return con.log("invalid!");shifted.forEach(function(v){var x=v.x,y=v.y,z=v.z,c=cube(.95);c.position.set(p(x),p(y),p(z)),c.material.color.setHex("0x50ff50"),containerReal.add(c);var positionIndex=getIndexFromPosition(v);populate(occupied,positionIndex)})}(),occupied.every(function(item){return 1===item}))return con.log("we're done here!!",occupied);10<++a||setTimeout(attemptBlock,20)},onKeyDown=function(event){},render=function(){controls.update(),camera.lookAt(scene.position),renderer.render(scene,camera)},animate=function animate(){requestAnimationFrame(animate),render()};return{stage:stage,init:function(){var light;colours.getRandomPalette(),scene=new THREE.Scene,(camera=new THREE.PerspectiveCamera(50,sw/sh,1,1e4)).position.set(0,100,500),scene.add(camera),(light=new THREE.DirectionalLight(16777215,2)).position.set(1,1,1).normalize(),scene.add(light),(light=new THREE.DirectionalLight(16711935,2)).position.set(-1,0,0).normalize(),scene.add(light),(renderer=new THREE.WebGLRenderer).setSize(sw,sh),controls=new THREE.OrbitControls(camera,renderer.domElement),holder=new THREE.Group,scene.add(holder);for(var p=function(index){return 30*index},i=0;i<Math.pow(5,3);i++){var c=cube(.1),_getPositionFromIndex=getPositionFromIndex(5)(i),x=_getPositionFromIndex.x,y=_getPositionFromIndex.y,z=_getPositionFromIndex.z;c.position.set(p(x)-15,p(y)-15,p(z)-15),c.material.color.setHex(16742144),cubes.push(c),holder.add(c)}stage.appendChild(renderer.domElement),document.addEventListener("keydown",onKeyDown,!1),render(),animate(),attemptBlock()}}});