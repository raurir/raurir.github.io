"use strict";var isLight=function(v){return v<.1},SPOKES="SPOKES",MANDALA="MANDALA",CIRCLES="CIRCLES",BIKE="BIKE",allStyles=[BIKE],getVariants=function(v){return v<.6?allStyles:v<.9?allStyles.filter(function(){return.5<number(0,1)}):allStyles.splice(integer(0,allStyles.length-1),1)};window.$fxhashFeatures={isLight:isLight(fxrand()),isSpinning:.5<fxrand(),isZooming:.5<fxrand(),variants:getVariants(fxrand()),speed:.01+.03*fxrand()};var pi=Math.PI,pi2=2*pi;function mechadv(){var stage=makeCanvas(1,1),context=stage.getContext("2d");return{init:function(_ref){var stageSize=_ref.size,sw=stageSize,sh=stageSize;stage.width=sw,stage.height=sh;var _window$$fxhashFeatur=window.$fxhashFeatures,isLight=_window$$fxhashFeatur.isLight,isSpinning=_window$$fxhashFeatur.isSpinning,isZooming=_window$$fxhashFeatur.isZooming,speed=_window$$fxhashFeatur.speed,variants=_window$$fxhashFeatur.variants;isLight&&(document.body.style.background="#fff");var speedMod=1,speedModTarget=1,cogs=[],cx=.5*sw,cy=.5*sh,magic=0,cogNumber=0;function createCog(cogIndex,forceX,forceY){var cogCanvas,ctx,size,cogDirection,ang,forceSize=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0,preventOverlap=4<arguments.length&&void 0!==arguments[4]&&arguments[4],prevCog=cogs[cogIndex];if(forceX&&forceY&&prevCog){var dy=forceY-prevCog.yp,dx=forceX-prevCog.xp;ang=Math.atan(dy/dx),ang+=dx<0?pi:0,dx=Math.abs(dx)-Math.abs(prevCog.size),dy=Math.abs(dy)-Math.abs(prevCog.size),size=forceSize||Math.sqrt(dx*dx+dy*dy)}else ang=number(0,pi2),size=forceSize||number(60,300);var teeth=~~(size/10);if(!(teeth<5)){var thisCX=prevCog&&prevCog.cx||cx,thisCY=prevCog&&prevCog.cy||cy;if(prevCog){cogDirection=-1*prevCog.cogDirection;var wtf=prevCog.wtf;thisCX+=(wtf+=size-10)*Math.cos(ang),cx=thisCX,thisCY+=wtf*Math.sin(ang),cy=thisCY}else cogDirection=1;magic=size-10;for(var minRad=size-22,maxRad=size+0,verts=[],step=pi2/(4*teeth),mod=0,oddEven=0,halfRadius=(maxRad-minRad)/1.6+minRad,j=0;j<4*teeth;j++){var i=j*step,topBottomLand=~~mod%2,r=topBottomLand*(maxRad-minRad)+minRad;mod+=.5,oddEven+=1;var angle=i-step/2,realX=r*Math.cos(angle),realY=r*Math.sin(angle),v=void 0;v=oddEven%2==0?{tb:topBottomLand,ex:realX,ey:realY}:{tb:topBottomLand,mp:!0,ex:realX,ey:realY,mx:halfRadius*Math.cos(i-step),my:halfRadius*Math.sin(i-step)},verts.push(v)}var xp=thisCX,yp=thisCY,rotation=number(0,pi2);prevCog&&(rotation=prevCog.teeth/teeth*-prevCog.rotation+ang*(prevCog.teeth+teeth)/teeth,teeth%2==0&&(rotation+=pi2/(2*teeth)));var cog={cogDirection:cogDirection,spin:1,wtf:magic,cx:thisCX,cy:thisCY,size:size,rotation:rotation,teeth:teeth,xp:xp,yp:yp};if(preventOverlap)for(var k=0;k<cogs.length;k++){var otherCog=cogs[k];if(otherCog!=prevCog){var _dx=xp-otherCog.xp,_dy=yp-otherCog.yp;if(Math.sqrt(_dx*_dx+_dy*_dy)<size+otherCog.size)return}}var draw=function(){cogCanvas||function(){var dims=2*(size+5),axleSize=.2*minRad,cutoutStyle=variants[integer(0,variants.length-1)];cogCanvas=makeCanvas(dims,dims),(ctx=cogCanvas.getContext("2d")).save(),ctx.translate(size+5,size+5),ctx.fillStyle=colourGrey({darkest:20,lightest:70}),ctx.beginPath();var v=verts[0];ctx.moveTo(v.ex,v.ey);for(var i=1;i<verts.length;i++)(v=verts[i]).mp?ctx.quadraticCurveTo(v.mx,v.my,v.ex,v.ey):ctx.lineTo(v.ex,v.ey);if(v=verts[0],ctx.quadraticCurveTo(v.mx,v.my,v.ex,v.ey),ctx.closePath(),ctx.fill(),drawCircle(ctx,0,0,minRad,{fillStyle:colourGrey({lightest:20})}),.5<number(0,1)){var metal=generateMetal(300,300),pattern=ctx.createPattern(metal,"repeat");ctx.fillStyle=pattern,ctx.fill()}if(.5<number(0,1)){var latheScratches=integer(12,size/5);40<latheScratches&&(latheScratches=40);for(var l=0;l<latheScratches;l++)drawCircle(ctx,0,0,number(axleSize,minRad),{fillStyle:null,lineWidth:1,strokeStyle:colourGrey({darkest:1,lightest:200,alpha:number(.01,.1)})})}switch(cutoutStyle){case BIKE:ctx.globalCompositeOperation="destination-out",drawBike(ctx,axleSize,minRad);break;case MANDALA:ctx.globalCompositeOperation="destination-out",drawSeeds(ctx,axleSize,minRad);break;case SPOKES:var outerRadius=minRad*number(.8,.9),innerRadius=number(axleSize,minRad/2);ctx.globalCompositeOperation="destination-out",drawCircle(ctx,0,0,outerRadius-5,{fillStyle:"green"}),ctx.globalCompositeOperation="source-over",ctx.fillStyle=colourGrey({lightest:70}),drawSpokes(ctx,teeth,innerRadius,outerRadius),drawCircle(ctx,0,0,innerRadius+5,{fillStyle:colourGrey()});break;case CIRCLES:ctx.globalCompositeOperation="destination-out",drawCutouts(ctx,teeth,axleSize+.1*minRad,.9*minRad)}ctx.globalCompositeOperation="source-over",drawBand(ctx,axleSize,axleSize+minRad*number(.02,.2));var outerBand=.8<number(0,1),outerBandMin=void 0;if(outerBand&&(outerBandMin=minRad*number(.8,.98),drawBand(ctx,outerBandMin,minRad)),outerBand&&.8<number(0,1)){var distance=outerBandMin+(minRad-outerBandMin)/2;ctx.font="15px Courier",ctx.fillStyle=colourGrey({darkest:0,lightest:100}),fxhash.split("").forEach(function(chr,chrIndex){var angle=chrIndex*Math.asin(12/distance);ctx.save(),ctx.rotate(-angle),ctx.translate(0,distance+4),ctx.fillText(chr,0,0),ctx.restore()})}ctx.globalCompositeOperation="source-over",drawCircle(ctx,0,0,axleSize,{fillStyle:isLight?"#fff":"#000"})}(),context.save(),context.translate(xp,yp),context.rotate(rotation),context.drawImage(cogCanvas,-size-5,-size-5),context.restore()};return cog.rotate=function(){rotation+=pi2/teeth*cogDirection*speed*speedMod,draw()},cogs[cogNumber]=cog,cogNumber++,cog}}var spin=0,spinRate=-.005*number(-1,1),zoom=-pi/2,n=null,grid=function(_ref2){var d=_ref2.d,size=_ref2.size,min=_ref2.min,total=_ref2.total,larger=_ref2.larger,max=stageSize-min;createCog(n,cx=min+d,cy=min+d,size*larger);for(var dir=1,i=0;i<total-1;i++)max<(cx+=d*dir)?(cy+=d,cx-=d,dir*=-1):cx<min+1*size&&(cy+=d,cx+=d,dir*=-1),createCog(i,cx,cy,1==larger?size:size*(((i+1)%2==1)+1)*larger)},randomDistribution=function(symmetry){return function(){var attempts=0;createCog(n,cx,cy,number(50,sw/2));for(var driverIndex=0;attempts<4e3;){var xo=number(0,sw),yo=number(0,sh);createCog(driverIndex,xo,yo,void 0,!0)&&(symmetry&&(createCog(2<cogs.length?driverIndex-1:0,sw-xo,sh-yo,void 0,!0),driverIndex++),driverIndex++),attempts++}}},funcs=[function(){return grid({d:150,size:190,min:100,total:121,larger:1})},function(){return grid({d:150,size:40,min:300,total:64,larger:4})},randomDistribution(!0),randomDistribution(!1),function(){for(var size=number(100,300),angleDir=2*integer(0,1)-1,angleStart=number(0,pi2),angleBase=number(.03,.04),radiusBase=size*number(1,2),radiusExponent=number(1,2),i=0;i<15;i++){var angle=angleStart+angleDir*Math.pow(i*angleBase,1.2)*pi2,radius=100+Math.pow(i*radiusBase,radiusExponent),x1=.5*sw+Math.sin(angle)*radius,y1=.5*sh+Math.cos(angle)*radius,x2=.5*sw+Math.sin(angle+pi)*radius,y2=.5*sh+Math.cos(angle+pi)*radius;context.fillStyle="green",context.fillRect(x1-5,y1-5,10,10),context.fillRect(x2-5,y2-5,10,10),1==i?(createCog(0,x1,y1,size,!0),createCog(0,x2,y2,size,!0)):1<i?(createCog(2*i-3,x1,y1,size,!0),createCog(2*i-2,x2,y2,size,!0)):createCog(n,x1,y1,size)}},function(){var sizes=Array(8).fill().map(function(){return number(100,500)});createCog(n,.5*sw,.5*sh,500),[{x:0,y:1},{x:-1,y:0},{x:0,y:-1},{x:1,y:0}].forEach(function(_ref3,dirIndex){for(var x=_ref3.x,y=_ref3.y,i=0;i<8;i++)createCog(0==i?i:i+8*dirIndex,.5*sw+x*(i+1)*750,.5*sh+y*(i+1)*750,sizes[i])})}];funcs[integer(0,funcs.length-1)](),function onLoop(){requestAnimationFrame(onLoop),context.fillStyle=isLight?"#fff":"#000",context.fillRect(0,0,sw,sh),context.save();var scale=Math.sin(zoom)+(isZooming?1.7:2);context.translate(.5*sw,.5*sh),context.scale(scale,scale),context.translate(0,0),context.rotate(spin*spinRate),context.translate(-sw/2,-sh/2),cogs.forEach(function(cog){return cog.rotate()}),context.restore(),spin+=Number(isSpinning),zoom+=isZooming?.002:0,speedMod-=.04*(speedMod-speedModTarget)}(),document.body.addEventListener("click",function(e){var direction=2*Math.floor(2*Math.random())-1,yRatio=e.clientY/window.innerHeight;speedModTarget=speed+Math.random()*yRatio*10*direction})},stage:stage}}