"use strict";var progressBar,_slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},progress=function(eventName,eventParam){switch(eventName){case"render:progress":progressBar.style.width=100*eventParam+"%",progressBar.style.height="10px";break;case"render:complete":progressBar.style.height="0px"}},exps=function(experimentsDetails){var experiments=experimentsDetails.list;return function(){var randomHue=Math.floor(360*Math.random());document.documentElement.style.setProperty("--colour-accent","hsl("+randomHue+", 100%, 60%)"),document.documentElement.style.setProperty("--colour-accent-20","hsla("+randomHue+", 100%, 60%, 0.2)");var info,currentExperiment,seed,experimentActive=!1,viewSource=!1,format=null,size=2e3;progressBar=dom.element("div",{id:"progress",style:{width:0,height:0}}),document.body.appendChild(progressBar);var holder=dom.element("div",{id:"experiment-holder"});document.body.appendChild(holder);var expList=dom.element("div",{id:"experiment-list"});document.body.appendChild(expList);var buttonsNav=dom.element("div",{className:"exps-buttons"});document.body.appendChild(buttonsNav);var buttonClose=dom.button("X",{className:"exps-button"});buttonsNav.appendChild(buttonClose),dom.on(buttonClose,["click","touchstart"],function(e){"touchstart"===e.type&&(e.preventDefault(),e.stopPropagation()),window.location="/"+(viewSource?"?src":"")});var buttonReload=dom.button("",{className:"exps-button"});buttonsNav.appendChild(buttonReload);var buttonReloadSymbol=dom.element("span",{innerHTML:"⟳",style:{display:"inline-block",transform:"translate(0px,-1px) scale(2)"}});buttonReload.appendChild(buttonReloadSymbol);var buttonInfo=dom.button("?",{className:"exps-button"});buttonsNav.appendChild(buttonInfo),dom.on(buttonInfo,["click","touchstart"],function(e){"touchstart"===e.type&&(e.preventDefault(),e.stopPropagation()),showInfo()});var panelInfo=dom.element("div",{className:"exps-info"}),panelInfoDetails=dom.element("div",{className:"exps-info-details"}),panelNav=dom.element("div",{className:"exps-buttons interacted"}),panelButtonClose=dom.button("X",{className:"exps-button"});dom.on(panelButtonClose,["click","touchstart"],function(e){"touchstart"===e.type&&(e.preventDefault(),e.stopPropagation()),hideInfo()}),document.body.appendChild(panelInfo),panelInfo.appendChild(panelNav),panelNav.appendChild(panelButtonClose),panelInfo.appendChild(panelInfoDetails);var meanderingBg,loadExperiment=function(index){var src=experiments[index];src.toString().includes("css:")&&(src=src.filter(function(file){var s,link,isCSS=file.includes("css:");return isCSS&&(s=file.replace("css:",""),(link=dom.element("link")).rel="stylesheet",link.type="text/css",link.href="css/"+s+".css",document.head.appendChild(link)),!isCSS})),require(src,function(experiment){experiment&&experimentLoaded(experiment)})},titleCase=function(title){var titleCaseWord=function(word){return word.charAt(0).toUpperCase()+word.slice(1).toLowerCase()};return title.includes("")?title.replace(/_/g," ").split(" ").map(titleCaseWord).join(" "):titleCaseWord(title)},showButtons=function(){for(var e in buttonClose.style.display="none",buttonInfo.style.display="none",experiments){var button=dom.element("button",{className:"exp"});dom.on(button,["click"],function(event){window.location="?"+event.target.key+(viewSource?"&src":"")});var key=experiments[e][0],title=key,expDetails=experimentsDetails.getDetails(key);expDetails&&expDetails.title&&(title=expDetails.title),button.key=key,title=titleCase(title),button.innerHTML=title,expList.appendChild(button)}},showInfo=function(){panelInfo.classList.add("displayed"),panelInfoDetails.innerHTML="\n<h4>EXPGFX</h4>\n<h1>"+info.title+"</h1>\n"+(info.description||"No description provided")+"\n<p><a href='#' class='view-source-link'>View Source</a></p>";var viewSourceLink=panelInfoDetails.querySelector(".view-source-link");dom.on(viewSourceLink,["click"],function(e){e.preventDefault(),showSource()})},showSource=function(){panelInfoDetails.innerHTML="<p>Loading source...</p>",fetch("/es5/"+info.key+".js").then(function(response){if(!response.ok)throw new Error("HTTP "+response.status+": "+response.statusText);return response.text()}).then(function(sourceCode){panelInfoDetails.innerHTML="\n<h4>EXPGFX:SRC</h4>\n<h1>"+info.key+".js</h1>\n<pre><code>"+escapeHtml(sourceCode)+"</code></pre>\n<p><a href='#' class='back-to-info-link'>← Back to Info</a></p>\n"}).catch(function(error){panelInfoDetails.innerHTML="\n<h4>EXPGFX:SRC:ERROR</h4>\n<p>Could not load source code: "+error.message+"</p>\n<p><a href='#' class='back-to-info-link'>← Back to Info</a></p>\n"}).finally(function(){var backLink=panelInfoDetails.querySelector(".back-to-info-link");dom.on(backLink,["click"],function(e){e.preventDefault(),showInfo()})})},escapeHtml=function(text){var div=document.createElement("div");return div.textContent=text,div.innerHTML},hideInfo=function(){panelInfo.classList.remove("displayed")},resize=function(){var sw=window.innerWidth,sh=window.innerHeight;meanderingBg&&meanderingBg.resize(sw,sh),currentExperiment&&currentExperiment.resize&&currentExperiment.resize(sw,sh)},experimentLoaded=function(exp){(currentExperiment="function"==typeof exp?exp("svg"===format):exp).stage&&holder.appendChild(currentExperiment.stage),currentExperiment.init({progress:progress,seed:seed,size:size}),resize()};return function(){if(window.location.search){var params=window.location.search.split("?")[1].split("&"),key=params[0],index=0,found=!1,keyWithSeed=key.split(",");viewSource=0<params.filter(function(param){return"src"===param}).length;var setSize=params.filter(function(param){return param.startsWith("size=")}),setFormat=params.filter(function(param){return param.startsWith("format=")});if("src"===key)return showButtons();if(keyWithSeed[1]&&(key=keyWithSeed[0],seed=keyWithSeed[1],rand.setSeed(seed)),1===setSize.length){var _setSize$0$split=setSize[0].split("="),num=_slicedToArray(_setSize$0$split,2)[1];isNaN(num)||(size=Math.max(100,Math.min(Number(num),1e3)))}if(1===setFormat.length){var _setFormat$0$split=setFormat[0].split("="),fmt=_slicedToArray(_setFormat$0$split,2)[1];"svg"!==fmt&&"bmp"!==fmt||(format=fmt)}for(;index<experiments.length&&0==found;)experiments[index][0]==key?found=!0:index++;var firstNode=!(experimentActive=!0);new MutationObserver(function(mutations){mutations.forEach(function(mutation){experimentActive&&mutation.addedNodes.forEach(function(node){firstNode||node.parentElement!==holder&&(firstNode=!0,holder.appendChild(node))})})}).observe(document.body,{childList:!0,subtree:!0}),loadExperiment(index),(info=experimentsDetails.getDetails(key))?info.key=key:info={key:key,title:titleCase(key)},info.preventRefresh?buttonsNav.removeChild(buttonReload):dom.on(buttonReload,["click","touchstart"],function(e){"touchstart"===e.type&&(e.preventDefault(),e.stopPropagation()),window.location="?"+key+","+Math.round(1e10*Math.random())+(viewSource?"&src":"")}),document.body.classList.add("experiment-active"),buttonsNav.classList.add("interacted")}else showButtons()}(),dom.on(window,["resize"],function(){return resize()}),experimentActive||require(["meandering_polygons"],function(experiment){meanderingBg=experiment,holder.appendChild(experiment.stage),holder.classList.add("fixed"),experiment.stage.style.opacity=.2,experiment.init({transparentBg:!0,randomHue:randomHue})}),{load:loadExperiment,experiments:experiments}}};define("exps",["exps_details"],exps);