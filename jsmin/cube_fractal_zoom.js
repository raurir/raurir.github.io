"use strict";define("cube_fractal_zoom",function(){var cubeSize=200;var gridSize=cubeSize*1.2;var camera,scene,renderer;var sw=window.innerWidth,sh=window.innerHeight;var lightA,lightB,lightC;var next,prev;var destRot={};function getIndex(p,num){var xi=p%num-num/2+.5;var yi=Math.floor(p/num)%num-num/2+.5;var zi=Math.floor(p/num/num)-num/2+.5;return{xi:xi,yi:yi,zi:zi}}function cubes(num){var grid=[];var group=new THREE.Group;holder.add(group);var inner=new THREE.Group;group.add(inner);for(var p=0;p<num*num*num;p++){var c=cube();inner.add(c);var _getIndex=getIndex(p,num),xi=_getIndex.xi,yi=_getIndex.yi,zi=_getIndex.zi;var x=xi*cubeSize;var y=yi*cubeSize;var z=zi*cubeSize;c.position.set(x,y,z);grid.push(c)}return{group:group,inner:inner,num:num,grid:grid}}function cube(){var material=new THREE.MeshPhongMaterial({color:9470064,specular:16777215,shininess:50});var geometry=new THREE.BoxGeometry(cubeSize,cubeSize,cubeSize);return new THREE.Mesh(geometry,material)}function init(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(100,sw/sh,1,2e4);scene.add(camera);camera.position.set(0,0,1500);camera.lookAt(scene.position);lightA=new THREE.DirectionalLight(16711680,1);scene.add(lightA);lightB=new THREE.DirectionalLight(12623872,1);scene.add(lightB);lightC=new THREE.DirectionalLight(16750848,1);scene.add(lightC);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(sw,sh);holder=new THREE.Group;scene.add(holder);var lightAmbient=new THREE.AmbientLight(16769248,.2);scene.add(lightAmbient);prev=cubes(2);next=cubes(2);document.body.appendChild(renderer.domElement);render(0);setTimeout(zoomIn,1500)}function zoomIn(){next.group.scale.set(.001,.001,.001);var scale=prev.num;TweenMax.to(prev.group.scale,2.5,{x:scale,y:scale,z:scale,ease:Quad.easeInOut});var xi=0;var yi=xi;var zi=xi;var x=(xi+.5)*gridSize;var y=(yi+.5)*gridSize;var z=(zi+.5)*gridSize;TweenMax.to(prev.inner.position,2,{x:x,y:y,z:z,ease:Quad.easeInOut});prev.grid.forEach(function(c,index){var _getIndex2=getIndex(index,prev.num),xi=_getIndex2.xi,yi=_getIndex2.yi,zi=_getIndex2.zi;var x=xi*gridSize;var y=yi*gridSize;var z=zi*gridSize;TweenMax.to(c.position,1.5,{x:x,y:y,z:z,ease:Quad.easeInOut,delay:1})});destRot={x:rand.getNumber(-Math.PI,Math.PI),y:rand.getNumber(-Math.PI,Math.PI),z:rand.getNumber(-Math.PI,Math.PI)};TweenMax.to(prev.group.rotation,2.5,{x:destRot.x,y:destRot.y,z:destRot.z,ease:Quad.easeInOut,onComplete:zoomOver})}function zoomOver(){next.group.scale.set(1,1,1);next.group.rotation.set(destRot.x,destRot.y,destRot.z);var g=gridSize*4;prev.grid.forEach(function(c,index){var _getIndex3=getIndex(index,prev.num),xi=_getIndex3.xi,yi=_getIndex3.yi,zi=_getIndex3.zi;var x=xi*g;var y=yi*g;var z=zi*g;if(index!=0){TweenMax.to(c.position,2.5,{x:x,y:y,z:z,ease:Quad.easeIn});TweenMax.to(c.rotation,2.5,{x:rand.getNumber(-2,2),y:rand.getNumber(-2,2),z:rand.getNumber(-2,2),ease:Quint.easeIn})}TweenMax.to(c.scale,2.5,{x:0,y:0,z:0,ease:Quint.easeIn})});TweenMax.to({},2.5,{onComplete:zoomAgain})}function zoomAgain(){var temp=prev;prev=next;next=temp;next.group.scale.set(.001,.001,.001);next.inner.position.set(0,0,0);next.grid.forEach(function(c,index){var _getIndex4=getIndex(index,next.num),xi=_getIndex4.xi,yi=_getIndex4.yi,zi=_getIndex4.zi;var x=xi*cubeSize;var y=yi*cubeSize;var z=zi*cubeSize;c.position.set(x,y,z);c.rotation.set(0,0,0);c.scale.set(1,1,1)});setTimeout(zoomIn,1e3)}function render(time){function moveLight(light,x,y,z){var sc=4e-5;var t=time+1e4;light.position.set(Math.sin(t*x*sc),Math.sin(t*y*sc),Math.sin(t*z*sc))}moveLight(lightA,15,17,12);moveLight(lightB,14,19,13);moveLight(lightC,20,18,16);holder.rotation.z+=.005;holder.rotation.x+=.001;renderer.render(scene,camera);requestAnimationFrame(render)}return{init:init}});